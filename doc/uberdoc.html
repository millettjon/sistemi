<!DOCTYPE html>
<html><head><meta charset="utf-8" content="text/html" http-equiv="Content-Type" /><meta name="description" /><style type="text/css">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
.syntaxhighlighter a,
.syntaxhighlighter div,
.syntaxhighlighter code,
.syntaxhighlighter table,
.syntaxhighlighter table td,
.syntaxhighlighter table tr,
.syntaxhighlighter table tbody,
.syntaxhighlighter table thead,
.syntaxhighlighter table caption,
.syntaxhighlighter textarea {
  -moz-border-radius: 0 0 0 0 !important;
  -webkit-border-radius: 0 0 0 0 !important;
  background: none !important;
  border: 0 !important;
  bottom: auto !important;
  float: none !important;
  height: auto !important;
  left: auto !important;
  line-height: 1.1em !important;
  margin: 0 !important;
  outline: 0 !important;
  overflow: visible !important;
  padding: 0 !important;
  position: static !important;
  right: auto !important;
  text-align: left !important;
  top: auto !important;
  vertical-align: baseline !important;
  width: auto !important;
  box-sizing: content-box !important;
  font-family: "Consolas", "Bitstream Vera Sans Mono", "Courier New", Courier, monospace !important;
  font-weight: normal !important;
  font-style: normal !important;
  min-height: inherit !important;
  min-height: auto !important;
}

.syntaxhighlighter {
/*  width: 100% !important; */
  margin: 1em 0 1em 0 !important;
  position: relative !important;
  overflow: auto !important;
}
.syntaxhighlighter.source {
  overflow: hidden !important;
}
.syntaxhighlighter .bold {
  font-weight: bold !important;
}
.syntaxhighlighter .italic {
  font-style: italic !important;
}
.syntaxhighlighter .line {
  white-space: pre !important;
}
.syntaxhighlighter table {
/*    width: 100% !important;*/
}
.syntaxhighlighter table caption {
  text-align: left !important;
  padding: .5em 0 0.5em 1em !important;
}
.syntaxhighlighter table td.code {
  width: 100% !important;
}
.syntaxhighlighter table td.code .container {
  position: relative !important;
}
.syntaxhighlighter table td.code .container textarea {
  box-sizing: border-box !important;
  position: absolute !important;
  left: 0 !important;
  top: 0 !important;
  width: 100% !important;
  height: 100% !important;
  border: none !important;
  background: white !important;
  padding-left: 1em !important;
  overflow: hidden !important;
  white-space: pre !important;
}
.syntaxhighlighter table td.gutter .line {
  text-align: right !important;
  padding: 0 0.5em 0 1em !important;
}
.syntaxhighlighter table td.code .line {
  padding: 0 1em !important;
}
.syntaxhighlighter.nogutter td.code .container textarea, .syntaxhighlighter.nogutter td.code .line {
  padding-left: 0em !important;
}
.syntaxhighlighter.show {
  display: block !important;
}
.syntaxhighlighter.collapsed table {
  display: none !important;
}
.syntaxhighlighter.collapsed .toolbar {
    display: none;
/*  padding: 0.1em 0.8em 0em 0.8em !important;
  font-size: 1em !important;
  position: static !important;
  width: auto !important;
  height: auto !important;*/
}
.syntaxhighlighter.collapsed .toolbar span {
  display: inline !important;
  margin-right: 1em !important;
}
.syntaxhighlighter.collapsed .toolbar span a {
  padding: 0 !important;
  display: none !important;
}
.syntaxhighlighter.collapsed .toolbar span a.expandSource {
  display: inline !important;
}
.syntaxhighlighter .toolbar {
    display: none;
/*  position: absolute !important;
  right: 1px !important;
  top: 1px !important;
  width: 11px !important;
  height: 11px !important;
  font-size: 10px !important;
  z-index: 10 !important;*/
}
.syntaxhighlighter .toolbar span.title {
  display: inline !important;
}
.syntaxhighlighter .toolbar a {
  display: block !important;
  text-align: center !important;
  text-decoration: none !important;
  padding-top: 1px !important;
}
.syntaxhighlighter .toolbar a.expandSource {
  display: none !important;
}
.syntaxhighlighter.ie {
  font-size: .9em !important;
  padding: 1px 0 1px 0 !important;
}
.syntaxhighlighter.ie .toolbar {
  line-height: 8px !important;
}
.syntaxhighlighter.ie .toolbar a {
  padding-top: 0px !important;
}
.syntaxhighlighter.printing .line.alt1 .content,
.syntaxhighlighter.printing .line.alt2 .content,
.syntaxhighlighter.printing .line.highlighted .number,
.syntaxhighlighter.printing .line.highlighted.alt1 .content,
.syntaxhighlighter.printing .line.highlighted.alt2 .content {
  background: none !important;
}
.syntaxhighlighter.printing .line .number {
  color: #bbbbbb !important;
}
.syntaxhighlighter.printing .line .content {
  color: black !important;
}
.syntaxhighlighter.printing .toolbar {
  display: none !important;
}
.syntaxhighlighter.printing a {
  text-decoration: none !important;
}
.syntaxhighlighter.printing .plain, .syntaxhighlighter.printing .plain a {
  color: black !important;
}
.syntaxhighlighter.printing .comments, .syntaxhighlighter.printing .comments a {
  color: #008200 !important;
}
.syntaxhighlighter.printing .string, .syntaxhighlighter.printing .string a {
  color: blue !important;
}
.syntaxhighlighter.printing .keyword {
  color: #006699 !important;
  font-weight: bold !important;
}
.syntaxhighlighter.printing .preprocessor {
  color: gray !important;
}
.syntaxhighlighter.printing .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter.printing .value {
  color: #009900 !important;
}
.syntaxhighlighter.printing .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter.printing .constants {
  color: #0066cc !important;
}
.syntaxhighlighter.printing .script {
  font-weight: bold !important;
}
.syntaxhighlighter.printing .color1, .syntaxhighlighter.printing .color1 a {
  color: gray !important;
}
.syntaxhighlighter.printing .color2, .syntaxhighlighter.printing .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter.printing .color3, .syntaxhighlighter.printing .color3 a {
  color: red !important;
}
.syntaxhighlighter.printing .break, .syntaxhighlighter.printing .break a {
  color: black !important;
}
</style><style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style><style type="text/css">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
.syntaxhighlighter {
  background-color: transparent !important;
}
.syntaxhighlighter .line.alt1 {
  background-color: transparent !important;
}
.syntaxhighlighter .line.alt2 {
  background-color: transparent !important;
}
.syntaxhighlighter .line.highlighted.alt1, .syntaxhighlighter .line.highlighted.alt2 {
  background-color: #c3defe !important;
}
.syntaxhighlighter .line.highlighted.number {
  color: white !important;
}
.syntaxhighlighter table caption {
  color: black !important;
}
.syntaxhighlighter .gutter {
  color: #787878 !important;
}
.syntaxhighlighter .gutter .line {
  border-right: 3px solid #d4d0c8 !important;
}
.syntaxhighlighter .gutter .line.highlighted {
  background-color: #d4d0c8 !important;
  color: white !important;
}
.syntaxhighlighter.printing .line .content {
  border: none !important;
}
.syntaxhighlighter.collapsed {
  overflow: visible !important;
}
.syntaxhighlighter.collapsed .toolbar {
  color: #3f5fbf !important;
  background: white !important;
  border: 1px solid #d4d0c8 !important;
}
.syntaxhighlighter.collapsed .toolbar a {
  color: #3f5fbf !important;
}
.syntaxhighlighter.collapsed .toolbar a:hover {
  color: #aa7700 !important;
}
.syntaxhighlighter .toolbar {
  color: #a0a0a0 !important;
  background: #d4d0c8 !important;
  border: none !important;
}
.syntaxhighlighter .toolbar a {
  color: #a0a0a0 !important;
}
.syntaxhighlighter .toolbar a:hover {
  color: red !important;
}
.syntaxhighlighter .plain, .syntaxhighlighter .plain a {
  color: black !important;
}
.syntaxhighlighter .comments, .syntaxhighlighter .comments a {
  color: #3f5fbf !important;
}
.syntaxhighlighter .string, .syntaxhighlighter .string a {
  color: #2a00ff !important;
}
.syntaxhighlighter .keyword {
  color: #7f0055 !important;
}
.syntaxhighlighter .preprocessor {
  color: #646464 !important;
}
.syntaxhighlighter .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter .value {
  color: #009900 !important;
}
.syntaxhighlighter .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter .constants {
  color: #0066cc !important;
}
.syntaxhighlighter .script {
  font-weight: bold !important;
  color: #7f0055 !important;
  background-color: none !important;
}
.syntaxhighlighter .color1, .syntaxhighlighter .color1 a {
  color: gray !important;
}
.syntaxhighlighter .color2, .syntaxhighlighter .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter .color3, .syntaxhighlighter .color3 a {
  color: red !important;
}

.syntaxhighlighter .keyword {
  font-weight: bold !important;
}
.syntaxhighlighter .xml .keyword {
  color: #3f7f7f !important;
  font-weight: normal !important;
}
.syntaxhighlighter .xml .color1, .syntaxhighlighter .xml .color1 a {
  color: #7f007f !important;
}
.syntaxhighlighter .xml .string {
  font-style: italic !important;
  color: #2a00ff !important;
}
</style><style type="text/css">html{margin:0;padding:0;}h1{margin:0;padding:0;}h2{margin:0;padding:0;}h3{margin:0;padding:0;}h4{margin:0;padding:0;}a{color:#261A3B;}a:visited{color:#261A3B;}</style><style type="text/css">.header{margin-top:30px;}h1.project-name{font-size:34px;display:inline;}h2.project-version{font-size:18px;margin-top:0;display:inline;margin-left:10px;}.toc-link{font-size:12px;margin-left:10px;color:#252519;text-decoration:none;}.toc-link:hover{color:#5050A6;}.toc h1{font-size:34px;margin:0;}.docs-header{border-bottom:dotted #aaa 1px;padding-bottom:10px;margin-bottom:25px;}.toc h1{font-size:24px;}.toc{border-bottom:solid #bbb 1px;margin-bottom:40px;}.toc ul{margin-left:20px;padding-left:0px;padding-top:0;margin-top:0;}.toc li{list-style-type:none;padding-left:0;}.dependencies{}.dependencies table{font-size:16px;width:99.99%;border:none;margin-left:20px;}.dependencies td{padding-right:20px;;white-space:nowrap;}.dependencies .dotted{width:99%;}.dependencies .dotted hr{margin-bottom:-6px;noshade:noshade;border-top:none;color:transparent;border-left:none;border-bottom:dotted #bbb 1px;border-right:none;background-color:transparent;height:0;}.dependencies .dep-version{text-align:right;}.plugins ul{margin-left:20px;padding-left:0px;padding-top:0;margin-top:0;}.plugins li{list-style-type:none;padding-left:0;}.header p{margin-left:20px;}</style><style type="text/css">#floating-toc{position:fixed;top:10px;right:20px;height:20px;overflow:hidden;text-align:right;}#floating-toc li{list-style-type:none;margin:0;padding:0;}</style><style type="text/css">body{margin:0;padding:0;font-family:'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;;font-size:16px;color:#252519;}h1{font-size:20px;margin-top:0;}a.anchor{text-decoration:none;color:#252519;}a.anchor:hover{color:#5050A6;}table{border-spacing:0;border-bottom:solid #ddd 1px;;margin-bottom:10px;}code{display:inline;}p{margin-top:8px;}tr{margin:0px;padding:0px;}td.docs{width:410px;max-width:410px;vertical-align:top;margin:0px;padding-left:55px;padding-right:20px;border:none;}td.docs pre{font-size:12px;overflow:hidden;}td.codes{border:none;margin:0px;padding-left:20px;width:55%;border-left:solid #E5E5EE 1px;font-size:10pt;vertical-align:top;overflow:hidden;background-color:#F5F5FF;}td.spacer{padding-bottom:40px;}pre code{display:block;padding:4px;}code{background-color:ghostWhite;border:solid #DEDEDE 1px;padding-left:3px;padding-right:3px;font-size:14px;}.syntaxhighlighter code{font-size:13px;}.footer{text-align:center;}</style><script type="text/javascript">/*!
 * jQuery JavaScript Library v1.4.4
 * http://jquery.com/
 *
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2010, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Thu Nov 11 19:04:53 2010 -0500
 */
(function(E,B){function ka(a,b,d){if(d===B&&a.nodeType===1){d=a.getAttribute("data-"+b);if(typeof d==="string"){try{d=d==="true"?true:d==="false"?false:d==="null"?null:!c.isNaN(d)?parseFloat(d):Ja.test(d)?c.parseJSON(d):d}catch(e){}c.data(a,b,d)}else d=B}return d}function U(){return false}function ca(){return true}function la(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function Ka(a){var b,d,e,f,h,l,k,o,x,r,A,C=[];f=[];h=c.data(this,this.nodeType?"events":"__events__");if(typeof h==="function")h=
h.events;if(!(a.liveFired===this||!h||!h.live||a.button&&a.type==="click")){if(a.namespace)A=RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)");a.liveFired=this;var J=h.live.slice(0);for(k=0;k<J.length;k++){h=J[k];h.origType.replace(X,"")===a.type?f.push(h.selector):J.splice(k--,1)}f=c(a.target).closest(f,a.currentTarget);o=0;for(x=f.length;o<x;o++){r=f[o];for(k=0;k<J.length;k++){h=J[k];if(r.selector===h.selector&&(!A||A.test(h.namespace))){l=r.elem;e=null;if(h.preType==="mouseenter"||
h.preType==="mouseleave"){a.type=h.preType;e=c(a.relatedTarget).closest(h.selector)[0]}if(!e||e!==l)C.push({elem:l,handleObj:h,level:r.level})}}}o=0;for(x=C.length;o<x;o++){f=C[o];if(d&&f.level>d)break;a.currentTarget=f.elem;a.data=f.handleObj.data;a.handleObj=f.handleObj;A=f.handleObj.origHandler.apply(f.elem,arguments);if(A===false||a.isPropagationStopped()){d=f.level;if(A===false)b=false;if(a.isImmediatePropagationStopped())break}}return b}}function Y(a,b){return(a&&a!=="*"?a+".":"")+b.replace(La,
"`").replace(Ma,"&")}function ma(a,b,d){if(c.isFunction(b))return c.grep(a,function(f,h){return!!b.call(f,h,f)===d});else if(b.nodeType)return c.grep(a,function(f){return f===b===d});else if(typeof b==="string"){var e=c.grep(a,function(f){return f.nodeType===1});if(Na.test(b))return c.filter(b,e,!d);else b=c.filter(b,e)}return c.grep(a,function(f){return c.inArray(f,b)>=0===d})}function na(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var e=c.data(a[d++]),f=c.data(this,
e);if(e=e&&e.events){delete f.handle;f.events={};for(var h in e)for(var l in e[h])c.event.add(this,h,e[h][l],e[h][l].data)}}})}function Oa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:"script"}):c.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function oa(a,b,d){var e=b==="width"?a.offsetWidth:a.offsetHeight;if(d==="border")return e;c.each(b==="width"?Pa:Qa,function(){d||(e-=parseFloat(c.css(a,"padding"+this))||0);if(d==="margin")e+=parseFloat(c.css(a,
"margin"+this))||0;else e-=parseFloat(c.css(a,"border"+this+"Width"))||0});return e}function da(a,b,d,e){if(c.isArray(b)&&b.length)c.each(b,function(f,h){d||Ra.test(a)?e(a,h):da(a+"["+(typeof h==="object"||c.isArray(h)?f:"")+"]",h,d,e)});else if(!d&&b!=null&&typeof b==="object")c.isEmptyObject(b)?e(a,""):c.each(b,function(f,h){da(a+"["+f+"]",h,d,e)});else e(a,b)}function S(a,b){var d={};c.each(pa.concat.apply([],pa.slice(0,b)),function(){d[this]=a});return d}function qa(a){if(!ea[a]){var b=c("<"+
a+">").appendTo("body"),d=b.css("display");b.remove();if(d==="none"||d==="")d="block";ea[a]=d}return ea[a]}function fa(a){return c.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var t=E.document,c=function(){function a(){if(!b.isReady){try{t.documentElement.doScroll("left")}catch(j){setTimeout(a,1);return}b.ready()}}var b=function(j,s){return new b.fn.init(j,s)},d=E.jQuery,e=E.$,f,h=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/,l=/\S/,k=/^\s+/,o=/\s+$/,x=/\W/,r=/\d/,A=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,
C=/^[\],:{}\s]*$/,J=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,w=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,I=/(?:^|:|,)(?:\s*\[)+/g,L=/(webkit)[ \/]([\w.]+)/,g=/(opera)(?:.*version)?[ \/]([\w.]+)/,i=/(msie) ([\w.]+)/,n=/(mozilla)(?:.*? rv:([\w.]+))?/,m=navigator.userAgent,p=false,q=[],u,y=Object.prototype.toString,F=Object.prototype.hasOwnProperty,M=Array.prototype.push,N=Array.prototype.slice,O=String.prototype.trim,D=Array.prototype.indexOf,R={};b.fn=b.prototype={init:function(j,
s){var v,z,H;if(!j)return this;if(j.nodeType){this.context=this[0]=j;this.length=1;return this}if(j==="body"&&!s&&t.body){this.context=t;this[0]=t.body;this.selector="body";this.length=1;return this}if(typeof j==="string")if((v=h.exec(j))&&(v[1]||!s))if(v[1]){H=s?s.ownerDocument||s:t;if(z=A.exec(j))if(b.isPlainObject(s)){j=[t.createElement(z[1])];b.fn.attr.call(j,s,true)}else j=[H.createElement(z[1])];else{z=b.buildFragment([v[1]],[H]);j=(z.cacheable?z.fragment.cloneNode(true):z.fragment).childNodes}return b.merge(this,
j)}else{if((z=t.getElementById(v[2]))&&z.parentNode){if(z.id!==v[2])return f.find(j);this.length=1;this[0]=z}this.context=t;this.selector=j;return this}else if(!s&&!x.test(j)){this.selector=j;this.context=t;j=t.getElementsByTagName(j);return b.merge(this,j)}else return!s||s.jquery?(s||f).find(j):b(s).find(j);else if(b.isFunction(j))return f.ready(j);if(j.selector!==B){this.selector=j.selector;this.context=j.context}return b.makeArray(j,this)},selector:"",jquery:"1.4.4",length:0,size:function(){return this.length},
toArray:function(){return N.call(this,0)},get:function(j){return j==null?this.toArray():j<0?this.slice(j)[0]:this[j]},pushStack:function(j,s,v){var z=b();b.isArray(j)?M.apply(z,j):b.merge(z,j);z.prevObject=this;z.context=this.context;if(s==="find")z.selector=this.selector+(this.selector?" ":"")+v;else if(s)z.selector=this.selector+"."+s+"("+v+")";return z},each:function(j,s){return b.each(this,j,s)},ready:function(j){b.bindReady();if(b.isReady)j.call(t,b);else q&&q.push(j);return this},eq:function(j){return j===
-1?this.slice(j):this.slice(j,+j+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(N.apply(this,arguments),"slice",N.call(arguments).join(","))},map:function(j){return this.pushStack(b.map(this,function(s,v){return j.call(s,v,s)}))},end:function(){return this.prevObject||b(null)},push:M,sort:[].sort,splice:[].splice};b.fn.init.prototype=b.fn;b.extend=b.fn.extend=function(){var j,s,v,z,H,G=arguments[0]||{},K=1,Q=arguments.length,ga=false;
if(typeof G==="boolean"){ga=G;G=arguments[1]||{};K=2}if(typeof G!=="object"&&!b.isFunction(G))G={};if(Q===K){G=this;--K}for(;K<Q;K++)if((j=arguments[K])!=null)for(s in j){v=G[s];z=j[s];if(G!==z)if(ga&&z&&(b.isPlainObject(z)||(H=b.isArray(z)))){if(H){H=false;v=v&&b.isArray(v)?v:[]}else v=v&&b.isPlainObject(v)?v:{};G[s]=b.extend(ga,v,z)}else if(z!==B)G[s]=z}return G};b.extend({noConflict:function(j){E.$=e;if(j)E.jQuery=d;return b},isReady:false,readyWait:1,ready:function(j){j===true&&b.readyWait--;
if(!b.readyWait||j!==true&&!b.isReady){if(!t.body)return setTimeout(b.ready,1);b.isReady=true;if(!(j!==true&&--b.readyWait>0))if(q){var s=0,v=q;for(q=null;j=v[s++];)j.call(t,b);b.fn.trigger&&b(t).trigger("ready").unbind("ready")}}},bindReady:function(){if(!p){p=true;if(t.readyState==="complete")return setTimeout(b.ready,1);if(t.addEventListener){t.addEventListener("DOMContentLoaded",u,false);E.addEventListener("load",b.ready,false)}else if(t.attachEvent){t.attachEvent("onreadystatechange",u);E.attachEvent("onload",
b.ready);var j=false;try{j=E.frameElement==null}catch(s){}t.documentElement.doScroll&&j&&a()}}},isFunction:function(j){return b.type(j)==="function"},isArray:Array.isArray||function(j){return b.type(j)==="array"},isWindow:function(j){return j&&typeof j==="object"&&"setInterval"in j},isNaN:function(j){return j==null||!r.test(j)||isNaN(j)},type:function(j){return j==null?String(j):R[y.call(j)]||"object"},isPlainObject:function(j){if(!j||b.type(j)!=="object"||j.nodeType||b.isWindow(j))return false;if(j.constructor&&
!F.call(j,"constructor")&&!F.call(j.constructor.prototype,"isPrototypeOf"))return false;for(var s in j);return s===B||F.call(j,s)},isEmptyObject:function(j){for(var s in j)return false;return true},error:function(j){throw j;},parseJSON:function(j){if(typeof j!=="string"||!j)return null;j=b.trim(j);if(C.test(j.replace(J,"@").replace(w,"]").replace(I,"")))return E.JSON&&E.JSON.parse?E.JSON.parse(j):(new Function("return "+j))();else b.error("Invalid JSON: "+j)},noop:function(){},globalEval:function(j){if(j&&
l.test(j)){var s=t.getElementsByTagName("head")[0]||t.documentElement,v=t.createElement("script");v.type="text/javascript";if(b.support.scriptEval)v.appendChild(t.createTextNode(j));else v.text=j;s.insertBefore(v,s.firstChild);s.removeChild(v)}},nodeName:function(j,s){return j.nodeName&&j.nodeName.toUpperCase()===s.toUpperCase()},each:function(j,s,v){var z,H=0,G=j.length,K=G===B||b.isFunction(j);if(v)if(K)for(z in j){if(s.apply(j[z],v)===false)break}else for(;H<G;){if(s.apply(j[H++],v)===false)break}else if(K)for(z in j){if(s.call(j[z],
z,j[z])===false)break}else for(v=j[0];H<G&&s.call(v,H,v)!==false;v=j[++H]);return j},trim:O?function(j){return j==null?"":O.call(j)}:function(j){return j==null?"":j.toString().replace(k,"").replace(o,"")},makeArray:function(j,s){var v=s||[];if(j!=null){var z=b.type(j);j.length==null||z==="string"||z==="function"||z==="regexp"||b.isWindow(j)?M.call(v,j):b.merge(v,j)}return v},inArray:function(j,s){if(s.indexOf)return s.indexOf(j);for(var v=0,z=s.length;v<z;v++)if(s[v]===j)return v;return-1},merge:function(j,
s){var v=j.length,z=0;if(typeof s.length==="number")for(var H=s.length;z<H;z++)j[v++]=s[z];else for(;s[z]!==B;)j[v++]=s[z++];j.length=v;return j},grep:function(j,s,v){var z=[],H;v=!!v;for(var G=0,K=j.length;G<K;G++){H=!!s(j[G],G);v!==H&&z.push(j[G])}return z},map:function(j,s,v){for(var z=[],H,G=0,K=j.length;G<K;G++){H=s(j[G],G,v);if(H!=null)z[z.length]=H}return z.concat.apply([],z)},guid:1,proxy:function(j,s,v){if(arguments.length===2)if(typeof s==="string"){v=j;j=v[s];s=B}else if(s&&!b.isFunction(s)){v=
s;s=B}if(!s&&j)s=function(){return j.apply(v||this,arguments)};if(j)s.guid=j.guid=j.guid||s.guid||b.guid++;return s},access:function(j,s,v,z,H,G){var K=j.length;if(typeof s==="object"){for(var Q in s)b.access(j,Q,s[Q],z,H,v);return j}if(v!==B){z=!G&&z&&b.isFunction(v);for(Q=0;Q<K;Q++)H(j[Q],s,z?v.call(j[Q],Q,H(j[Q],s)):v,G);return j}return K?H(j[0],s):B},now:function(){return(new Date).getTime()},uaMatch:function(j){j=j.toLowerCase();j=L.exec(j)||g.exec(j)||i.exec(j)||j.indexOf("compatible")<0&&n.exec(j)||
[];return{browser:j[1]||"",version:j[2]||"0"}},browser:{}});b.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(j,s){R["[object "+s+"]"]=s.toLowerCase()});m=b.uaMatch(m);if(m.browser){b.browser[m.browser]=true;b.browser.version=m.version}if(b.browser.webkit)b.browser.safari=true;if(D)b.inArray=function(j,s){return D.call(s,j)};if(!/\s/.test("\u00a0")){k=/^[\s\xA0]+/;o=/[\s\xA0]+$/}f=b(t);if(t.addEventListener)u=function(){t.removeEventListener("DOMContentLoaded",u,
false);b.ready()};else if(t.attachEvent)u=function(){if(t.readyState==="complete"){t.detachEvent("onreadystatechange",u);b.ready()}};return E.jQuery=E.$=b}();(function(){c.support={};var a=t.documentElement,b=t.createElement("script"),d=t.createElement("div"),e="script"+c.now();d.style.display="none";d.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var f=d.getElementsByTagName("*"),h=d.getElementsByTagName("a")[0],l=t.createElement("select"),
k=l.appendChild(t.createElement("option"));if(!(!f||!f.length||!h)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/red/.test(h.getAttribute("style")),hrefNormalized:h.getAttribute("href")==="/a",opacity:/^0.55$/.test(h.style.opacity),cssFloat:!!h.style.cssFloat,checkOn:d.getElementsByTagName("input")[0].value==="on",optSelected:k.selected,deleteExpando:true,optDisabled:false,checkClone:false,
scriptEval:false,noCloneEvent:true,boxModel:null,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableHiddenOffsets:true};l.disabled=true;c.support.optDisabled=!k.disabled;b.type="text/javascript";try{b.appendChild(t.createTextNode("window."+e+"=1;"))}catch(o){}a.insertBefore(b,a.firstChild);if(E[e]){c.support.scriptEval=true;delete E[e]}try{delete b.test}catch(x){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent("onclick",function r(){c.support.noCloneEvent=
false;d.detachEvent("onclick",r)});d.cloneNode(true).fireEvent("onclick")}d=t.createElement("div");d.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=t.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var r=t.createElement("div");r.style.width=r.style.paddingLeft="1px";t.body.appendChild(r);c.boxModel=c.support.boxModel=r.offsetWidth===2;if("zoom"in r.style){r.style.display="inline";r.style.zoom=
1;c.support.inlineBlockNeedsLayout=r.offsetWidth===2;r.style.display="";r.innerHTML="<div style='width:4px;'></div>";c.support.shrinkWrapBlocks=r.offsetWidth!==2}r.innerHTML="<table><tr><td style='padding:0;display:none'></td><td>t</td></tr></table>";var A=r.getElementsByTagName("td");c.support.reliableHiddenOffsets=A[0].offsetHeight===0;A[0].style.display="";A[1].style.display="none";c.support.reliableHiddenOffsets=c.support.reliableHiddenOffsets&&A[0].offsetHeight===0;r.innerHTML="";t.body.removeChild(r).style.display=
"none"});a=function(r){var A=t.createElement("div");r="on"+r;var C=r in A;if(!C){A.setAttribute(r,"return;");C=typeof A[r]==="function"}return C};c.support.submitBubbles=a("submit");c.support.changeBubbles=a("change");a=b=d=f=h=null}})();var ra={},Ja=/^(?:\{.*\}|\[.*\])$/;c.extend({cache:{},uuid:0,expando:"jQuery"+c.now(),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},data:function(a,b,d){if(c.acceptData(a)){a=a==E?ra:a;var e=a.nodeType,f=e?a[c.expando]:null,h=
c.cache;if(!(e&&!f&&typeof b==="string"&&d===B)){if(e)f||(a[c.expando]=f=++c.uuid);else h=a;if(typeof b==="object")if(e)h[f]=c.extend(h[f],b);else c.extend(h,b);else if(e&&!h[f])h[f]={};a=e?h[f]:h;if(d!==B)a[b]=d;return typeof b==="string"?a[b]:a}}},removeData:function(a,b){if(c.acceptData(a)){a=a==E?ra:a;var d=a.nodeType,e=d?a[c.expando]:a,f=c.cache,h=d?f[e]:e;if(b){if(h){delete h[b];d&&c.isEmptyObject(h)&&c.removeData(a)}}else if(d&&c.support.deleteExpando)delete a[c.expando];else if(a.removeAttribute)a.removeAttribute(c.expando);
else if(d)delete f[e];else for(var l in a)delete a[l]}},acceptData:function(a){if(a.nodeName){var b=c.noData[a.nodeName.toLowerCase()];if(b)return!(b===true||a.getAttribute("classid")!==b)}return true}});c.fn.extend({data:function(a,b){var d=null;if(typeof a==="undefined"){if(this.length){var e=this[0].attributes,f;d=c.data(this[0]);for(var h=0,l=e.length;h<l;h++){f=e[h].name;if(f.indexOf("data-")===0){f=f.substr(5);ka(this[0],f,d[f])}}}return d}else if(typeof a==="object")return this.each(function(){c.data(this,
a)});var k=a.split(".");k[1]=k[1]?"."+k[1]:"";if(b===B){d=this.triggerHandler("getData"+k[1]+"!",[k[0]]);if(d===B&&this.length){d=c.data(this[0],a);d=ka(this[0],a,d)}return d===B&&k[1]?this.data(k[0]):d}else return this.each(function(){var o=c(this),x=[k[0],b];o.triggerHandler("setData"+k[1]+"!",x);c.data(this,a,b);o.triggerHandler("changeData"+k[1]+"!",x)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||"fx")+"queue";var e=
c.data(a,b);if(!d)return e||[];if(!e||c.isArray(d))e=c.data(a,b,c.makeArray(d));else e.push(d);return e}},dequeue:function(a,b){b=b||"fx";var d=c.queue(a,b),e=d.shift();if(e==="inprogress")e=d.shift();if(e){b==="fx"&&d.unshift("inprogress");e.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===B)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,
a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var sa=/[\n\t]/g,ha=/\s+/,Sa=/\r/g,Ta=/^(?:href|src|style)$/,Ua=/^(?:button|input)$/i,Va=/^(?:button|input|object|select|textarea)$/i,Wa=/^a(?:rea)?$/i,ta=/^(?:radio|checkbox)$/i;c.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",
colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};c.fn.extend({attr:function(a,b){return c.access(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(x){var r=c(this);r.addClass(a.call(this,x,r.attr("class")))});if(a&&typeof a==="string")for(var b=(a||"").split(ha),d=0,e=this.length;d<e;d++){var f=this[d];if(f.nodeType===
1)if(f.className){for(var h=" "+f.className+" ",l=f.className,k=0,o=b.length;k<o;k++)if(h.indexOf(" "+b[k]+" ")<0)l+=" "+b[k];f.className=c.trim(l)}else f.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(o){var x=c(this);x.removeClass(a.call(this,o,x.attr("class")))});if(a&&typeof a==="string"||a===B)for(var b=(a||"").split(ha),d=0,e=this.length;d<e;d++){var f=this[d];if(f.nodeType===1&&f.className)if(a){for(var h=(" "+f.className+" ").replace(sa," "),
l=0,k=b.length;l<k;l++)h=h.replace(" "+b[l]+" "," ");f.className=c.trim(h)}else f.className=""}return this},toggleClass:function(a,b){var d=typeof a,e=typeof b==="boolean";if(c.isFunction(a))return this.each(function(f){var h=c(this);h.toggleClass(a.call(this,f,h.attr("class"),b),b)});return this.each(function(){if(d==="string")for(var f,h=0,l=c(this),k=b,o=a.split(ha);f=o[h++];){k=e?k:!l.hasClass(f);l[k?"addClass":"removeClass"](f)}else if(d==="undefined"||d==="boolean"){this.className&&c.data(this,
"__className__",this.className);this.className=this.className||a===false?"":c.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,d=this.length;b<d;b++)if((" "+this[b].className+" ").replace(sa," ").indexOf(a)>-1)return true;return false},val:function(a){if(!arguments.length){var b=this[0];if(b){if(c.nodeName(b,"option")){var d=b.attributes.value;return!d||d.specified?b.value:b.text}if(c.nodeName(b,"select")){var e=b.selectedIndex;d=[];var f=b.options;b=b.type==="select-one";
if(e<0)return null;var h=b?e:0;for(e=b?e+1:f.length;h<e;h++){var l=f[h];if(l.selected&&(c.support.optDisabled?!l.disabled:l.getAttribute("disabled")===null)&&(!l.parentNode.disabled||!c.nodeName(l.parentNode,"optgroup"))){a=c(l).val();if(b)return a;d.push(a)}}return d}if(ta.test(b.type)&&!c.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Sa,"")}return B}var k=c.isFunction(a);return this.each(function(o){var x=c(this),r=a;if(this.nodeType===1){if(k)r=
a.call(this,o,x.val());if(r==null)r="";else if(typeof r==="number")r+="";else if(c.isArray(r))r=c.map(r,function(C){return C==null?"":C+""});if(c.isArray(r)&&ta.test(this.type))this.checked=c.inArray(x.val(),r)>=0;else if(c.nodeName(this,"select")){var A=c.makeArray(r);c("option",this).each(function(){this.selected=c.inArray(c(this).val(),A)>=0});if(!A.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},
attr:function(a,b,d,e){if(!a||a.nodeType===3||a.nodeType===8)return B;if(e&&b in c.attrFn)return c(a)[b](d);e=a.nodeType!==1||!c.isXMLDoc(a);var f=d!==B;b=e&&c.props[b]||b;var h=Ta.test(b);if((b in a||a[b]!==B)&&e&&!h){if(f){b==="type"&&Ua.test(a.nodeName)&&a.parentNode&&c.error("type property can't be changed");if(d===null)a.nodeType===1&&a.removeAttribute(b);else a[b]=d}if(c.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&
b.specified?b.value:Va.test(a.nodeName)||Wa.test(a.nodeName)&&a.href?0:B;return a[b]}if(!c.support.style&&e&&b==="style"){if(f)a.style.cssText=""+d;return a.style.cssText}f&&a.setAttribute(b,""+d);if(!a.attributes[b]&&a.hasAttribute&&!a.hasAttribute(b))return B;a=!c.support.hrefNormalized&&e&&h?a.getAttribute(b,2):a.getAttribute(b);return a===null?B:a}});var X=/\.(.*)$/,ia=/^(?:textarea|input|select)$/i,La=/\./g,Ma=/ /g,Xa=/[^\w\s.|`]/g,Ya=function(a){return a.replace(Xa,"\\$&")},ua={focusin:0,focusout:0};
c.event={add:function(a,b,d,e){if(!(a.nodeType===3||a.nodeType===8)){if(c.isWindow(a)&&a!==E&&!a.frameElement)a=E;if(d===false)d=U;else if(!d)return;var f,h;if(d.handler){f=d;d=f.handler}if(!d.guid)d.guid=c.guid++;if(h=c.data(a)){var l=a.nodeType?"events":"__events__",k=h[l],o=h.handle;if(typeof k==="function"){o=k.handle;k=k.events}else if(!k){a.nodeType||(h[l]=h=function(){});h.events=k={}}if(!o)h.handle=o=function(){return typeof c!=="undefined"&&!c.event.triggered?c.event.handle.apply(o.elem,
arguments):B};o.elem=a;b=b.split(" ");for(var x=0,r;l=b[x++];){h=f?c.extend({},f):{handler:d,data:e};if(l.indexOf(".")>-1){r=l.split(".");l=r.shift();h.namespace=r.slice(0).sort().join(".")}else{r=[];h.namespace=""}h.type=l;if(!h.guid)h.guid=d.guid;var A=k[l],C=c.event.special[l]||{};if(!A){A=k[l]=[];if(!C.setup||C.setup.call(a,e,r,o)===false)if(a.addEventListener)a.addEventListener(l,o,false);else a.attachEvent&&a.attachEvent("on"+l,o)}if(C.add){C.add.call(a,h);if(!h.handler.guid)h.handler.guid=
d.guid}A.push(h);c.event.global[l]=true}a=null}}},global:{},remove:function(a,b,d,e){if(!(a.nodeType===3||a.nodeType===8)){if(d===false)d=U;var f,h,l=0,k,o,x,r,A,C,J=a.nodeType?"events":"__events__",w=c.data(a),I=w&&w[J];if(w&&I){if(typeof I==="function"){w=I;I=I.events}if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(f in I)c.event.remove(a,f+b)}else{for(b=b.split(" ");f=b[l++];){r=f;k=f.indexOf(".")<0;o=[];if(!k){o=f.split(".");f=o.shift();x=RegExp("(^|\\.)"+
c.map(o.slice(0).sort(),Ya).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(A=I[f])if(d){r=c.event.special[f]||{};for(h=e||0;h<A.length;h++){C=A[h];if(d.guid===C.guid){if(k||x.test(C.namespace)){e==null&&A.splice(h--,1);r.remove&&r.remove.call(a,C)}if(e!=null)break}}if(A.length===0||e!=null&&A.length===1){if(!r.teardown||r.teardown.call(a,o)===false)c.removeEvent(a,f,w.handle);delete I[f]}}else for(h=0;h<A.length;h++){C=A[h];if(k||x.test(C.namespace)){c.event.remove(a,r,C.handler,h);A.splice(h--,1)}}}if(c.isEmptyObject(I)){if(b=
w.handle)b.elem=null;delete w.events;delete w.handle;if(typeof w==="function")c.removeData(a,J);else c.isEmptyObject(w)&&c.removeData(a)}}}}},trigger:function(a,b,d,e){var f=a.type||a;if(!e){a=typeof a==="object"?a[c.expando]?a:c.extend(c.Event(f),a):c.Event(f);if(f.indexOf("!")>=0){a.type=f=f.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[f]&&c.each(c.cache,function(){this.events&&this.events[f]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===
8)return B;a.result=B;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(e=d.nodeType?c.data(d,"handle"):(c.data(d,"__events__")||{}).handle)&&e.apply(d,b);e=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d["on"+f]&&d["on"+f].apply(d,b)===false){a.result=false;a.preventDefault()}}catch(h){}if(!a.isPropagationStopped()&&e)c.event.trigger(a,b,e,true);else if(!a.isDefaultPrevented()){var l;e=a.target;var k=f.replace(X,""),o=c.nodeName(e,"a")&&k===
"click",x=c.event.special[k]||{};if((!x._default||x._default.call(d,a)===false)&&!o&&!(e&&e.nodeName&&c.noData[e.nodeName.toLowerCase()])){try{if(e[k]){if(l=e["on"+k])e["on"+k]=null;c.event.triggered=true;e[k]()}}catch(r){}if(l)e["on"+k]=l;c.event.triggered=false}}},handle:function(a){var b,d,e,f;d=[];var h=c.makeArray(arguments);a=h[0]=c.event.fix(a||E.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;if(!b){e=a.type.split(".");a.type=e.shift();d=e.slice(0).sort();e=RegExp("(^|\\.)"+
d.join("\\.(?:.*\\.)?")+"(\\.|$)")}a.namespace=a.namespace||d.join(".");f=c.data(this,this.nodeType?"events":"__events__");if(typeof f==="function")f=f.events;d=(f||{})[a.type];if(f&&d){d=d.slice(0);f=0;for(var l=d.length;f<l;f++){var k=d[f];if(b||e.test(k.namespace)){a.handler=k.handler;a.data=k.data;a.handleObj=k;k=k.handler.apply(this,h);if(k!==B){a.result=k;if(k===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[c.expando])return a;var b=a;a=c.Event(b);for(var d=this.props.length,e;d;){e=this.props[--d];a[e]=b[e]}if(!a.target)a.target=a.srcElement||t;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=t.documentElement;d=t.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||
d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(a.which==null&&(a.charCode!=null||a.keyCode!=null))a.which=a.charCode!=null?a.charCode:a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==B)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,Y(a.origType,a.selector),c.extend({},a,{handler:Ka,guid:a.handler.guid}))},remove:function(a){c.event.remove(this,
Y(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,d){if(c.isWindow(this))this.onbeforeunload=d},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};c.removeEvent=t.removeEventListener?function(a,b,d){a.removeEventListener&&a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent&&a.detachEvent("on"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=a;this.type=a.type}else this.type=a;this.timeStamp=
c.now();this[c.expando]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=ca;var a=this.originalEvent;if(a)if(a.preventDefault)a.preventDefault();else a.returnValue=false},stopPropagation:function(){this.isPropagationStopped=ca;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ca;this.stopPropagation()},isDefaultPrevented:U,isPropagationStopped:U,isImmediatePropagationStopped:U};
var va=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},wa=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?wa:va,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?wa:va)}}});if(!c.support.submitBubbles)c.event.special.submit={setup:function(){if(this.nodeName.toLowerCase()!==
"form"){c.event.add(this,"click.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="submit"||d==="image")&&c(b).closest("form").length){a.liveFired=B;return la("submit",this,arguments)}});c.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="text"||d==="password")&&c(b).closest("form").length&&a.keyCode===13){a.liveFired=B;return la("submit",this,arguments)}})}else return false},teardown:function(){c.event.remove(this,".specialSubmit")}};if(!c.support.changeBubbles){var V,
xa=function(a){var b=a.type,d=a.value;if(b==="radio"||b==="checkbox")d=a.checked;else if(b==="select-multiple")d=a.selectedIndex>-1?c.map(a.options,function(e){return e.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")d=a.selectedIndex;return d},Z=function(a,b){var d=a.target,e,f;if(!(!ia.test(d.nodeName)||d.readOnly)){e=c.data(d,"_change_data");f=xa(d);if(a.type!=="focusout"||d.type!=="radio")c.data(d,"_change_data",f);if(!(e===B||f===e))if(e!=null||f){a.type="change";a.liveFired=
B;return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:Z,beforedeactivate:Z,click:function(a){var b=a.target,d=b.type;if(d==="radio"||d==="checkbox"||b.nodeName.toLowerCase()==="select")return Z.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(d==="checkbox"||d==="radio")||d==="select-multiple")return Z.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,"_change_data",xa(a))}},setup:function(){if(this.type===
"file")return false;for(var a in V)c.event.add(this,a+".specialChange",V[a]);return ia.test(this.nodeName)},teardown:function(){c.event.remove(this,".specialChange");return ia.test(this.nodeName)}};V=c.event.special.change.filters;V.focus=V.beforeactivate}t.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(e){e=c.event.fix(e);e.type=b;return c.event.trigger(e,null,e.target)}c.event.special[b]={setup:function(){ua[b]++===0&&t.addEventListener(a,d,true)},teardown:function(){--ua[b]===
0&&t.removeEventListener(a,d,true)}}});c.each(["bind","one"],function(a,b){c.fn[b]=function(d,e,f){if(typeof d==="object"){for(var h in d)this[b](h,e,d[h],f);return this}if(c.isFunction(e)||e===false){f=e;e=B}var l=b==="one"?c.proxy(f,function(o){c(this).unbind(o,l);return f.apply(this,arguments)}):f;if(d==="unload"&&b!=="one")this.one(d,e,f);else{h=0;for(var k=this.length;h<k;h++)c.event.add(this[h],d,l,e)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a==="object"&&!a.preventDefault)for(var d in a)this.unbind(d,
a[d]);else{d=0;for(var e=this.length;d<e;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,e){return this.live(b,d,e,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind("live"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){var d=c.Event(a);d.preventDefault();d.stopPropagation();c.event.trigger(d,b,this[0]);return d.result}},toggle:function(a){for(var b=arguments,d=
1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(e){var f=(c.data(this,"lastToggle"+a.guid)||0)%d;c.data(this,"lastToggle"+a.guid,f+1);e.preventDefault();return b[f].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var ya={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};c.each(["live","die"],function(a,b){c.fn[b]=function(d,e,f,h){var l,k=0,o,x,r=h||this.selector;h=h?this:c(this.context);if(typeof d===
"object"&&!d.preventDefault){for(l in d)h[b](l,e,d[l],r);return this}if(c.isFunction(e)){f=e;e=B}for(d=(d||"").split(" ");(l=d[k++])!=null;){o=X.exec(l);x="";if(o){x=o[0];l=l.replace(X,"")}if(l==="hover")d.push("mouseenter"+x,"mouseleave"+x);else{o=l;if(l==="focus"||l==="blur"){d.push(ya[l]+x);l+=x}else l=(ya[l]||l)+x;if(b==="live"){x=0;for(var A=h.length;x<A;x++)c.event.add(h[x],"live."+Y(l,r),{data:e,selector:r,handler:f,origType:l,origHandler:f,preType:o})}else h.unbind("live."+Y(l,r),f)}}return this}});
c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){c.fn[b]=function(d,e){if(e==null){e=d;d=null}return arguments.length>0?this.bind(b,d,e):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});E.attachEvent&&!E.addEventListener&&c(E).bind("unload",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});
(function(){function a(g,i,n,m,p,q){p=0;for(var u=m.length;p<u;p++){var y=m[p];if(y){var F=false;for(y=y[g];y;){if(y.sizcache===n){F=m[y.sizset];break}if(y.nodeType===1&&!q){y.sizcache=n;y.sizset=p}if(y.nodeName.toLowerCase()===i){F=y;break}y=y[g]}m[p]=F}}}function b(g,i,n,m,p,q){p=0;for(var u=m.length;p<u;p++){var y=m[p];if(y){var F=false;for(y=y[g];y;){if(y.sizcache===n){F=m[y.sizset];break}if(y.nodeType===1){if(!q){y.sizcache=n;y.sizset=p}if(typeof i!=="string"){if(y===i){F=true;break}}else if(k.filter(i,
[y]).length>0){F=y;break}}y=y[g]}m[p]=F}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,h=false,l=true;[0,0].sort(function(){l=false;return 0});var k=function(g,i,n,m){n=n||[];var p=i=i||t;if(i.nodeType!==1&&i.nodeType!==9)return[];if(!g||typeof g!=="string")return n;var q,u,y,F,M,N=true,O=k.isXML(i),D=[],R=g;do{d.exec("");if(q=d.exec(R)){R=q[3];D.push(q[1]);if(q[2]){F=q[3];
break}}}while(q);if(D.length>1&&x.exec(g))if(D.length===2&&o.relative[D[0]])u=L(D[0]+D[1],i);else for(u=o.relative[D[0]]?[i]:k(D.shift(),i);D.length;){g=D.shift();if(o.relative[g])g+=D.shift();u=L(g,u)}else{if(!m&&D.length>1&&i.nodeType===9&&!O&&o.match.ID.test(D[0])&&!o.match.ID.test(D[D.length-1])){q=k.find(D.shift(),i,O);i=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]}if(i){q=m?{expr:D.pop(),set:C(m)}:k.find(D.pop(),D.length===1&&(D[0]==="~"||D[0]==="+")&&i.parentNode?i.parentNode:i,O);u=q.expr?k.filter(q.expr,
q.set):q.set;if(D.length>0)y=C(u);else N=false;for(;D.length;){q=M=D.pop();if(o.relative[M])q=D.pop();else M="";if(q==null)q=i;o.relative[M](y,q,O)}}else y=[]}y||(y=u);y||k.error(M||g);if(f.call(y)==="[object Array]")if(N)if(i&&i.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&k.contains(i,y[g])))n.push(u[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&n.push(u[g]);else n.push.apply(n,y);else C(y,n);if(F){k(F,p,n,m);k.uniqueSort(n)}return n};k.uniqueSort=function(g){if(w){h=
l;g.sort(w);if(h)for(var i=1;i<g.length;i++)g[i]===g[i-1]&&g.splice(i--,1)}return g};k.matches=function(g,i){return k(g,null,null,i)};k.matchesSelector=function(g,i){return k(i,null,null,[g]).length>0};k.find=function(g,i,n){var m;if(!g)return[];for(var p=0,q=o.order.length;p<q;p++){var u,y=o.order[p];if(u=o.leftMatch[y].exec(g)){var F=u[1];u.splice(1,1);if(F.substr(F.length-1)!=="\\"){u[1]=(u[1]||"").replace(/\\/g,"");m=o.find[y](u,i,n);if(m!=null){g=g.replace(o.match[y],"");break}}}}m||(m=i.getElementsByTagName("*"));
return{set:m,expr:g}};k.filter=function(g,i,n,m){for(var p,q,u=g,y=[],F=i,M=i&&i[0]&&k.isXML(i[0]);g&&i.length;){for(var N in o.filter)if((p=o.leftMatch[N].exec(g))!=null&&p[2]){var O,D,R=o.filter[N];D=p[1];q=false;p.splice(1,1);if(D.substr(D.length-1)!=="\\"){if(F===y)y=[];if(o.preFilter[N])if(p=o.preFilter[N](p,F,n,y,m,M)){if(p===true)continue}else q=O=true;if(p)for(var j=0;(D=F[j])!=null;j++)if(D){O=R(D,p,j,F);var s=m^!!O;if(n&&O!=null)if(s)q=true;else F[j]=false;else if(s){y.push(D);q=true}}if(O!==
B){n||(F=y);g=g.replace(o.match[N],"");if(!q)return[];break}}}if(g===u)if(q==null)k.error(g);else break;u=g}return F};k.error=function(g){throw"Syntax error, unrecognized expression: "+g;};var o=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},relative:{"+":function(g,i){var n=typeof i==="string",m=n&&!/\W/.test(i);n=n&&!m;if(m)i=i.toLowerCase();m=0;for(var p=g.length,q;m<p;m++)if(q=g[m]){for(;(q=q.previousSibling)&&q.nodeType!==1;);g[m]=n||q&&q.nodeName.toLowerCase()===
i?q||false:q===i}n&&k.filter(i,g,true)},">":function(g,i){var n,m=typeof i==="string",p=0,q=g.length;if(m&&!/\W/.test(i))for(i=i.toLowerCase();p<q;p++){if(n=g[p]){n=n.parentNode;g[p]=n.nodeName.toLowerCase()===i?n:false}}else{for(;p<q;p++)if(n=g[p])g[p]=m?n.parentNode:n.parentNode===i;m&&k.filter(i,g,true)}},"":function(g,i,n){var m,p=e++,q=b;if(typeof i==="string"&&!/\W/.test(i)){m=i=i.toLowerCase();q=a}q("parentNode",i,p,g,m,n)},"~":function(g,i,n){var m,p=e++,q=b;if(typeof i==="string"&&!/\W/.test(i)){m=
i=i.toLowerCase();q=a}q("previousSibling",i,p,g,m,n)}},find:{ID:function(g,i,n){if(typeof i.getElementById!=="undefined"&&!n)return(g=i.getElementById(g[1]))&&g.parentNode?[g]:[]},NAME:function(g,i){if(typeof i.getElementsByName!=="undefined"){for(var n=[],m=i.getElementsByName(g[1]),p=0,q=m.length;p<q;p++)m[p].getAttribute("name")===g[1]&&n.push(m[p]);return n.length===0?null:n}},TAG:function(g,i){return i.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,i,n,m,p,q){g=" "+g[1].replace(/\\/g,
"")+" ";if(q)return g;q=0;for(var u;(u=i[q])!=null;q++)if(u)if(p^(u.className&&(" "+u.className+" ").replace(/[\t\n]/g," ").indexOf(g)>=0))n||m.push(u);else if(n)i[q]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g){return g[1].toLowerCase()},CHILD:function(g){if(g[1]==="nth"){var i=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=i[1]+(i[2]||1)-0;g[3]=i[3]-0}g[0]=e++;return g},ATTR:function(g,i,n,
m,p,q){i=g[1].replace(/\\/g,"");if(!q&&o.attrMap[i])g[1]=o.attrMap[i];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,i,n,m,p){if(g[1]==="not")if((d.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=k(g[3],null,null,i);else{g=k.filter(g[3],i,n,true^p);n||m.push.apply(m,g);return false}else if(o.match.POS.test(g[0])||o.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!=="hidden"},disabled:function(g){return g.disabled===
true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,i,n){return!!k(n[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===
g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toLowerCase()==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},setFilters:{first:function(g,i){return i===0},last:function(g,i,n,m){return i===m.length-1},even:function(g,i){return i%2===0},odd:function(g,i){return i%2===1},lt:function(g,i,n){return i<n[3]-0},gt:function(g,i,n){return i>n[3]-0},nth:function(g,i,n){return n[3]-
0===i},eq:function(g,i,n){return n[3]-0===i}},filter:{PSEUDO:function(g,i,n,m){var p=i[1],q=o.filters[p];if(q)return q(g,n,i,m);else if(p==="contains")return(g.textContent||g.innerText||k.getText([g])||"").indexOf(i[3])>=0;else if(p==="not"){i=i[3];n=0;for(m=i.length;n<m;n++)if(i[n]===g)return false;return true}else k.error("Syntax error, unrecognized expression: "+p)},CHILD:function(g,i){var n=i[1],m=g;switch(n){case "only":case "first":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(n===
"first")return true;m=g;case "last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case "nth":n=i[2];var p=i[3];if(n===1&&p===0)return true;var q=i[0],u=g.parentNode;if(u&&(u.sizcache!==q||!g.nodeIndex)){var y=0;for(m=u.firstChild;m;m=m.nextSibling)if(m.nodeType===1)m.nodeIndex=++y;u.sizcache=q}m=g.nodeIndex-p;return n===0?m===0:m%n===0&&m/n>=0}},ID:function(g,i){return g.nodeType===1&&g.getAttribute("id")===i},TAG:function(g,i){return i==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===
i},CLASS:function(g,i){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(i)>-1},ATTR:function(g,i){var n=i[1];n=o.attrHandle[n]?o.attrHandle[n](g):g[n]!=null?g[n]:g.getAttribute(n);var m=n+"",p=i[2],q=i[4];return n==null?p==="!=":p==="="?m===q:p==="*="?m.indexOf(q)>=0:p==="~="?(" "+m+" ").indexOf(q)>=0:!q?m&&n!==false:p==="!="?m!==q:p==="^="?m.indexOf(q)===0:p==="$="?m.substr(m.length-q.length)===q:p==="|="?m===q||m.substr(0,q.length+1)===q+"-":false},POS:function(g,i,n,m){var p=o.setFilters[i[2]];
if(p)return p(g,n,i,m)}}},x=o.match.POS,r=function(g,i){return"\\"+(i-0+1)},A;for(A in o.match){o.match[A]=RegExp(o.match[A].source+/(?![^\[]*\])(?![^\(]*\))/.source);o.leftMatch[A]=RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[A].source.replace(/\\(\d+)/g,r))}var C=function(g,i){g=Array.prototype.slice.call(g,0);if(i){i.push.apply(i,g);return i}return g};try{Array.prototype.slice.call(t.documentElement.childNodes,0)}catch(J){C=function(g,i){var n=0,m=i||[];if(f.call(g)==="[object Array]")Array.prototype.push.apply(m,
g);else if(typeof g.length==="number")for(var p=g.length;n<p;n++)m.push(g[n]);else for(;g[n];n++)m.push(g[n]);return m}}var w,I;if(t.documentElement.compareDocumentPosition)w=function(g,i){if(g===i){h=true;return 0}if(!g.compareDocumentPosition||!i.compareDocumentPosition)return g.compareDocumentPosition?-1:1;return g.compareDocumentPosition(i)&4?-1:1};else{w=function(g,i){var n,m,p=[],q=[];n=g.parentNode;m=i.parentNode;var u=n;if(g===i){h=true;return 0}else if(n===m)return I(g,i);else if(n){if(!m)return 1}else return-1;
for(;u;){p.unshift(u);u=u.parentNode}for(u=m;u;){q.unshift(u);u=u.parentNode}n=p.length;m=q.length;for(u=0;u<n&&u<m;u++)if(p[u]!==q[u])return I(p[u],q[u]);return u===n?I(g,q[u],-1):I(p[u],i,1)};I=function(g,i,n){if(g===i)return n;for(g=g.nextSibling;g;){if(g===i)return-1;g=g.nextSibling}return 1}}k.getText=function(g){for(var i="",n,m=0;g[m];m++){n=g[m];if(n.nodeType===3||n.nodeType===4)i+=n.nodeValue;else if(n.nodeType!==8)i+=k.getText(n.childNodes)}return i};(function(){var g=t.createElement("div"),
i="script"+(new Date).getTime(),n=t.documentElement;g.innerHTML="<a name='"+i+"'/>";n.insertBefore(g,n.firstChild);if(t.getElementById(i)){o.find.ID=function(m,p,q){if(typeof p.getElementById!=="undefined"&&!q)return(p=p.getElementById(m[1]))?p.id===m[1]||typeof p.getAttributeNode!=="undefined"&&p.getAttributeNode("id").nodeValue===m[1]?[p]:B:[]};o.filter.ID=function(m,p){var q=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&q&&q.nodeValue===p}}n.removeChild(g);
n=g=null})();(function(){var g=t.createElement("div");g.appendChild(t.createComment(""));if(g.getElementsByTagName("*").length>0)o.find.TAG=function(i,n){var m=n.getElementsByTagName(i[1]);if(i[1]==="*"){for(var p=[],q=0;m[q];q++)m[q].nodeType===1&&p.push(m[q]);m=p}return m};g.innerHTML="<a href='#'></a>";if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")o.attrHandle.href=function(i){return i.getAttribute("href",2)};g=null})();t.querySelectorAll&&
function(){var g=k,i=t.createElement("div");i.innerHTML="<p class='TEST'></p>";if(!(i.querySelectorAll&&i.querySelectorAll(".TEST").length===0)){k=function(m,p,q,u){p=p||t;m=m.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!u&&!k.isXML(p))if(p.nodeType===9)try{return C(p.querySelectorAll(m),q)}catch(y){}else if(p.nodeType===1&&p.nodeName.toLowerCase()!=="object"){var F=p.getAttribute("id"),M=F||"__sizzle__";F||p.setAttribute("id",M);try{return C(p.querySelectorAll("#"+M+" "+m),q)}catch(N){}finally{F||
p.removeAttribute("id")}}return g(m,p,q,u)};for(var n in g)k[n]=g[n];i=null}}();(function(){var g=t.documentElement,i=g.matchesSelector||g.mozMatchesSelector||g.webkitMatchesSelector||g.msMatchesSelector,n=false;try{i.call(t.documentElement,"[test!='']:sizzle")}catch(m){n=true}if(i)k.matchesSelector=function(p,q){q=q.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(p))try{if(n||!o.match.PSEUDO.test(q)&&!/!=/.test(q))return i.call(p,q)}catch(u){}return k(q,null,null,[p]).length>0}})();(function(){var g=
t.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){o.order.splice(1,0,"CLASS");o.find.CLASS=function(i,n,m){if(typeof n.getElementsByClassName!=="undefined"&&!m)return n.getElementsByClassName(i[1])};g=null}}})();k.contains=t.documentElement.contains?function(g,i){return g!==i&&(g.contains?g.contains(i):true)}:t.documentElement.compareDocumentPosition?
function(g,i){return!!(g.compareDocumentPosition(i)&16)}:function(){return false};k.isXML=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!=="HTML":false};var L=function(g,i){for(var n,m=[],p="",q=i.nodeType?[i]:i;n=o.match.PSEUDO.exec(g);){p+=n[0];g=g.replace(o.match.PSEUDO,"")}g=o.relative[g]?g+"*":g;n=0;for(var u=q.length;n<u;n++)k(g,q[n],m);return k.filter(p,m)};c.find=k;c.expr=k.selectors;c.expr[":"]=c.expr.filters;c.unique=k.uniqueSort;c.text=k.getText;c.isXMLDoc=k.isXML;
c.contains=k.contains})();var Za=/Until$/,$a=/^(?:parents|prevUntil|prevAll)/,ab=/,/,Na=/^.[^:#\[\.,]*$/,bb=Array.prototype.slice,cb=c.expr.match.POS;c.fn.extend({find:function(a){for(var b=this.pushStack("","find",a),d=0,e=0,f=this.length;e<f;e++){d=b.length;c.find(a,this[e],b);if(e>0)for(var h=d;h<b.length;h++)for(var l=0;l<d;l++)if(b[l]===b[h]){b.splice(h--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,e=b.length;d<e;d++)if(c.contains(this,b[d]))return true})},
not:function(a){return this.pushStack(ma(this,a,false),"not",a)},filter:function(a){return this.pushStack(ma(this,a,true),"filter",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){var d=[],e,f,h=this[0];if(c.isArray(a)){var l,k={},o=1;if(h&&a.length){e=0;for(f=a.length;e<f;e++){l=a[e];k[l]||(k[l]=c.expr.match.POS.test(l)?c(l,b||this.context):l)}for(;h&&h.ownerDocument&&h!==b;){for(l in k){e=k[l];if(e.jquery?e.index(h)>-1:c(h).is(e))d.push({selector:l,elem:h,level:o})}h=
h.parentNode;o++}}return d}l=cb.test(a)?c(a,b||this.context):null;e=0;for(f=this.length;e<f;e++)for(h=this[e];h;)if(l?l.index(h)>-1:c.find.matchesSelector(h,a)){d.push(h);break}else{h=h.parentNode;if(!h||!h.ownerDocument||h===b)break}d=d.length>1?c.unique(d):d;return this.pushStack(d,"closest",a)},index:function(a){if(!a||typeof a==="string")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var d=typeof a==="string"?c(a,b||this.context):
c.makeArray(a),e=c.merge(this.get(),d);return this.pushStack(!d[0]||!d[0].parentNode||d[0].parentNode.nodeType===11||!e[0]||!e[0].parentNode||e[0].parentNode.nodeType===11?e:c.unique(e))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",d)},next:function(a){return c.nth(a,2,"nextSibling")},prev:function(a){return c.nth(a,
2,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,
b){c.fn[a]=function(d,e){var f=c.map(this,b,d);Za.test(a)||(e=d);if(e&&typeof e==="string")f=c.filter(e,f);f=this.length>1?c.unique(f):f;if((this.length>1||ab.test(e))&&$a.test(a))f=f.reverse();return this.pushStack(f,a,bb.call(arguments).join(","))}});c.extend({filter:function(a,b,d){if(d)a=":not("+a+")";return b.length===1?c.find.matchesSelector(b[0],a)?[b[0]]:[]:c.find.matches(a,b)},dir:function(a,b,d){var e=[];for(a=a[b];a&&a.nodeType!==9&&(d===B||a.nodeType!==1||!c(a).is(d));){a.nodeType===1&&
e.push(a);a=a[b]}return e},nth:function(a,b,d){b=b||1;for(var e=0;a;a=a[d])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var za=/ jQuery\d+="(?:\d+|null)"/g,$=/^\s+/,Aa=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Ba=/<([\w:]+)/,db=/<tbody/i,eb=/<|&#?\w+;/,Ca=/<(?:script|object|embed|option|style)/i,Da=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/\=([^="'>\s]+\/)>/g,P={option:[1,
"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};P.optgroup=P.option;P.tbody=P.tfoot=P.colgroup=P.caption=P.thead;P.th=P.td;if(!c.support.htmlSerialize)P._default=[1,"div<div>","</div>"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=
c(this);d.text(a.call(this,b,d.text()))});if(typeof a!=="object"&&a!==B)return this.empty().append((this[0]&&this[0].ownerDocument||t).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},
wrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},
prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,
this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,e;(e=this[d])!=null;d++)if(!a||c.filter(a,[e]).length){if(!b&&e.nodeType===1){c.cleanData(e.getElementsByTagName("*"));c.cleanData([e])}e.parentNode&&e.parentNode.removeChild(e)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);
return this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,e=this.ownerDocument;if(!d){d=e.createElement("div");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(za,"").replace(fb,'="$1">').replace($,"")],e)[0]}else return this.cloneNode(true)});if(a===true){na(this,b);na(this.find("*"),b.find("*"))}return b},html:function(a){if(a===B)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(za,""):null;
else if(typeof a==="string"&&!Ca.test(a)&&(c.support.leadingWhitespace||!$.test(a))&&!P[(Ba.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Aa,"<$1></$2>");try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(e){this.empty().append(a)}}else c.isFunction(a)?this.each(function(f){var h=c(this);h.html(a.call(this,f,h.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=
c(this),e=d.html();d.replaceWith(a.call(this,b,e))});if(typeof a!=="string")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){var e,f,h,l=a[0],k=[];if(!c.support.checkClone&&arguments.length===3&&typeof l==="string"&&Da.test(l))return this.each(function(){c(this).domManip(a,
b,d,true)});if(c.isFunction(l))return this.each(function(x){var r=c(this);a[0]=l.call(this,x,b?r.html():B);r.domManip(a,b,d)});if(this[0]){e=l&&l.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:c.buildFragment(a,this,k);h=e.fragment;if(f=h.childNodes.length===1?h=h.firstChild:h.firstChild){b=b&&c.nodeName(f,"tr");f=0;for(var o=this.length;f<o;f++)d.call(b?c.nodeName(this[f],"table")?this[f].getElementsByTagName("tbody")[0]||this[f].appendChild(this[f].ownerDocument.createElement("tbody")):
this[f]:this[f],f>0||e.cacheable||this.length>1?h.cloneNode(true):h)}k.length&&c.each(k,Oa)}return this}});c.buildFragment=function(a,b,d){var e,f,h;b=b&&b[0]?b[0].ownerDocument||b[0]:t;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===t&&!Ca.test(a[0])&&(c.support.checkClone||!Da.test(a[0]))){f=true;if(h=c.fragments[a[0]])if(h!==1)e=h}if(!e){e=b.createDocumentFragment();c.clean(a,b,e,d)}if(f)c.fragments[a[0]]=h?e:1;return{fragment:e,cacheable:f}};c.fragments={};c.each({appendTo:"append",
prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(d){var e=[];d=c(d);var f=this.length===1&&this[0].parentNode;if(f&&f.nodeType===11&&f.childNodes.length===1&&d.length===1){d[b](this[0]);return this}else{f=0;for(var h=d.length;f<h;f++){var l=(f>0?this.clone(true):this).get();c(d[f])[b](l);e=e.concat(l)}return this.pushStack(e,a,d.selector)}}});c.extend({clean:function(a,b,d,e){b=b||t;if(typeof b.createElement==="undefined")b=b.ownerDocument||
b[0]&&b[0].ownerDocument||t;for(var f=[],h=0,l;(l=a[h])!=null;h++){if(typeof l==="number")l+="";if(l){if(typeof l==="string"&&!eb.test(l))l=b.createTextNode(l);else if(typeof l==="string"){l=l.replace(Aa,"<$1></$2>");var k=(Ba.exec(l)||["",""])[1].toLowerCase(),o=P[k]||P._default,x=o[0],r=b.createElement("div");for(r.innerHTML=o[1]+l+o[2];x--;)r=r.lastChild;if(!c.support.tbody){x=db.test(l);k=k==="table"&&!x?r.firstChild&&r.firstChild.childNodes:o[1]==="<table>"&&!x?r.childNodes:[];for(o=k.length-
1;o>=0;--o)c.nodeName(k[o],"tbody")&&!k[o].childNodes.length&&k[o].parentNode.removeChild(k[o])}!c.support.leadingWhitespace&&$.test(l)&&r.insertBefore(b.createTextNode($.exec(l)[0]),r.firstChild);l=r.childNodes}if(l.nodeType)f.push(l);else f=c.merge(f,l)}}if(d)for(h=0;f[h];h++)if(e&&c.nodeName(f[h],"script")&&(!f[h].type||f[h].type.toLowerCase()==="text/javascript"))e.push(f[h].parentNode?f[h].parentNode.removeChild(f[h]):f[h]);else{f[h].nodeType===1&&f.splice.apply(f,[h+1,0].concat(c.makeArray(f[h].getElementsByTagName("script"))));
d.appendChild(f[h])}return f},cleanData:function(a){for(var b,d,e=c.cache,f=c.event.special,h=c.support.deleteExpando,l=0,k;(k=a[l])!=null;l++)if(!(k.nodeName&&c.noData[k.nodeName.toLowerCase()]))if(d=k[c.expando]){if((b=e[d])&&b.events)for(var o in b.events)f[o]?c.event.remove(k,o):c.removeEvent(k,o,b.handle);if(h)delete k[c.expando];else k.removeAttribute&&k.removeAttribute(c.expando);delete e[d]}}});var Ea=/alpha\([^)]*\)/i,gb=/opacity=([^)]*)/,hb=/-([a-z])/ig,ib=/([A-Z])/g,Fa=/^-?\d+(?:px)?$/i,
jb=/^-?\d/,kb={position:"absolute",visibility:"hidden",display:"block"},Pa=["Left","Right"],Qa=["Top","Bottom"],W,Ga,aa,lb=function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){if(arguments.length===2&&b===B)return this;return c.access(this,a,b,true,function(d,e,f){return f!==B?c.style(d,e,f):c.css(d,e)})};c.extend({cssHooks:{opacity:{get:function(a,b){if(b){var d=W(a,"opacity","opacity");return d===""?"1":d}else return a.style.opacity}}},cssNumber:{zIndex:true,fontWeight:true,opacity:true,
zoom:true,lineHeight:true},cssProps:{"float":c.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,d,e){if(!(!a||a.nodeType===3||a.nodeType===8||!a.style)){var f,h=c.camelCase(b),l=a.style,k=c.cssHooks[h];b=c.cssProps[h]||h;if(d!==B){if(!(typeof d==="number"&&isNaN(d)||d==null)){if(typeof d==="number"&&!c.cssNumber[h])d+="px";if(!k||!("set"in k)||(d=k.set(a,d))!==B)try{l[b]=d}catch(o){}}}else{if(k&&"get"in k&&(f=k.get(a,false,e))!==B)return f;return l[b]}}},css:function(a,b,d){var e,f=c.camelCase(b),
h=c.cssHooks[f];b=c.cssProps[f]||f;if(h&&"get"in h&&(e=h.get(a,true,d))!==B)return e;else if(W)return W(a,b,f)},swap:function(a,b,d){var e={},f;for(f in b){e[f]=a.style[f];a.style[f]=b[f]}d.call(a);for(f in b)a.style[f]=e[f]},camelCase:function(a){return a.replace(hb,lb)}});c.curCSS=c.css;c.each(["height","width"],function(a,b){c.cssHooks[b]={get:function(d,e,f){var h;if(e){if(d.offsetWidth!==0)h=oa(d,b,f);else c.swap(d,kb,function(){h=oa(d,b,f)});if(h<=0){h=W(d,b,b);if(h==="0px"&&aa)h=aa(d,b,b);
if(h!=null)return h===""||h==="auto"?"0px":h}if(h<0||h==null){h=d.style[b];return h===""||h==="auto"?"0px":h}return typeof h==="string"?h:h+"px"}},set:function(d,e){if(Fa.test(e)){e=parseFloat(e);if(e>=0)return e+"px"}else return e}}});if(!c.support.opacity)c.cssHooks.opacity={get:function(a,b){return gb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var d=a.style;d.zoom=1;var e=c.isNaN(b)?"":"alpha(opacity="+b*100+")",f=
d.filter||"";d.filter=Ea.test(f)?f.replace(Ea,e):d.filter+" "+e}};if(t.defaultView&&t.defaultView.getComputedStyle)Ga=function(a,b,d){var e;d=d.replace(ib,"-$1").toLowerCase();if(!(b=a.ownerDocument.defaultView))return B;if(b=b.getComputedStyle(a,null)){e=b.getPropertyValue(d);if(e===""&&!c.contains(a.ownerDocument.documentElement,a))e=c.style(a,d)}return e};if(t.documentElement.currentStyle)aa=function(a,b){var d,e,f=a.currentStyle&&a.currentStyle[b],h=a.style;if(!Fa.test(f)&&jb.test(f)){d=h.left;
e=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;h.left=b==="fontSize"?"1em":f||0;f=h.pixelLeft+"px";h.left=d;a.runtimeStyle.left=e}return f===""?"auto":f};W=Ga||aa;if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=a.offsetHeight;return a.offsetWidth===0&&b===0||!c.support.reliableHiddenOffsets&&(a.style.display||c.css(a,"display"))==="none"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var mb=c.now(),nb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
ob=/^(?:select|textarea)/i,pb=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,qb=/^(?:GET|HEAD)$/,Ra=/\[\]$/,T=/\=\?(&|$)/,ja=/\?/,rb=/([?&])_=[^&]*/,sb=/^(\w+:)?\/\/([^\/?#]+)/,tb=/%20/g,ub=/#.*$/,Ha=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!=="string"&&Ha)return Ha.apply(this,arguments);else if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var f=a.slice(e,a.length);a=a.slice(0,e)}e="GET";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b===
"object"){b=c.param(b,c.ajaxSettings.traditional);e="POST"}var h=this;c.ajax({url:a,type:e,dataType:"html",data:b,complete:function(l,k){if(k==="success"||k==="notmodified")h.html(f?c("<div>").append(l.responseText.replace(nb,"")).find(f):l.responseText);d&&h.each(d,[l.responseText,k,l])}});return this},serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&
!this.disabled&&(this.checked||ob.test(this.nodeName)||pb.test(this.type))}).map(function(a,b){var d=c(this).val();return d==null?null:c.isArray(d)?c.map(d,function(e){return{name:b.name,value:e}}):{name:b.name,value:d}}).get()}});c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,e){if(c.isFunction(b)){e=e||d;d=b;b=null}return c.ajax({type:"GET",url:a,data:b,success:d,dataType:e})},
getScript:function(a,b){return c.get(a,null,b,"script")},getJSON:function(a,b,d){return c.get(a,b,d,"json")},post:function(a,b,d,e){if(c.isFunction(b)){e=e||d;d=b;b={}}return c.ajax({type:"POST",url:a,data:b,success:d,dataType:e})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return new E.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",
script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},ajax:function(a){var b=c.extend(true,{},c.ajaxSettings,a),d,e,f,h=b.type.toUpperCase(),l=qb.test(h);b.url=b.url.replace(ub,"");b.context=a&&a.context!=null?a.context:b;if(b.data&&b.processData&&typeof b.data!=="string")b.data=c.param(b.data,b.traditional);if(b.dataType==="jsonp"){if(h==="GET")T.test(b.url)||(b.url+=(ja.test(b.url)?"&":"?")+(b.jsonp||"callback")+"=?");else if(!b.data||
!T.test(b.data))b.data=(b.data?b.data+"&":"")+(b.jsonp||"callback")+"=?";b.dataType="json"}if(b.dataType==="json"&&(b.data&&T.test(b.data)||T.test(b.url))){d=b.jsonpCallback||"jsonp"+mb++;if(b.data)b.data=(b.data+"").replace(T,"="+d+"$1");b.url=b.url.replace(T,"="+d+"$1");b.dataType="script";var k=E[d];E[d]=function(m){if(c.isFunction(k))k(m);else{E[d]=B;try{delete E[d]}catch(p){}}f=m;c.handleSuccess(b,w,e,f);c.handleComplete(b,w,e,f);r&&r.removeChild(A)}}if(b.dataType==="script"&&b.cache===null)b.cache=
false;if(b.cache===false&&l){var o=c.now(),x=b.url.replace(rb,"$1_="+o);b.url=x+(x===b.url?(ja.test(b.url)?"&":"?")+"_="+o:"")}if(b.data&&l)b.url+=(ja.test(b.url)?"&":"?")+b.data;b.global&&c.active++===0&&c.event.trigger("ajaxStart");o=(o=sb.exec(b.url))&&(o[1]&&o[1].toLowerCase()!==location.protocol||o[2].toLowerCase()!==location.host);if(b.dataType==="script"&&h==="GET"&&o){var r=t.getElementsByTagName("head")[0]||t.documentElement,A=t.createElement("script");if(b.scriptCharset)A.charset=b.scriptCharset;
A.src=b.url;if(!d){var C=false;A.onload=A.onreadystatechange=function(){if(!C&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){C=true;c.handleSuccess(b,w,e,f);c.handleComplete(b,w,e,f);A.onload=A.onreadystatechange=null;r&&A.parentNode&&r.removeChild(A)}}}r.insertBefore(A,r.firstChild);return B}var J=false,w=b.xhr();if(w){b.username?w.open(h,b.url,b.async,b.username,b.password):w.open(h,b.url,b.async);try{if(b.data!=null&&!l||a&&a.contentType)w.setRequestHeader("Content-Type",
b.contentType);if(b.ifModified){c.lastModified[b.url]&&w.setRequestHeader("If-Modified-Since",c.lastModified[b.url]);c.etag[b.url]&&w.setRequestHeader("If-None-Match",c.etag[b.url])}o||w.setRequestHeader("X-Requested-With","XMLHttpRequest");w.setRequestHeader("Accept",b.dataType&&b.accepts[b.dataType]?b.accepts[b.dataType]+", */*; q=0.01":b.accepts._default)}catch(I){}if(b.beforeSend&&b.beforeSend.call(b.context,w,b)===false){b.global&&c.active--===1&&c.event.trigger("ajaxStop");w.abort();return false}b.global&&
c.triggerGlobal(b,"ajaxSend",[w,b]);var L=w.onreadystatechange=function(m){if(!w||w.readyState===0||m==="abort"){J||c.handleComplete(b,w,e,f);J=true;if(w)w.onreadystatechange=c.noop}else if(!J&&w&&(w.readyState===4||m==="timeout")){J=true;w.onreadystatechange=c.noop;e=m==="timeout"?"timeout":!c.httpSuccess(w)?"error":b.ifModified&&c.httpNotModified(w,b.url)?"notmodified":"success";var p;if(e==="success")try{f=c.httpData(w,b.dataType,b)}catch(q){e="parsererror";p=q}if(e==="success"||e==="notmodified")d||
c.handleSuccess(b,w,e,f);else c.handleError(b,w,e,p);d||c.handleComplete(b,w,e,f);m==="timeout"&&w.abort();if(b.async)w=null}};try{var g=w.abort;w.abort=function(){w&&Function.prototype.call.call(g,w);L("abort")}}catch(i){}b.async&&b.timeout>0&&setTimeout(function(){w&&!J&&L("timeout")},b.timeout);try{w.send(l||b.data==null?null:b.data)}catch(n){c.handleError(b,w,null,n);c.handleComplete(b,w,e,f)}b.async||L();return w}},param:function(a,b){var d=[],e=function(h,l){l=c.isFunction(l)?l():l;d[d.length]=
encodeURIComponent(h)+"="+encodeURIComponent(l)};if(b===B)b=c.ajaxSettings.traditional;if(c.isArray(a)||a.jquery)c.each(a,function(){e(this.name,this.value)});else for(var f in a)da(f,a[f],b,e);return d.join("&").replace(tb,"+")}});c.extend({active:0,lastModified:{},etag:{},handleError:function(a,b,d,e){a.error&&a.error.call(a.context,b,d,e);a.global&&c.triggerGlobal(a,"ajaxError",[b,a,e])},handleSuccess:function(a,b,d,e){a.success&&a.success.call(a.context,e,d,b);a.global&&c.triggerGlobal(a,"ajaxSuccess",
[b,a])},handleComplete:function(a,b,d){a.complete&&a.complete.call(a.context,b,d);a.global&&c.triggerGlobal(a,"ajaxComplete",[b,a]);a.global&&c.active--===1&&c.event.trigger("ajaxStop")},triggerGlobal:function(a,b,d){(a.context&&a.context.url==null?c(a.context):c.event).trigger(b,d)},httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader("Last-Modified"),
e=a.getResponseHeader("Etag");if(d)c.lastModified[b]=d;if(e)c.etag[b]=e;return a.status===304},httpData:function(a,b,d){var e=a.getResponseHeader("content-type")||"",f=b==="xml"||!b&&e.indexOf("xml")>=0;a=f?a.responseXML:a.responseText;f&&a.documentElement.nodeName==="parsererror"&&c.error("parsererror");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a==="string")if(b==="json"||!b&&e.indexOf("json")>=0)a=c.parseJSON(a);else if(b==="script"||!b&&e.indexOf("javascript")>=0)c.globalEval(a);return a}});
if(E.ActiveXObject)c.ajaxSettings.xhr=function(){if(E.location.protocol!=="file:")try{return new E.XMLHttpRequest}catch(a){}try{return new E.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}};c.support.ajax=!!c.ajaxSettings.xhr();var ea={},vb=/^(?:toggle|show|hide)$/,wb=/^([+\-]=)?([\d+.\-]+)(.*)$/,ba,pa=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];c.fn.extend({show:function(a,b,d){if(a||a===0)return this.animate(S("show",
3),a,b,d);else{d=0;for(var e=this.length;d<e;d++){a=this[d];b=a.style.display;if(!c.data(a,"olddisplay")&&b==="none")b=a.style.display="";b===""&&c.css(a,"display")==="none"&&c.data(a,"olddisplay",qa(a.nodeName))}for(d=0;d<e;d++){a=this[d];b=a.style.display;if(b===""||b==="none")a.style.display=c.data(a,"olddisplay")||""}return this}},hide:function(a,b,d){if(a||a===0)return this.animate(S("hide",3),a,b,d);else{a=0;for(b=this.length;a<b;a++){d=c.css(this[a],"display");d!=="none"&&c.data(this[a],"olddisplay",
d)}for(a=0;a<b;a++)this[a].style.display="none";return this}},_toggle:c.fn.toggle,toggle:function(a,b,d){var e=typeof a==="boolean";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||e?this.each(function(){var f=e?a:c(this).is(":hidden");c(this)[f?"show":"hide"]()}):this.animate(S("toggle",3),a,b,d);return this},fadeTo:function(a,b,d,e){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,d,e)},animate:function(a,b,d,e){var f=c.speed(b,
d,e);if(c.isEmptyObject(a))return this.each(f.complete);return this[f.queue===false?"each":"queue"](function(){var h=c.extend({},f),l,k=this.nodeType===1,o=k&&c(this).is(":hidden"),x=this;for(l in a){var r=c.camelCase(l);if(l!==r){a[r]=a[l];delete a[l];l=r}if(a[l]==="hide"&&o||a[l]==="show"&&!o)return h.complete.call(this);if(k&&(l==="height"||l==="width")){h.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(c.css(this,"display")==="inline"&&c.css(this,"float")==="none")if(c.support.inlineBlockNeedsLayout)if(qa(this.nodeName)===
"inline")this.style.display="inline-block";else{this.style.display="inline";this.style.zoom=1}else this.style.display="inline-block"}if(c.isArray(a[l])){(h.specialEasing=h.specialEasing||{})[l]=a[l][1];a[l]=a[l][0]}}if(h.overflow!=null)this.style.overflow="hidden";h.curAnim=c.extend({},a);c.each(a,function(A,C){var J=new c.fx(x,h,A);if(vb.test(C))J[C==="toggle"?o?"show":"hide":C](a);else{var w=wb.exec(C),I=J.cur()||0;if(w){var L=parseFloat(w[2]),g=w[3]||"px";if(g!=="px"){c.style(x,A,(L||1)+g);I=(L||
1)/J.cur()*I;c.style(x,A,I+g)}if(w[1])L=(w[1]==="-="?-1:1)*L+I;J.custom(I,L,g)}else J.custom(I,C,"")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);this.each(function(){for(var e=d.length-1;e>=0;e--)if(d[e].elem===this){b&&d[e](true);d.splice(e,1)}});b||this.dequeue();return this}});c.each({slideDown:S("show",1),slideUp:S("hide",1),slideToggle:S("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){c.fn[a]=function(d,e,f){return this.animate(b,
d,e,f)}});c.extend({speed:function(a,b,d){var e=a&&typeof a==="object"?c.extend({},a):{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};e.duration=c.fx.off?0:typeof e.duration==="number"?e.duration:e.duration in c.fx.speeds?c.fx.speeds[e.duration]:c.fx.speeds._default;e.old=e.complete;e.complete=function(){e.queue!==false&&c(this).dequeue();c.isFunction(e.old)&&e.old.call(this)};return e},easing:{linear:function(a,b,d,e){return d+e*a},swing:function(a,b,d,e){return(-Math.cos(a*
Math.PI)/2+0.5)*e+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||c.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a=parseFloat(c.css(this.elem,this.prop));return a&&a>-1E4?a:0},custom:function(a,b,d){function e(l){return f.step(l)}
var f=this,h=c.fx;this.startTime=c.now();this.start=a;this.end=b;this.unit=d||this.unit||"px";this.now=this.start;this.pos=this.state=0;e.elem=this.elem;if(e()&&c.timers.push(e)&&!ba)ba=setInterval(h.tick,h.interval)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;
this.custom(this.cur(),0)},step:function(a){var b=c.now(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var e in this.options.curAnim)if(this.options.curAnim[e]!==true)d=false;if(d){if(this.options.overflow!=null&&!c.support.shrinkWrapBlocks){var f=this.elem,h=this.options;c.each(["","X","Y"],function(k,o){f.style["overflow"+o]=h.overflow[k]})}this.options.hide&&c(this.elem).hide();if(this.options.hide||
this.options.show)for(var l in this.options.curAnim)c.style(this.elem,l,this.options.orig[l]);this.options.complete.call(this.elem)}return false}else{a=b-this.startTime;this.state=a/this.options.duration;b=this.options.easing||(c.easing.swing?"swing":"linear");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||b](this.state,a,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=
c.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||c.fx.stop()},interval:13,stop:function(){clearInterval(ba);ba=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===
b.elem}).length};var xb=/^t(?:able|d|h)$/i,Ia=/^(?:body|html)$/i;c.fn.offset="getBoundingClientRect"in t.documentElement?function(a){var b=this[0],d;if(a)return this.each(function(l){c.offset.setOffset(this,a,l)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);try{d=b.getBoundingClientRect()}catch(e){}var f=b.ownerDocument,h=f.documentElement;if(!d||!c.contains(h,b))return d||{top:0,left:0};b=f.body;f=fa(f);return{top:d.top+(f.pageYOffset||c.support.boxModel&&
h.scrollTop||b.scrollTop)-(h.clientTop||b.clientTop||0),left:d.left+(f.pageXOffset||c.support.boxModel&&h.scrollLeft||b.scrollLeft)-(h.clientLeft||b.clientLeft||0)}}:function(a){var b=this[0];if(a)return this.each(function(x){c.offset.setOffset(this,a,x)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d,e=b.offsetParent,f=b.ownerDocument,h=f.documentElement,l=f.body;d=(f=f.defaultView)?f.getComputedStyle(b,null):b.currentStyle;
for(var k=b.offsetTop,o=b.offsetLeft;(b=b.parentNode)&&b!==l&&b!==h;){if(c.offset.supportsFixedPosition&&d.position==="fixed")break;d=f?f.getComputedStyle(b,null):b.currentStyle;k-=b.scrollTop;o-=b.scrollLeft;if(b===e){k+=b.offsetTop;o+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&xb.test(b.nodeName))){k+=parseFloat(d.borderTopWidth)||0;o+=parseFloat(d.borderLeftWidth)||0}e=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"){k+=
parseFloat(d.borderTopWidth)||0;o+=parseFloat(d.borderLeftWidth)||0}d=d}if(d.position==="relative"||d.position==="static"){k+=l.offsetTop;o+=l.offsetLeft}if(c.offset.supportsFixedPosition&&d.position==="fixed"){k+=Math.max(h.scrollTop,l.scrollTop);o+=Math.max(h.scrollLeft,l.scrollLeft)}return{top:k,left:o}};c.offset={initialize:function(){var a=t.body,b=t.createElement("div"),d,e,f,h=parseFloat(c.css(a,"marginTop"))||0;c.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",
height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";a.insertBefore(b,a.firstChild);d=b.firstChild;e=d.firstChild;f=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=e.offsetTop!==5;this.doesAddBorderForTableAndCells=
f.offsetTop===5;e.style.position="fixed";e.style.top="20px";this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15;e.style.position=e.style.top="";d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==h;a.removeChild(b);c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.css(a,
"marginTop"))||0;d+=parseFloat(c.css(a,"marginLeft"))||0}return{top:b,left:d}},setOffset:function(a,b,d){var e=c.css(a,"position");if(e==="static")a.style.position="relative";var f=c(a),h=f.offset(),l=c.css(a,"top"),k=c.css(a,"left"),o=e==="absolute"&&c.inArray("auto",[l,k])>-1;e={};var x={};if(o)x=f.position();l=o?x.top:parseInt(l,10)||0;k=o?x.left:parseInt(k,10)||0;if(c.isFunction(b))b=b.call(a,d,h);if(b.top!=null)e.top=b.top-h.top+l;if(b.left!=null)e.left=b.left-h.left+k;"using"in b?b.using.call(a,
e):f.css(e)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),e=Ia.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.css(a,"marginTop"))||0;d.left-=parseFloat(c.css(a,"marginLeft"))||0;e.top+=parseFloat(c.css(b[0],"borderTopWidth"))||0;e.left+=parseFloat(c.css(b[0],"borderLeftWidth"))||0;return{top:d.top-e.top,left:d.left-e.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||t.body;a&&!Ia.test(a.nodeName)&&
c.css(a,"position")==="static";)a=a.offsetParent;return a})}});c.each(["Left","Top"],function(a,b){var d="scroll"+b;c.fn[d]=function(e){var f=this[0],h;if(!f)return null;if(e!==B)return this.each(function(){if(h=fa(this))h.scrollTo(!a?e:c(h).scrollLeft(),a?e:c(h).scrollTop());else this[d]=e});else return(h=fa(f))?"pageXOffset"in h?h[a?"pageYOffset":"pageXOffset"]:c.support.boxModel&&h.document.documentElement[d]||h.document.body[d]:f[d]}});c.each(["Height","Width"],function(a,b){var d=b.toLowerCase();
c.fn["inner"+b]=function(){return this[0]?parseFloat(c.css(this[0],d,"padding")):null};c.fn["outer"+b]=function(e){return this[0]?parseFloat(c.css(this[0],d,e?"margin":"border")):null};c.fn[d]=function(e){var f=this[0];if(!f)return e==null?null:this;if(c.isFunction(e))return this.each(function(l){var k=c(this);k[d](e.call(this,l,k[d]()))});if(c.isWindow(f))return f.document.compatMode==="CSS1Compat"&&f.document.documentElement["client"+b]||f.document.body["client"+b];else if(f.nodeType===9)return Math.max(f.documentElement["client"+
b],f.body["scroll"+b],f.documentElement["scroll"+b],f.body["offset"+b],f.documentElement["offset"+b]);else if(e===B){f=c.css(f,d);var h=parseFloat(f);return c.isNaN(h)?f:h}else return this.css(d,typeof e==="string"?e:e+"px")}})})(window);
</script><script type="text/javascript">//XRegExp 1.5.0 <xregexp.com> MIT License
var XRegExp;if(XRegExp){throw Error("can't load XRegExp twice in the same frame")}(function(){XRegExp=function(w,r){var q=[],u=XRegExp.OUTSIDE_CLASS,x=0,p,s,v,t,y;if(XRegExp.isRegExp(w)){if(r!==undefined){throw TypeError("can't supply flags when constructing one RegExp from another")}return j(w)}if(g){throw Error("can't call the XRegExp constructor within token definition functions")}r=r||"";p={hasNamedCapture:false,captureNames:[],hasFlag:function(z){return r.indexOf(z)>-1},setFlag:function(z){r+=z}};while(x<w.length){s=o(w,x,u,p);if(s){q.push(s.output);x+=(s.match[0].length||1)}else{if(v=m.exec.call(i[u],w.slice(x))){q.push(v[0]);x+=v[0].length}else{t=w.charAt(x);if(t==="["){u=XRegExp.INSIDE_CLASS}else{if(t==="]"){u=XRegExp.OUTSIDE_CLASS}}q.push(t);x++}}}y=RegExp(q.join(""),m.replace.call(r,h,""));y._xregexp={source:w,captureNames:p.hasNamedCapture?p.captureNames:null};return y};XRegExp.version="1.5.0";XRegExp.INSIDE_CLASS=1;XRegExp.OUTSIDE_CLASS=2;var c=/\$(?:(\d\d?|[$&`'])|{([$\w]+)})/g,h=/[^gimy]+|([\s\S])(?=[\s\S]*\1)/g,n=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,g=false,k=[],m={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},a=m.exec.call(/()??/,"")[1]===undefined,e=function(){var p=/^/g;m.test.call(p,"");return !p.lastIndex}(),f=function(){var p=/x/g;m.replace.call("x",p,"");return !p.lastIndex}(),b=RegExp.prototype.sticky!==undefined,i={};i[XRegExp.INSIDE_CLASS]=/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/;i[XRegExp.OUTSIDE_CLASS]=/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/;XRegExp.addToken=function(s,r,q,p){k.push({pattern:j(s,"g"+(b?"y":"")),handler:r,scope:q||XRegExp.OUTSIDE_CLASS,trigger:p||null})};XRegExp.cache=function(r,p){var q=r+"/"+(p||"");return XRegExp.cache[q]||(XRegExp.cache[q]=XRegExp(r,p))};XRegExp.copyAsGlobal=function(p){return j(p,"g")};XRegExp.escape=function(p){return p.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};XRegExp.execAt=function(s,r,t,q){r=j(r,"g"+((q&&b)?"y":""));r.lastIndex=t=t||0;var p=r.exec(s);if(q){return(p&&p.index===t)?p:null}else{return p}};XRegExp.freezeTokens=function(){XRegExp.addToken=function(){throw Error("can't run addToken after freezeTokens")}};XRegExp.isRegExp=function(p){return Object.prototype.toString.call(p)==="[object RegExp]"};XRegExp.iterate=function(u,p,v,s){var t=j(p,"g"),r=-1,q;while(q=t.exec(u)){v.call(s,q,++r,u,t);if(t.lastIndex===q.index){t.lastIndex++}}if(p.global){p.lastIndex=0}};XRegExp.matchChain=function(q,p){return function r(s,x){var v=p[x].regex?p[x]:{regex:p[x]},u=j(v.regex,"g"),w=[],t;for(t=0;t<s.length;t++){XRegExp.iterate(s[t],u,function(y){w.push(v.backref?(y[v.backref]||""):y[0])})}return((x===p.length-1)||!w.length)?w:r(w,x+1)}([q],0)};RegExp.prototype.apply=function(q,p){return this.exec(p[0])};RegExp.prototype.call=function(p,q){return this.exec(q)};RegExp.prototype.exec=function(t){var r=m.exec.apply(this,arguments),q,p;if(r){if(!a&&r.length>1&&l(r,"")>-1){p=RegExp(this.source,m.replace.call(d(this),"g",""));m.replace.call(t.slice(r.index),p,function(){for(var u=1;u<arguments.length-2;u++){if(arguments[u]===undefined){r[u]=undefined}}})}if(this._xregexp&&this._xregexp.captureNames){for(var s=1;s<r.length;s++){q=this._xregexp.captureNames[s-1];if(q){r[q]=r[s]}}}if(!e&&this.global&&!r[0].length&&(this.lastIndex>r.index)){this.lastIndex--}}return r};if(!e){RegExp.prototype.test=function(q){var p=m.exec.call(this,q);if(p&&this.global&&!p[0].length&&(this.lastIndex>p.index)){this.lastIndex--}return !!p}}String.prototype.match=function(q){if(!XRegExp.isRegExp(q)){q=RegExp(q)}if(q.global){var p=m.match.apply(this,arguments);q.lastIndex=0;return p}return q.exec(this)};String.prototype.replace=function(r,s){var t=XRegExp.isRegExp(r),q,p,u;if(t&&typeof s.valueOf()==="string"&&s.indexOf("${")===-1&&f){return m.replace.apply(this,arguments)}if(!t){r=r+""}else{if(r._xregexp){q=r._xregexp.captureNames}}if(typeof s==="function"){p=m.replace.call(this,r,function(){if(q){arguments[0]=new String(arguments[0]);for(var v=0;v<q.length;v++){if(q[v]){arguments[0][q[v]]=arguments[v+1]}}}if(t&&r.global){r.lastIndex=arguments[arguments.length-2]+arguments[0].length}return s.apply(null,arguments)})}else{u=this+"";p=m.replace.call(u,r,function(){var v=arguments;return m.replace.call(s,c,function(x,w,A){if(w){switch(w){case"$":return"$";case"&":return v[0];case"`":return v[v.length-1].slice(0,v[v.length-2]);case"'":return v[v.length-1].slice(v[v.length-2]+v[0].length);default:var y="";w=+w;if(!w){return x}while(w>v.length-3){y=String.prototype.slice.call(w,-1)+y;w=Math.floor(w/10)}return(w?v[w]||"":"$")+y}}else{var z=+A;if(z<=v.length-3){return v[z]}z=q?l(q,A):-1;return z>-1?v[z+1]:x}})})}if(t&&r.global){r.lastIndex=0}return p};String.prototype.split=function(u,p){if(!XRegExp.isRegExp(u)){return m.split.apply(this,arguments)}var w=this+"",r=[],v=0,t,q;if(p===undefined||+p<0){p=Infinity}else{p=Math.floor(+p);if(!p){return[]}}u=XRegExp.copyAsGlobal(u);while(t=u.exec(w)){if(u.lastIndex>v){r.push(w.slice(v,t.index));if(t.length>1&&t.index<w.length){Array.prototype.push.apply(r,t.slice(1))}q=t[0].length;v=u.lastIndex;if(r.length>=p){break}}if(u.lastIndex===t.index){u.lastIndex++}}if(v===w.length){if(!m.test.call(u,"")||q){r.push("")}}else{r.push(w.slice(v))}return r.length>p?r.slice(0,p):r};function j(r,q){if(!XRegExp.isRegExp(r)){throw TypeError("type RegExp expected")}var p=r._xregexp;r=XRegExp(r.source,d(r)+(q||""));if(p){r._xregexp={source:p.source,captureNames:p.captureNames?p.captureNames.slice(0):null}}return r}function d(p){return(p.global?"g":"")+(p.ignoreCase?"i":"")+(p.multiline?"m":"")+(p.extended?"x":"")+(p.sticky?"y":"")}function o(v,u,w,p){var r=k.length,y,s,x;g=true;try{while(r--){x=k[r];if((w&x.scope)&&(!x.trigger||x.trigger.call(p))){x.pattern.lastIndex=u;s=x.pattern.exec(v);if(s&&s.index===u){y={output:x.handler.call(p,s,w),match:s};break}}}}catch(q){throw q}finally{g=false}return y}function l(s,q,r){if(Array.prototype.indexOf){return s.indexOf(q,r)}for(var p=r||0;p<s.length;p++){if(s[p]===q){return p}}return -1}XRegExp.addToken(/\(\?#[^)]*\)/,function(p){return m.test.call(n,p.input.slice(p.index+p[0].length))?"":"(?:)"});XRegExp.addToken(/\((?!\?)/,function(){this.captureNames.push(null);return"("});XRegExp.addToken(/\(\?<([$\w]+)>/,function(p){this.captureNames.push(p[1]);this.hasNamedCapture=true;return"("});XRegExp.addToken(/\\k<([\w$]+)>/,function(q){var p=l(this.captureNames,q[1]);return p>-1?"\\"+(p+1)+(isNaN(q.input.charAt(q.index+q[0].length))?"":"(?:)"):q[0]});XRegExp.addToken(/\[\^?]/,function(p){return p[0]==="[]"?"\\b\\B":"[\\s\\S]"});XRegExp.addToken(/^\(\?([imsx]+)\)/,function(p){this.setFlag(p[1]);return""});XRegExp.addToken(/(?:\s+|#.*)+/,function(p){return m.test.call(n,p.input.slice(p.index+p[0].length))?"":"(?:)"},XRegExp.OUTSIDE_CLASS,function(){return this.hasFlag("x")});XRegExp.addToken(/\./,function(){return"[\\s\\S]"},XRegExp.OUTSIDE_CLASS,function(){return this.hasFlag("s")})})();
</script><script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
//
// Begin anonymous function. This is used to contain local scope variables without polutting global scope.
//
var SyntaxHighlighter = function() { 

// CommonJS
if (typeof(require) != 'undefined' && typeof(XRegExp) == 'undefined')
{
	XRegExp = require('XRegExp').XRegExp;
}

// Shortcut object which will be assigned to the SyntaxHighlighter variable.
// This is a shorthand for local reference in order to avoid long namespace 
// references to SyntaxHighlighter.whatever...
var sh = {
	defaults : {
		/** Additional CSS class names to be added to highlighter elements. */
		'class-name' : '',
		
		/** First line number. */
		'first-line' : 1,
		
		/**
		 * Pads line numbers. Possible values are:
		 *
		 *   false - don't pad line numbers.
		 *   true  - automaticaly pad numbers with minimum required number of leading zeroes.
		 *   [int] - length up to which pad line numbers.
		 */
		'pad-line-numbers' : false,
		
		/** Lines to highlight. */
		'highlight' : null,
		
		/** Title to be displayed above the code block. */
		'title' : null,
		
		/** Enables or disables smart tabs. */
		'smart-tabs' : true,
		
		/** Gets or sets tab size. */
		'tab-size' : 4,
		
		/** Enables or disables gutter. */
		'gutter' : true,
		
		/** Enables or disables toolbar. */
		'toolbar' : true,
		
		/** Enables quick code copy and paste from double click. */
		'quick-code' : true,
		
		/** Forces code view to be collapsed. */
		'collapse' : false,
		
		/** Enables or disables automatic links. */
		'auto-links' : true,
		
		/** Gets or sets light mode. Equavalent to turning off gutter and toolbar. */
		'light' : false,
		
		'html-script' : false
	},
	
	config : {
		space : '&nbsp;',
		
		/** Enables use of <SCRIPT type="syntaxhighlighter" /> tags. */
		useScriptTags : true,
		
		/** Blogger mode flag. */
		bloggerMode : false,
		
		stripBrs : false,
		
		/** Name of the tag that SyntaxHighlighter will automatically look for. */
		tagName : 'pre',
		
		strings : {
			expandSource : 'expand source',
			help : '?',
			alert: 'SyntaxHighlighter\n\n',
			noBrush : 'Can\'t find brush for: ',
			brushNotHtmlScript : 'Brush wasn\'t configured for html-script option: ',
			
			// this is populated by the build script
			aboutDialog : '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>About SyntaxHighlighter</title></head><body style="font-family:Geneva,Arial,Helvetica,sans-serif;background-color:#fff;color:#000;font-size:1em;text-align:center;"><div style="text-align:center;margin-top:1.5em;"><div style="font-size:xx-large;">SyntaxHighlighter</div><div style="font-size:.75em;margin-bottom:3em;"><div>version 3.0.83 (July 02 2010)</div><div><a href="http://alexgorbatchev.com/SyntaxHighlighter" target="_blank" style="color:#005896">http://alexgorbatchev.com/SyntaxHighlighter</a></div><div>JavaScript code syntax highlighter.</div><div>Copyright 2004-2010 Alex Gorbatchev.</div></div><div>If you like this script, please <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=2930402" style="color:#005896">donate</a> to <br/>keep development active!</div></div></body></html>'
		}
	},
	
	/** Internal 'global' variables. */
	vars : {
		discoveredBrushes : null,
		highlighters : {}
	},
	
	/** This object is populated by user included external brush files. */
	brushes : {},

	/** Common regular expressions. */
	regexLib : {
		multiLineCComments			: /\/\*[\s\S]*?\*\//gm,
		singleLineCComments			: /\/\/.*$/gm,
		singleLinePerlComments		: /#.*$/gm,
		doubleQuotedString			: /"([^\\"\n]|\\.)*"/g,
		singleQuotedString			: /'([^\\'\n]|\\.)*'/g,
		multiLineDoubleQuotedString	: new XRegExp('"([^\\\\"]|\\\\.)*"', 'gs'),
		multiLineSingleQuotedString	: new XRegExp("'([^\\\\']|\\\\.)*'", 'gs'),
		xmlComments					: /(&lt;|<)!--[\s\S]*?--(&gt;|>)/gm,
		url							: /\w+:\/\/[\w-.\/?%&=:@;]*/g,
		
		/** <?= ?> tags. */
		phpScriptTags 				: { left: /(&lt;|<)\?=?/g, right: /\?(&gt;|>)/g },
		
		/** <%= %> tags. */
		aspScriptTags				: { left: /(&lt;|<)%=?/g, right: /%(&gt;|>)/g },
		
		scriptScriptTags			: { left: /(&lt;|<)\s*script.*?(&gt;|>)/gi, right: /(&lt;|<)\/\s*script\s*(&gt;|>)/gi }
	},

	toolbar: {
		/**
		 * Generates HTML markup for the toolbar.
		 * @param {Highlighter} highlighter Highlighter instance.
		 * @return {String} Returns HTML markup.
		 */
		getHtml: function(highlighter)
		{
			var html = '<div class="toolbar">',
				items = sh.toolbar.items,
				list = items.list
				;
			
			function defaultGetHtml(highlighter, name)
			{
				return sh.toolbar.getButtonHtml(highlighter, name, sh.config.strings[name]);
			};
			
			for (var i = 0; i < list.length; i++)
				html += (items[list[i]].getHtml || defaultGetHtml)(highlighter, list[i]);
			
			html += '</div>';
			
			return html;
		},
		
		/**
		 * Generates HTML markup for a regular button in the toolbar.
		 * @param {Highlighter} highlighter Highlighter instance.
		 * @param {String} commandName		Command name that would be executed.
		 * @param {String} label			Label text to display.
		 * @return {String}					Returns HTML markup.
		 */
		getButtonHtml: function(highlighter, commandName, label)
		{
			return '<span><a href="#" class="toolbar_item'
				+ ' command_' + commandName
				+ ' ' + commandName
				+ '">' + label + '</a></span>'
				;
		},
		
		/**
		 * Event handler for a toolbar anchor.
		 */
		handler: function(e)
		{
			var target = e.target,
				className = target.className || ''
				;

			function getValue(name)
			{
				var r = new RegExp(name + '_(\\w+)'),
					match = r.exec(className)
					;

				return match ? match[1] : null;
			};
			
			var highlighter = getHighlighterById(findParentElement(target, '.syntaxhighlighter').id),
				commandName = getValue('command')
				;
			
			// execute the toolbar command
			if (highlighter && commandName)
				sh.toolbar.items[commandName].execute(highlighter);

			// disable default A click behaviour
			e.preventDefault();
		},
		
		/** Collection of toolbar items. */
		items : {
			// Ordered lis of items in the toolbar. Can't expect `for (var n in items)` to be consistent.
			list: ['expandSource', 'help'],

			expandSource: {
				getHtml: function(highlighter)
				{
					if (highlighter.getParam('collapse') != true)
						return '';
						
					var title = highlighter.getParam('title');
					return sh.toolbar.getButtonHtml(highlighter, 'expandSource', title ? title : sh.config.strings.expandSource);
				},
			
				execute: function(highlighter)
				{
					var div = getHighlighterDivById(highlighter.id);
					removeClass(div, 'collapsed');
				}
			},

			/** Command to display the about dialog window. */
			help: {
				execute: function(highlighter)
				{	
					var wnd = popup('', '_blank', 500, 250, 'scrollbars=0'),
						doc = wnd.document
						;
					
					doc.write(sh.config.strings.aboutDialog);
					doc.close();
					wnd.focus();
				}
			}
		}
	},

	/**
	 * Finds all elements on the page which should be processes by SyntaxHighlighter.
	 *
	 * @param {Object} globalParams		Optional parameters which override element's 
	 * 									parameters. Only used if element is specified.
	 * 
	 * @param {Object} element	Optional element to highlight. If none is
	 * 							provided, all elements in the current document 
	 * 							are returned which qualify.
	 *
	 * @return {Array}	Returns list of <code>{ target: DOMElement, params: Object }</code> objects.
	 */
	findElements: function(globalParams, element)
	{
		var elements = element ? [element] : toArray(document.getElementsByTagName(sh.config.tagName)), 
			conf = sh.config,
			result = []
			;

		// support for <SCRIPT TYPE="syntaxhighlighter" /> feature
		if (conf.useScriptTags)
			elements = elements.concat(getSyntaxHighlighterScriptTags());

		if (elements.length === 0) 
			return result;
	
		for (var i = 0; i < elements.length; i++) 
		{
			var item = {
				target: elements[i], 
				// local params take precedence over globals
				params: merge(globalParams, parseParams(elements[i].className))
			};

			if (item.params['brush'] == null)
				continue;
				
			result.push(item);
		}
		
		return result;
	},

	/**
	 * Shorthand to highlight all elements on the page that are marked as 
	 * SyntaxHighlighter source code.
	 * 
	 * @param {Object} globalParams		Optional parameters which override element's 
	 * 									parameters. Only used if element is specified.
	 * 
	 * @param {Object} element	Optional element to highlight. If none is
	 * 							provided, all elements in the current document 
	 * 							are highlighted.
	 */ 
	highlight: function(globalParams, element)
	{
		var elements = this.findElements(globalParams, element),
			propertyName = 'innerHTML', 
			highlighter = null,
			conf = sh.config
			;

		if (elements.length === 0) 
			return;
	
		for (var i = 0; i < elements.length; i++) 
		{
			var element = elements[i],
				target = element.target,
				params = element.params,
				brushName = params.brush,
				code
				;

			if (brushName == null)
				continue;

			// Instantiate a brush
			if (params['html-script'] == 'true' || sh.defaults['html-script'] == true) 
			{
				highlighter = new sh.HtmlScript(brushName);
				brushName = 'htmlscript';
			}
			else
			{
				var brush = findBrush(brushName);
				
				if (brush)
					highlighter = new brush();
				else
					continue;
			}
			
			code = target[propertyName];
			
			// remove CDATA from <SCRIPT/> tags if it's present
			if (conf.useScriptTags)
				code = stripCData(code);
				
			// Inject title if the attribute is present
			if ((target.title || '') != '')
				params.title = target.title;
				
			params['brush'] = brushName;
			highlighter.init(params);
			element = highlighter.getDiv(code);
			
			// carry over ID
			if ((target.id || '') != '')
				element.id = target.id;
			
			target.parentNode.replaceChild(element, target);
		}
	},

	/**
	 * Main entry point for the SyntaxHighlighter.
	 * @param {Object} params Optional params to apply to all highlighted elements.
	 */
	all: function(params)
	{
		attachEvent(
			window,
			'load',
			function() { sh.highlight(params); }
		);
	}
}; // end of sh

sh['all']			= sh.all;
sh['highlight']		= sh.highlight;

/**
 * Checks if target DOM elements has specified CSS class.
 * @param {DOMElement} target Target DOM element to check.
 * @param {String} className Name of the CSS class to check for.
 * @return {Boolean} Returns true if class name is present, false otherwise.
 */
function hasClass(target, className)
{
	return target.className.indexOf(className) != -1;
};

/**
 * Adds CSS class name to the target DOM element.
 * @param {DOMElement} target Target DOM element.
 * @param {String} className New CSS class to add.
 */
function addClass(target, className)
{
	if (!hasClass(target, className))
		target.className += ' ' + className;
};

/**
 * Removes CSS class name from the target DOM element.
 * @param {DOMElement} target Target DOM element.
 * @param {String} className CSS class to remove.
 */
function removeClass(target, className)
{
	target.className = target.className.replace(className, '');
};

/**
 * Converts the source to array object. Mostly used for function arguments and 
 * lists returned by getElementsByTagName() which aren't Array objects.
 * @param {List} source Source list.
 * @return {Array} Returns array.
 */
function toArray(source)
{
	var result = [];
	
	for (var i = 0; i < source.length; i++) 
		result.push(source[i]);
		
	return result;
};

/**
 * Splits block of text into lines.
 * @param {String} block Block of text.
 * @return {Array} Returns array of lines.
 */
function splitLines(block)
{
	return block.split('\n');
}

/**
 * Generates HTML ID for the highlighter.
 * @param {String} highlighterId Highlighter ID.
 * @return {String} Returns HTML ID.
 */
function getHighlighterId(id)
{
	var prefix = 'highlighter_';
	return id.indexOf(prefix) == 0 ? id : prefix + id;
};

/**
 * Finds Highlighter instance by ID.
 * @param {String} highlighterId Highlighter ID.
 * @return {Highlighter} Returns instance of the highlighter.
 */
function getHighlighterById(id)
{
	return sh.vars.highlighters[getHighlighterId(id)];
};

/**
 * Finds highlighter's DIV container.
 * @param {String} highlighterId Highlighter ID.
 * @return {Element} Returns highlighter's DIV element.
 */
function getHighlighterDivById(id)
{
	return document.getElementById(getHighlighterId(id));
};

/**
 * Stores highlighter so that getHighlighterById() can do its thing. Each
 * highlighter must call this method to preserve itself.
 * @param {Highilghter} highlighter Highlighter instance.
 */
function storeHighlighter(highlighter)
{
	sh.vars.highlighters[getHighlighterId(highlighter.id)] = highlighter;
};

/**
 * Looks for a child or parent node which has specified classname.
 * Equivalent to jQuery's $(container).find(".className")
 * @param {Element} target Target element.
 * @param {String} search Class name or node name to look for.
 * @param {Boolean} reverse If set to true, will go up the node tree instead of down.
 * @return {Element} Returns found child or parent element on null.
 */
function findElement(target, search, reverse /* optional */)
{
	if (target == null)
		return null;
		
	var nodes			= reverse != true ? target.childNodes : [ target.parentNode ],
		propertyToFind	= { '#' : 'id', '.' : 'className' }[search.substr(0, 1)] || 'nodeName',
		expectedValue,
		found
		;

	expectedValue = propertyToFind != 'nodeName'
		? search.substr(1)
		: search.toUpperCase()
		;
		
	// main return of the found node
	if ((target[propertyToFind] || '').indexOf(expectedValue) != -1)
		return target;
	
	for (var i = 0; nodes && i < nodes.length && found == null; i++)
		found = findElement(nodes[i], search, reverse);
	
	return found;
};

/**
 * Looks for a parent node which has specified classname.
 * This is an alias to <code>findElement(container, className, true)</code>.
 * @param {Element} target Target element.
 * @param {String} className Class name to look for.
 * @return {Element} Returns found parent element on null.
 */
function findParentElement(target, className)
{
	return findElement(target, className, true);
};

/**
 * Finds an index of element in the array.
 * @ignore
 * @param {Object} searchElement
 * @param {Number} fromIndex
 * @return {Number} Returns index of element if found; -1 otherwise.
 */
function indexOf(array, searchElement, fromIndex)
{
	fromIndex = Math.max(fromIndex || 0, 0);

	for (var i = fromIndex; i < array.length; i++)
		if(array[i] == searchElement)
			return i;
	
	return -1;
};

/**
 * Generates a unique element ID.
 */
function guid(prefix)
{
	return (prefix || '') + Math.round(Math.random() * 1000000).toString();
};

/**
 * Merges two objects. Values from obj2 override values in obj1.
 * Function is NOT recursive and works only for one dimensional objects.
 * @param {Object} obj1 First object.
 * @param {Object} obj2 Second object.
 * @return {Object} Returns combination of both objects.
 */
function merge(obj1, obj2)
{
	var result = {}, name;

	for (name in obj1) 
		result[name] = obj1[name];
	
	for (name in obj2) 
		result[name] = obj2[name];
		
	return result;
};

/**
 * Attempts to convert string to boolean.
 * @param {String} value Input string.
 * @return {Boolean} Returns true if input was "true", false if input was "false" and value otherwise.
 */
function toBoolean(value)
{
	var result = { "true" : true, "false" : false }[value];
	return result == null ? value : result;
};

/**
 * Opens up a centered popup window.
 * @param {String} url		URL to open in the window.
 * @param {String} name		Popup name.
 * @param {int} width		Popup width.
 * @param {int} height		Popup height.
 * @param {String} options	window.open() options.
 * @return {Window}			Returns window instance.
 */
function popup(url, name, width, height, options)
{
	var x = (screen.width - width) / 2,
		y = (screen.height - height) / 2
		;
		
	options +=	', left=' + x + 
				', top=' + y +
				', width=' + width +
				', height=' + height
		;
	options = options.replace(/^,/, '');

	var win = window.open(url, name, options);
	win.focus();
	return win;
};

/**
 * Adds event handler to the target object.
 * @param {Object} obj		Target object.
 * @param {String} type		Name of the event.
 * @param {Function} func	Handling function.
 */
function attachEvent(obj, type, func, scope)
{
	function handler(e)
	{
		e = e || window.event;
		
		if (!e.target)
		{
			e.target = e.srcElement;
			e.preventDefault = function()
			{
				this.returnValue = false;
			};
		}
			
		func.call(scope || window, e);
	};
	
	if (obj.attachEvent) 
	{
		obj.attachEvent('on' + type, handler);
	}
	else 
	{
		obj.addEventListener(type, handler, false);
	}
};

/**
 * Displays an alert.
 * @param {String} str String to display.
 */
function alert(str)
{
	window.alert(sh.config.strings.alert + str);
};

/**
 * Finds a brush by its alias.
 *
 * @param {String} alias		Brush alias.
 * @param {Boolean} showAlert	Suppresses the alert if false.
 * @return {Brush}				Returns bursh constructor if found, null otherwise.
 */
function findBrush(alias, showAlert)
{
	var brushes = sh.vars.discoveredBrushes,
		result = null
		;
	
	if (brushes == null) 
	{
		brushes = {};
		
		// Find all brushes
		for (var brush in sh.brushes) 
		{
			var info = sh.brushes[brush],
				aliases = info.aliases
				;
			
			if (aliases == null) 
				continue;
			
			// keep the brush name
			info.brushName = brush.toLowerCase();
			
			for (var i = 0; i < aliases.length; i++) 
				brushes[aliases[i]] = brush;
		}
		
		sh.vars.discoveredBrushes = brushes;
	}
	
	result = sh.brushes[brushes[alias]];

	if (result == null && showAlert != false)
		alert(sh.config.strings.noBrush + alias);
	
	return result;
};

/**
 * Executes a callback on each line and replaces each line with result from the callback.
 * @param {Object} str			Input string.
 * @param {Object} callback		Callback function taking one string argument and returning a string.
 */
function eachLine(str, callback)
{
	var lines = splitLines(str);
	
	for (var i = 0; i < lines.length; i++)
		lines[i] = callback(lines[i], i);
		
	return lines.join('\n');
};

/**
 * This is a special trim which only removes first and last empty lines
 * and doesn't affect valid leading space on the first line.
 * 
 * @param {String} str   Input string
 * @return {String}      Returns string without empty first and last lines.
 */
function trimFirstAndLastLines(str)
{
	return str.replace(/^[ ]*[\n]+|[\n]*[ ]*$/g, '');
};

/**
 * Parses key/value pairs into hash object.
 * 
 * Understands the following formats:
 * - name: word;
 * - name: [word, word];
 * - name: "string";
 * - name: 'string';
 * 
 * For example:
 *   name1: value; name2: [value, value]; name3: 'value'
 *   
 * @param {String} str    Input string.
 * @return {Object}       Returns deserialized object.
 */
function parseParams(str)
{
	var match, 
		result = {},
		arrayRegex = new XRegExp("^\\[(?<values>(.*?))\\]$"),
		regex = new XRegExp(
			"(?<name>[\\w-]+)" +
			"\\s*:\\s*" +
			"(?<value>" +
				"[\\w-%#]+|" +		// word
				"\\[.*?\\]|" +		// [] array
				'".*?"|' +			// "" string
				"'.*?'" +			// '' string
			")\\s*;?",
			"g"
		)
		;

	while ((match = regex.exec(str)) != null) 
	{
		var value = match.value
			.replace(/^['"]|['"]$/g, '') // strip quotes from end of strings
			;
		
		// try to parse array value
		if (value != null && arrayRegex.test(value))
		{
			var m = arrayRegex.exec(value);
			value = m.values.length > 0 ? m.values.split(/\s*,\s*/) : [];
		}
		
		result[match.name] = value;
	}
	
	return result;
};

/**
 * Wraps each line of the string into <code/> tag with given style applied to it.
 * 
 * @param {String} str   Input string.
 * @param {String} css   Style name to apply to the string.
 * @return {String}      Returns input string with each line surrounded by <span/> tag.
 */
function wrapLinesWithCode(str, css)
{
	if (str == null || str.length == 0 || str == '\n') 
		return str;

	str = str.replace(/</g, '&lt;');

	// Replace two or more sequential spaces with &nbsp; leaving last space untouched.
	str = str.replace(/ {2,}/g, function(m)
	{
		var spaces = '';
		
		for (var i = 0; i < m.length - 1; i++)
			spaces += sh.config.space;
		
		return spaces + ' ';
	});

	// Split each line and apply <span class="...">...</span> to them so that
	// leading spaces aren't included.
	if (css != null) 
		str = eachLine(str, function(line)
		{
			if (line.length == 0) 
				return '';
			
			var spaces = '';
			
			line = line.replace(/^(&nbsp;| )+/, function(s)
			{
				spaces = s;
				return '';
			});
			
			if (line.length == 0) 
				return spaces;
			
			return spaces + '<code class="' + css + '">' + line + '</code>';
		});

	return str;
};

/**
 * Pads number with zeros until it's length is the same as given length.
 * 
 * @param {Number} number	Number to pad.
 * @param {Number} length	Max string length with.
 * @return {String}			Returns a string padded with proper amount of '0'.
 */
function padNumber(number, length)
{
	var result = number.toString();
	
	while (result.length < length)
		result = '0' + result;
	
	return result;
};

/**
 * Replaces tabs with spaces.
 * 
 * @param {String} code		Source code.
 * @param {Number} tabSize	Size of the tab.
 * @return {String}			Returns code with all tabs replaces by spaces.
 */
function processTabs(code, tabSize)
{
	var tab = '';
	
	for (var i = 0; i < tabSize; i++)
		tab += ' ';

	return code.replace(/\t/g, tab);
};

/**
 * Replaces tabs with smart spaces.
 * 
 * @param {String} code    Code to fix the tabs in.
 * @param {Number} tabSize Number of spaces in a column.
 * @return {String}        Returns code with all tabs replaces with roper amount of spaces.
 */
function processSmartTabs(code, tabSize)
{
	var lines = splitLines(code),
		tab = '\t',
		spaces = ''
		;
	
	// Create a string with 1000 spaces to copy spaces from... 
	// It's assumed that there would be no indentation longer than that.
	for (var i = 0; i < 50; i++) 
		spaces += '                    '; // 20 spaces * 50
			
	// This function inserts specified amount of spaces in the string
	// where a tab is while removing that given tab.
	function insertSpaces(line, pos, count)
	{
		return line.substr(0, pos)
			+ spaces.substr(0, count)
			+ line.substr(pos + 1, line.length) // pos + 1 will get rid of the tab
			;
	};

	// Go through all the lines and do the 'smart tabs' magic.
	code = eachLine(code, function(line)
	{
		if (line.indexOf(tab) == -1) 
			return line;
		
		var pos = 0;
		
		while ((pos = line.indexOf(tab)) != -1) 
		{
			// This is pretty much all there is to the 'smart tabs' logic.
			// Based on the position within the line and size of a tab,
			// calculate the amount of spaces we need to insert.
			var spaces = tabSize - pos % tabSize;
			line = insertSpaces(line, pos, spaces);
		}
		
		return line;
	});
	
	return code;
};

/**
 * Performs various string fixes based on configuration.
 */
function fixInputString(str)
{
	var br = /<br\s*\/?>|&lt;br\s*\/?&gt;/gi;
	
	if (sh.config.bloggerMode == true)
		str = str.replace(br, '\n');

	if (sh.config.stripBrs == true)
		str = str.replace(br, '');
		
	return str;
};

/**
 * Removes all white space at the begining and end of a string.
 * 
 * @param {String} str   String to trim.
 * @return {String}      Returns string without leading and following white space characters.
 */
function trim(str)
{
	return str.replace(/^\s+|\s+$/g, '');
};

/**
 * Unindents a block of text by the lowest common indent amount.
 * @param {String} str   Text to unindent.
 * @return {String}      Returns unindented text block.
 */
function unindent(str)
{
	var lines = splitLines(fixInputString(str)),
		indents = new Array(),
		regex = /^\s*/,
		min = 1000
		;
	
	// go through every line and check for common number of indents
	for (var i = 0; i < lines.length && min > 0; i++) 
	{
		var line = lines[i];
		
		if (trim(line).length == 0) 
			continue;
		
		var matches = regex.exec(line);
		
		// In the event that just one line doesn't have leading white space
		// we can't unindent anything, so bail completely.
		if (matches == null) 
			return str;
			
		min = Math.min(matches[0].length, min);
	}
	
	// trim minimum common number of white space from the begining of every line
	if (min > 0) 
		for (var i = 0; i < lines.length; i++) 
			lines[i] = lines[i].substr(min);
	
	return lines.join('\n');
};

/**
 * Callback method for Array.sort() which sorts matches by
 * index position and then by length.
 * 
 * @param {Match} m1	Left object.
 * @param {Match} m2    Right object.
 * @return {Number}     Returns -1, 0 or -1 as a comparison result.
 */
function matchesSortCallback(m1, m2)
{
	// sort matches by index first
	if(m1.index < m2.index)
		return -1;
	else if(m1.index > m2.index)
		return 1;
	else
	{
		// if index is the same, sort by length
		if(m1.length < m2.length)
			return -1;
		else if(m1.length > m2.length)
			return 1;
	}
	
	return 0;
};

/**
 * Executes given regular expression on provided code and returns all
 * matches that are found.
 * 
 * @param {String} code    Code to execute regular expression on.
 * @param {Object} regex   Regular expression item info from <code>regexList</code> collection.
 * @return {Array}         Returns a list of Match objects.
 */ 
function getMatches(code, regexInfo)
{
	function defaultAdd(match, regexInfo)
	{
		return match[0];
	};
	
	var index = 0,
		match = null,
		matches = [],
		func = regexInfo.func ? regexInfo.func : defaultAdd
		;
	
	while((match = regexInfo.regex.exec(code)) != null)
	{
		var resultMatch = func(match, regexInfo);
		
		if (typeof(resultMatch) == 'string')
			resultMatch = [new sh.Match(resultMatch, match.index, regexInfo.css)];

		matches = matches.concat(resultMatch);
	}
	
	return matches;
};

/**
 * Turns all URLs in the code into <a/> tags.
 * @param {String} code Input code.
 * @return {String} Returns code with </a> tags.
 */
function processUrls(code)
{
	var gt = /(.*)((&gt;|&lt;).*)/;
	
	return code.replace(sh.regexLib.url, function(m)
	{
		var suffix = '',
			match = null
			;
		
		// We include &lt; and &gt; in the URL for the common cases like <http://google.com>
		// The problem is that they get transformed into &lt;http://google.com&gt;
		// Where as &gt; easily looks like part of the URL string.
	
		if (match = gt.exec(m))
		{
			m = match[1];
			suffix = match[2];
		}
		
		return '<a href="' + m + '">' + m + '</a>' + suffix;
	});
};

/**
 * Finds all <SCRIPT TYPE="syntaxhighlighter" /> elementss.
 * @return {Array} Returns array of all found SyntaxHighlighter tags.
 */
function getSyntaxHighlighterScriptTags()
{
	var tags = document.getElementsByTagName('script'),
		result = []
		;
	
	for (var i = 0; i < tags.length; i++)
		if (tags[i].type == 'syntaxhighlighter')
			result.push(tags[i]);
			
	return result;
};

/**
 * Strips <![CDATA[]]> from <SCRIPT /> content because it should be used
 * there in most cases for XHTML compliance.
 * @param {String} original	Input code.
 * @return {String} Returns code without leading <![CDATA[]]> tags.
 */
function stripCData(original)
{
	var left = '<![CDATA[',
		right = ']]>',
		// for some reason IE inserts some leading blanks here
		copy = trim(original),
		changed = false,
		leftLength = left.length,
		rightLength = right.length
		;
	
	if (copy.indexOf(left) == 0)
	{
		copy = copy.substring(leftLength);
		changed = true;
	}
	
	var copyLength = copy.length;
	
	if (copy.indexOf(right) == copyLength - rightLength)
	{
		copy = copy.substring(0, copyLength - rightLength);
		changed = true;
	}
	
	return changed ? copy : original;
};


/**
 * Quick code mouse double click handler.
 */
function quickCodeHandler(e)
{
	var target = e.target,
		highlighterDiv = findParentElement(target, '.syntaxhighlighter'),
		container = findParentElement(target, '.container'),
		textarea = document.createElement('textarea'),
		highlighter
		;

	if (!container || !highlighterDiv || findElement(container, 'textarea'))
		return;

	highlighter = getHighlighterById(highlighterDiv.id);
	
	// add source class name
	addClass(highlighterDiv, 'source');

	// Have to go over each line and grab it's text, can't just do it on the
	// container because Firefox loses all \n where as Webkit doesn't.
	var lines = container.childNodes,
		code = []
		;
	
	for (var i = 0; i < lines.length; i++)
		code.push(lines[i].innerText || lines[i].textContent);
	
	// using \r instead of \r or \r\n makes this work equally well on IE, FF and Webkit
	code = code.join('\r');
	
	// inject <textarea/> tag
	textarea.appendChild(document.createTextNode(code));
	container.appendChild(textarea);
	
	// preselect all text
	textarea.focus();
	textarea.select();
	
	// set up handler for lost focus
	attachEvent(textarea, 'blur', function(e)
	{
		textarea.parentNode.removeChild(textarea);
		removeClass(highlighterDiv, 'source');
	});
};

/**
 * Match object.
 */
sh.Match = function(value, index, css)
{
	this.value = value;
	this.index = index;
	this.length = value.length;
	this.css = css;
	this.brushName = null;
};

sh.Match.prototype.toString = function()
{
	return this.value;
};

/**
 * Simulates HTML code with a scripting language embedded.
 * 
 * @param {String} scriptBrushName Brush name of the scripting language.
 */
sh.HtmlScript = function(scriptBrushName)
{
	var brushClass = findBrush(scriptBrushName),
		scriptBrush,
		xmlBrush = new sh.brushes.Xml(),
		bracketsRegex = null,
		ref = this,
		methodsToExpose = 'getDiv getHtml init'.split(' ')
		;

	if (brushClass == null)
		return;
	
	scriptBrush = new brushClass();
	
	for(var i = 0; i < methodsToExpose.length; i++)
		// make a closure so we don't lose the name after i changes
		(function() {
			var name = methodsToExpose[i];
			
			ref[name] = function()
			{
				return xmlBrush[name].apply(xmlBrush, arguments);
			};
		})();
	
	if (scriptBrush.htmlScript == null)
	{
		alert(sh.config.strings.brushNotHtmlScript + scriptBrushName);
		return;
	}
	
	xmlBrush.regexList.push(
		{ regex: scriptBrush.htmlScript.code, func: process }
	);
	
	function offsetMatches(matches, offset)
	{
		for (var j = 0; j < matches.length; j++) 
			matches[j].index += offset;
	}
	
	function process(match, info)
	{
		var code = match.code,
			matches = [],
			regexList = scriptBrush.regexList,
			offset = match.index + match.left.length,
			htmlScript = scriptBrush.htmlScript,
			result
			;

		// add all matches from the code
		for (var i = 0; i < regexList.length; i++)
		{
			result = getMatches(code, regexList[i]);
			offsetMatches(result, offset);
			matches = matches.concat(result);
		}
		
		// add left script bracket
		if (htmlScript.left != null && match.left != null)
		{
			result = getMatches(match.left, htmlScript.left);
			offsetMatches(result, match.index);
			matches = matches.concat(result);
		}
		
		// add right script bracket
		if (htmlScript.right != null && match.right != null)
		{
			result = getMatches(match.right, htmlScript.right);
			offsetMatches(result, match.index + match[0].lastIndexOf(match.right));
			matches = matches.concat(result);
		}
		
		for (var j = 0; j < matches.length; j++)
			matches[j].brushName = brushClass.brushName;
			
		return matches;
	}
};

/**
 * Main Highlither class.
 * @constructor
 */
sh.Highlighter = function()
{
	// not putting any code in here because of the prototype inheritance
};

sh.Highlighter.prototype = {
	/**
	 * Returns value of the parameter passed to the highlighter.
	 * @param {String} name				Name of the parameter.
	 * @param {Object} defaultValue		Default value.
	 * @return {Object}					Returns found value or default value otherwise.
	 */
	getParam: function(name, defaultValue)
	{
		var result = this.params[name];
		return toBoolean(result == null ? defaultValue : result);
	},
	
	/**
	 * Shortcut to document.createElement().
	 * @param {String} name		Name of the element to create (DIV, A, etc).
	 * @return {HTMLElement}	Returns new HTML element.
	 */
	create: function(name)
	{
		return document.createElement(name);
	},
	
	/**
	 * Applies all regular expression to the code and stores all found
	 * matches in the `this.matches` array.
	 * @param {Array} regexList		List of regular expressions.
	 * @param {String} code			Source code.
	 * @return {Array}				Returns list of matches.
	 */
	findMatches: function(regexList, code)
	{
		var result = [];
		
		if (regexList != null)
			for (var i = 0; i < regexList.length; i++) 
				// BUG: length returns len+1 for array if methods added to prototype chain (oising@gmail.com)
				if (typeof (regexList[i]) == "object")
					result = result.concat(getMatches(code, regexList[i]));
		
		// sort and remove nested the matches
		return this.removeNestedMatches(result.sort(matchesSortCallback));
	},
	
	/**
	 * Checks to see if any of the matches are inside of other matches. 
	 * This process would get rid of highligted strings inside comments, 
	 * keywords inside strings and so on.
	 */
	removeNestedMatches: function(matches)
	{
		// Optimized by Jose Prado (http://joseprado.com)
		for (var i = 0; i < matches.length; i++) 
		{ 
			if (matches[i] === null)
				continue;
			
			var itemI = matches[i],
				itemIEndPos = itemI.index + itemI.length
				;
			
			for (var j = i + 1; j < matches.length && matches[i] !== null; j++) 
			{
				var itemJ = matches[j];
				
				if (itemJ === null) 
					continue;
				else if (itemJ.index > itemIEndPos) 
					break;
				else if (itemJ.index == itemI.index && itemJ.length > itemI.length)
					matches[i] = null;
				else if (itemJ.index >= itemI.index && itemJ.index < itemIEndPos) 
					matches[j] = null;
			}
		}
		
		return matches;
	},
	
	/**
	 * Creates an array containing integer line numbers starting from the 'first-line' param.
	 * @return {Array} Returns array of integers.
	 */
	figureOutLineNumbers: function(code)
	{
		var lines = [],
			firstLine = parseInt(this.getParam('first-line'))
			;
		
		eachLine(code, function(line, index)
		{
			lines.push(index + firstLine);
		});
		
		return lines;
	},
	
	/**
	 * Determines if specified line number is in the highlighted list.
	 */
	isLineHighlighted: function(lineNumber)
	{
		var list = this.getParam('highlight', []);
		
		if (typeof(list) != 'object' && list.push == null) 
			list = [ list ];
		
		return indexOf(list, lineNumber.toString()) != -1;
	},
	
	/**
	 * Generates HTML markup for a single line of code while determining alternating line style.
	 * @param {Integer} lineNumber	Line number.
	 * @param {String} code Line	HTML markup.
	 * @return {String}				Returns HTML markup.
	 */
	getLineHtml: function(lineIndex, lineNumber, code)
	{
		var classes = [
			'line',
			'number' + lineNumber,
			'index' + lineIndex,
			'alt' + (lineNumber % 2 == 0 ? 1 : 2).toString()
		];
		
		if (this.isLineHighlighted(lineNumber))
		 	classes.push('highlighted');
		
		if (lineNumber == 0)
			classes.push('break');
			
		return '<div class="' + classes.join(' ') + '">' + code + '</div>';
	},
	
	/**
	 * Generates HTML markup for line number column.
	 * @param {String} code			Complete code HTML markup.
	 * @param {Array} lineNumbers	Calculated line numbers.
	 * @return {String}				Returns HTML markup.
	 */
	getLineNumbersHtml: function(code, lineNumbers)
	{
		var html = '',
			count = splitLines(code).length,
			firstLine = parseInt(this.getParam('first-line')),
			pad = this.getParam('pad-line-numbers')
			;
		
		if (pad == true)
			pad = (firstLine + count - 1).toString().length;
		else if (isNaN(pad) == true)
			pad = 0;
			
		for (var i = 0; i < count; i++)
		{
			var lineNumber = lineNumbers ? lineNumbers[i] : firstLine + i,
				code = lineNumber == 0 ? sh.config.space : padNumber(lineNumber, pad)
				;
				
			html += this.getLineHtml(i, lineNumber, code);
		}
		
		return html;
	},
	
	/**
	 * Splits block of text into individual DIV lines.
	 * @param {String} code			Code to highlight.
	 * @param {Array} lineNumbers	Calculated line numbers.
	 * @return {String}				Returns highlighted code in HTML form.
	 */
	getCodeLinesHtml: function(html, lineNumbers)
	{
		html = trim(html);
		
		var lines = splitLines(html),
			padLength = this.getParam('pad-line-numbers'),
			firstLine = parseInt(this.getParam('first-line')),
			html = '',
			brushName = this.getParam('brush')
			;

		for (var i = 0; i < lines.length; i++)
		{
			var line = lines[i],
				indent = /^(&nbsp;|\s)+/.exec(line),
				spaces = null,
				lineNumber = lineNumbers ? lineNumbers[i] : firstLine + i;
				;

			if (indent != null)
			{
				spaces = indent[0].toString();
				line = line.substr(spaces.length);
				spaces = spaces.replace(' ', sh.config.space);
			}

			line = trim(line);
			
			if (line.length == 0)
				line = sh.config.space;
			
			html += this.getLineHtml(
				i,
				lineNumber, 
				(spaces != null ? '<code class="' + brushName + ' spaces">' + spaces + '</code>' : '') + line
			);
		}
		
		return html;
	},
	
	/**
	 * Returns HTML for the table title or empty string if title is null.
	 */
	getTitleHtml: function(title)
	{
		return title ? '<caption>' + title + '</caption>' : '';
	},
	
	/**
	 * Finds all matches in the source code.
	 * @param {String} code		Source code to process matches in.
	 * @param {Array} matches	Discovered regex matches.
	 * @return {String} Returns formatted HTML with processed mathes.
	 */
	getMatchesHtml: function(code, matches)
	{
		var pos = 0, 
			result = '',
			brushName = this.getParam('brush', '')
			;
		
		function getBrushNameCss(match)
		{
			var result = match ? (match.brushName || brushName) : brushName;
			return result ? result + ' ' : '';
		};
		
		// Finally, go through the final list of matches and pull the all
		// together adding everything in between that isn't a match.
		for (var i = 0; i < matches.length; i++) 
		{
			var match = matches[i],
				matchBrushName
				;
			
			if (match === null || match.length === 0) 
				continue;
			
			matchBrushName = getBrushNameCss(match);
			
			result += wrapLinesWithCode(code.substr(pos, match.index - pos), matchBrushName + 'plain')
					+ wrapLinesWithCode(match.value, matchBrushName + match.css)
					;

			pos = match.index + match.length + (match.offset || 0);
		}

		// don't forget to add whatever's remaining in the string
		result += wrapLinesWithCode(code.substr(pos), getBrushNameCss() + 'plain');

		return result;
	},
	
	/**
	 * Generates HTML markup for the whole syntax highlighter.
	 * @param {String} code Source code.
	 * @return {String} Returns HTML markup.
	 */
	getHtml: function(code)
	{
		var html = '',
			classes = [ 'syntaxhighlighter' ],
			tabSize,
			matches,
			lineNumbers
			;
		
		// process light mode
		if (this.getParam('light') == true)
			this.params.toolbar = this.params.gutter = false;

		className = 'syntaxhighlighter';

		if (this.getParam('collapse') == true)
			classes.push('collapsed');
		
		if ((gutter = this.getParam('gutter')) == false)
			classes.push('nogutter');

		// add custom user style name
		classes.push(this.getParam('class-name'));

		// add brush alias to the class name for custom CSS
		classes.push(this.getParam('brush'));

		code = trimFirstAndLastLines(code)
			.replace(/\r/g, ' ') // IE lets these buggers through
			;

		tabSize = this.getParam('tab-size');

		// replace tabs with spaces
		code = this.getParam('smart-tabs') == true
			? processSmartTabs(code, tabSize)
			: processTabs(code, tabSize)
			;

		// unindent code by the common indentation
		code = unindent(code);

		if (gutter)
			lineNumbers = this.figureOutLineNumbers(code);
		
		// find matches in the code using brushes regex list
		matches = this.findMatches(this.regexList, code);
		// processes found matches into the html
		html = this.getMatchesHtml(code, matches);
		// finally, split all lines so that they wrap well
		html = this.getCodeLinesHtml(html, lineNumbers);

		// finally, process the links
		if (this.getParam('auto-links'))
			html = processUrls(html);
		
		if (typeof(navigator) != 'undefined' && navigator.userAgent && navigator.userAgent.match(/MSIE/))
			classes.push('ie');
		
		html = 
			'<div id="' + getHighlighterId(this.id) + '" class="' + classes.join(' ') + '">'
				+ (this.getParam('toolbar') ? sh.toolbar.getHtml(this) : '')
				+ '<table border="0" cellpadding="0" cellspacing="0">'
					+ this.getTitleHtml(this.getParam('title'))
					+ '<tbody>'
						+ '<tr>'
							+ (gutter ? '<td class="gutter">' + this.getLineNumbersHtml(code) + '</td>' : '')
							+ '<td class="code">'
								+ '<div class="container">'
									+ html
								+ '</div>'
							+ '</td>'
						+ '</tr>'
					+ '</tbody>'
				+ '</table>'
			+ '</div>'
			;
			
		return html;
	},
	
	/**
	 * Highlights the code and returns complete HTML.
	 * @param {String} code     Code to highlight.
	 * @return {Element}        Returns container DIV element with all markup.
	 */
	getDiv: function(code)
	{
		if (code === null) 
			code = '';
		
		this.code = code;

		var div = this.create('div');

		// create main HTML
		div.innerHTML = this.getHtml(code);
		
		// set up click handlers
		if (this.getParam('toolbar'))
			attachEvent(findElement(div, '.toolbar'), 'click', sh.toolbar.handler);
		
		if (this.getParam('quick-code'))
			attachEvent(findElement(div, '.code'), 'dblclick', quickCodeHandler);
		
		return div;
	},
	
	/**
	 * Initializes the highlighter/brush.
	 *
	 * Constructor isn't used for initialization so that nothing executes during necessary
	 * `new SyntaxHighlighter.Highlighter()` call when setting up brush inheritence.
	 *
	 * @param {Hash} params Highlighter parameters.
	 */
	init: function(params)
	{
		this.id = guid();
		
		// register this instance in the highlighters list
		storeHighlighter(this);
		
		// local params take precedence over defaults
		this.params = merge(sh.defaults, params || {})
		
		// process light mode
		if (this.getParam('light') == true)
			this.params.toolbar = this.params.gutter = false;
	},
	
	/**
	 * Converts space separated list of keywords into a regular expression string.
	 * @param {String} str    Space separated keywords.
	 * @return {String}       Returns regular expression string.
	 */
	getKeywords: function(str)
	{
		str = str
			.replace(/^\s+|\s+$/g, '')
			.replace(/\s+/g, '|')
			;
		
		return '\\b(?:' + str + ')\\b';
	},
	
	/**
	 * Makes a brush compatible with the `html-script` functionality.
	 * @param {Object} regexGroup Object containing `left` and `right` regular expressions.
	 */
	forHtmlScript: function(regexGroup)
	{
		this.htmlScript = {
			left : { regex: regexGroup.left, css: 'script' },
			right : { regex: regexGroup.right, css: 'script' },
			code : new XRegExp(
				"(?<left>" + regexGroup.left.source + ")" +
				"(?<code>.*?)" +
				"(?<right>" + regexGroup.right.source + ")",
				"sgi"
				)
		};
	}
}; // end of Highlighter

return sh;
}(); // end of anonymous function

// CommonJS
typeof(exports) != 'undefined' ? exports['SyntaxHighlighter'] = SyntaxHighlighter : null;
</script><script type="text/javascript">/*!
 * Copyright  2010 Sattvik Software & Technology Resources, Ltd. Co.
 * All rights reserved.
 *
 * sh-clojure may be used under the terms of either the GNU Lesser General Public
 * License (LGPL) or the Eclipse Public License (EPL).  As a recipient of
 * sh-clojure, you may choose which license to receive the code under.  See the
 * LICENSE file distributed with sh-clojure for details.
 *
 * Written by Daniel Solano Gmez
 *
 * Version 0.9.1 - 10 Apr 2010
 */

function ClojureRegExp(pattern) {
	pattern = pattern + '(?=[[\\]{}(),\\s])';
	this.regex = new RegExp(pattern, 'g');
	this.lookBehind = /[\[\]{}(),\s]$/;
}

ClojureRegExp.prototype.exec = function (str) {
	var match, leftContext;
	while (match=this.regex.exec(str)) {
		leftContext = str.substring(0, match.index);
		if (this.lookBehind.test(leftContext)) {
			return match;
		}
		else {
			this.regex.lastIndex = match.index + 1;
		}
	}
	return null;
};

SyntaxHighlighter.brushes.Clojure = function () {
	var special_forms =
			'. def do fn if let loop monitor-enter monitor-exit new quote recur set! ' +
			'throw try var',
	    clojure_core =
			'* *1 *2 *3 *agent* *allow-unresolved-vars* *assert* *clojure-version* ' +
			'*command-line-args* *compile-files* *compile-path* *e *err* *file* ' +
			'*flush-on-newline* *in* *macro-meta* *math-context* *ns* *out* ' +
			'*print-dup* *print-length* *print-level* *print-meta* *print-readably* ' +
			'*read-eval* *source-path* *use-context-classloader* ' +
			'*warn-on-reflection* + - -> -&gt; ->> -&gt;&gt; .. / < &lt; <= &lt;= = ' +
			'== > &gt; >= &gt;= accessor aclone ' +
			'add-classpath add-watch agent agent-errors aget alength alias all-ns ' +
			'alter alter-meta! alter-var-root amap ancestors and apply areduce ' +
			'array-map aset aset-boolean aset-byte aset-char aset-double aset-float ' +
			'aset-int aset-long aset-short assert assoc assoc! assoc-in associative? ' +
			'atom await await-for await1 bases bean bigdec bigint binding bit-and ' +
			'bit-and-not bit-clear bit-flip bit-not bit-or bit-set bit-shift-left ' +
			'bit-shift-right bit-test bit-xor boolean boolean-array booleans ' +
			'bound-fn bound-fn* butlast byte byte-array bytes cast char char-array ' +
			'char-escape-string char-name-string char? chars chunk chunk-append ' +
			'chunk-buffer chunk-cons chunk-first chunk-next chunk-rest chunked-seq? ' +
			'class class? clear-agent-errors clojure-version coll? comment commute ' +
			'comp comparator compare compare-and-set! compile complement concat cond ' +
			'condp conj conj! cons constantly construct-proxy contains? count ' +
			'counted? create-ns create-struct cycle dec decimal? declare definline ' +
			'defmacro defmethod defmulti defn defn- defonce defstruct delay delay? ' +
			'deliver deref derive descendants destructure disj disj! dissoc dissoc! ' +
			'distinct distinct? doall doc dorun doseq dosync dotimes doto double ' +
			'double-array doubles drop drop-last drop-while empty empty? ensure ' +
			'enumeration-seq eval even? every? false? ffirst file-seq filter find ' +
			'find-doc find-ns find-var first float float-array float? floats flush ' +
			'fn fn? fnext for force format future future-call future-cancel ' +
			'future-cancelled? future-done? future? gen-class gen-interface gensym ' +
			'get get-in get-method get-proxy-class get-thread-bindings get-validator ' +
			'hash hash-map hash-set identical? identity if-let if-not ifn? import ' +
			'in-ns inc init-proxy instance? int int-array integer? interleave intern ' +
			'interpose into into-array ints io! isa? iterate iterator-seq juxt key ' +
			'keys keyword keyword? last lazy-cat lazy-seq let letfn line-seq list ' +
			'list* list? load load-file load-reader load-string loaded-libs locking ' +
			'long long-array longs loop macroexpand macroexpand-1 make-array ' +
			'make-hierarchy map map? mapcat max max-key memfn memoize merge ' +
			'merge-with meta method-sig methods min min-key mod name namespace neg? ' +
			'newline next nfirst nil? nnext not not-any? not-empty not-every? not= ' +
			'	ns ns-aliases ns-imports ns-interns ns-map ns-name ns-publics ' +
			'ns-refers ns-resolve ns-unalias ns-unmap nth nthnext num number? odd? ' +
			'or parents partial partition pcalls peek persistent! pmap pop pop! ' +
			'pop-thread-bindings pos? pr pr-str prefer-method prefers ' +
			'primitives-classnames print print-ctor print-doc print-dup print-method ' +
			'print-namespace-doc print-simple print-special-doc print-str printf ' +
			'println println-str prn prn-str promise proxy proxy-call-with-super ' +
			'proxy-mappings proxy-name proxy-super push-thread-bindings pvalues quot ' +
			'rand rand-int range ratio? rational? rationalize re-find re-groups ' +
			're-matcher re-matches re-pattern re-seq read read-line read-string ' +
			'reduce ref ref-history-count ref-max-history ref-min-history ref-set ' +
			'refer refer-clojure release-pending-sends rem remove remove-method ' +
			'remove-ns remove-watch repeat repeatedly replace replicate require ' +
			'reset! reset-meta! resolve rest resultset-seq reverse reversible? rseq ' +
			'rsubseq second select-keys send send-off seq seq? seque sequence ' +
			'sequential? set set-validator! set? short short-array shorts ' +
			'shutdown-agents slurp some sort sort-by sorted-map sorted-map-by ' +
			'sorted-set sorted-set-by sorted? special-form-anchor special-symbol? ' +
			'split-at split-with str stream? string? struct struct-map subs subseq ' +
			'subvec supers swap! symbol symbol? sync syntax-symbol-anchor take ' +
			'take-last take-nth take-while test the-ns time to-array to-array-2d ' +
			'trampoline transient tree-seq true? type unchecked-add unchecked-dec ' +
			'unchecked-divide unchecked-inc unchecked-multiply unchecked-negate ' +
			'unchecked-remainder unchecked-subtract underive unquote ' +
			'unquote-splicing update-in update-proxy use val vals var-get var-set ' +
			'var? vary-meta vec vector vector? when when-first when-let when-not ' +
			'while with-bindings with-bindings* with-in-str with-loading-context ' +
			'with-local-vars with-meta with-open with-out-str with-precision xml-seq ' +
			'zero? zipmap ';

	this.getKeywords = function (keywordStr) {
		// quote special characters
		keywordStr = keywordStr.replace(/[\-\[\]{}()*+?.\\\^$|,#]/g, "\\$&");
		// trim whitespace and convert to alternatives
		keywordStr = keywordStr.replace(/^\s+|\s+$/g, '').replace(/\s+/g, '|');
		// create pattern
		return '(?:' + keywordStr + ')';
	};

	this.regexList = [
		// comments
		{ regex: new RegExp(';.*$', 'gm'),
			css: 'comments' },
		// strings
		{ regex: SyntaxHighlighter.regexLib.multiLineDoubleQuotedString,
			css: 'string' },
		// regular expressions
		{ regex: /#"(?:\.|(\\\")|[^\""\n])*"/g,
			css: 'string' },
		// vectors
		{ regex: /\[|\]/g,
			css: 'keyword' },
		// amperstands
		{ regex: /&(amp;)?/g,
			css: 'keyword' },
		// sets and maps
		{ regex: /#?\{|\}/g,
			css: 'keyword' },
		// metadata
		{ regex: /#\^\{/g,
			css: 'keyword' },
		// anonymous fn syntactic sugar
		{ regex: /#\(|%/g,
			css: 'keyword' },
		// deref reader macro
		{ regex: /@/g,
			css: 'keyword' },
		// (un)quoted sexprs
		{ regex: /(['`]|~@?)[\[({]/g,
			css: 'keyword' },
		// lists
		{ regex: /\(|\)/g,
			css: 'keyword' },
		// character literals
		{ regex: /\\.\b/g,
			css: 'value' },
		// hexadecimal literals
		{ regex: /[+\-]?\b0x[0-9A-F]+\b/gi,
			css: 'value' },
		// integer/octal/float/bigdecimal literals
		{ regex: new ClojureRegExp("[+-]?\\b\\d+(\\.\\d*)?([eE][+-]?\\d+|M)?\\b"),
			css: 'value' },
		{ regex: /^[+\-]?\b\d+(\.\d*)?([eE][+\-]?\d+|M)?\b/g,
			css: 'value' },
		// booleans+nil
		{ regex: /\b(true|false|nil)\b/g,
			css: 'value' },
		// (un)quoted symbols
		{ regex: /(`|#?'|~@?)[\w-.A-Za-z0-9_&lt;&gt;\-]+/g,
			css: 'color1' },
		// keywords
		{ regex: /:[A-Za-z0-9_\-]+/g,
			css: 'constants' },
		// special forms
		{ regex: new ClojureRegExp(this.getKeywords(special_forms)),
			css: 'preprocessor' },
		// type hints
		{ regex: /\#\^[A-Za-z]\w*/g,
			css: 'preprocessor' },
		// clojure.core
		{ regex: new ClojureRegExp(this.getKeywords(clojure_core)),
			css: 'functions' },
                { regex: /[A-Za-z0-9_&lt;&gt;\-]+/g,  css: 'plain'}
	];

	this.forHtmlScript(SyntaxHighlighter.regexLib.scriptScriptTags);
};

SyntaxHighlighter.brushes.Clojure.prototype = new SyntaxHighlighter.Highlighter();
SyntaxHighlighter.brushes.Clojure.aliases   = ['clojure', 'Clojure', 'clj'];

// vim: ts=2 sw=2 noet
</script><script type="text/javascript">
// hackity-hack

$(document).ready(function() {
    var ft = $("#floating-toc")
    var ul = ft.find('ul')
    var lis = ft.find('li')

    ul.css('maring', '0px')

    var liHeight = $(lis.get(0)).height()

    ft.css('height', (liHeight) + 'px')


    showNs = function(ns) {
        //this is killing performance, lookup table.
        //var el = $("[id='floating-toc_" + ns + "']")
        //var index = lis.index(el)

        var index = 0

        for(i in nsPositions.nss) {
            if(ns == nsPositions.nss[i]) index = i
        }

        console.log(index)

        if(index == lastNsIndex) return;

        lastNsIndex = index


        ul.animate({marginTop: (-1 * liHeight * index) + 'px'},
               300)
        //        ul.css('margin-top', (-1 * liHeight * index) + 'px')

    }

    var calcNsPositions = function() {
        var nss = []
        var anchors = []
        var positions = []
        $.each(lis, function(i, el) {
            var ns = $(el).attr('id').split('_')[1]
            nss.push(ns)
            var a = $("a[name='"+ns+"']")
            anchors.push(a)
            positions.push(a.offset().top)
            console.log(a.offset().top)
        });

        return {nss: nss, positions: positions}
    }

    var nsPositions = calcNsPositions()

    console.log(nsPositions)

    var lastNsIndex = -1

    var $window = $(window)

    var currentSection = function(nsp) {

        var ps = nsp.positions
        var nss = nsp.nss
        var scroll = $window.scrollTop() + 300
        var nsIndex = -1
        for(var i in ps) {
            var p = ps[i]
            if(p >= scroll) {
                nsIndex = i-1
                break;
            }
                
        }

        if(nsIndex == -1 && scroll >= ps[0]) {
            nsIndex = ps.length-1
        }

        if(nsIndex == -1) nsIndex = 0

        return nss[nsIndex]
    }

    $(window).scroll(function(e) {
        showNs(currentSection(nsPositions))
    })

    ul.css('margin-top', '0px')

})
</script><title>[local-repo (str "file://" (System/getProperty "user.dir") "/repo")] -- Marginalia</title></head><body><table><tr><td class="docs"><div class="header"><h1 class="project-name">[local-repo (str "file://" (System/getProperty "user.dir") "/repo")]</h1><h2 class="project-version">defprojectsistemi0.1descriptionSistemi Moderni Websiterepositories{"local" {:url (clojure.core/unquote local-repo), :snapshots false, :releases {:checksum :ignore, :update :always}}}dependencies<><slingshot>0.5.0</slingshot><tools class="logging">0.1.2</tools><clj-logging-config>1.7.0</clj-logging-config><slf4j-api>1.6.1</slf4j-api><slf4j-log4j12>1.6.1</slf4j-log4j12><log4j>1.2.16</log4j><ring-core>0.3.11</ring-core><ring-devel>0.3.11</ring-devel><ring-jetty-adapter>0.3.11</ring-jetty-adapter><moustache>1.0.0</moustache><enlive>1.0.0</enlive><ring-persistent-cookies>0.1.0</ring-persistent-cookies><gdata-core-minimal>1.0</gdata-core-minimal><clj-http>0.2.5</clj-http><clj-yaml>0.3.0-SNAPSHOT</clj-yaml><postgresql>8.4-702.jdbc4</postgresql><java class="jdbc">0.0.5</java></>dev-dependencies<><lein-marginalia>0.6.1</lein-marginalia></></h2><br />
</div><div class="dependencies"><h3>dependencies</h3><table></table></div><div class="dependencies"><h3>dev dependencies</h3><table></table></div></td><td class="codes" style="text-align: center; vertical-align: middle;color: #666;padding-right:20px"><br /><br /><br />(this space intentionally left almost blank)</td></tr><tr><td class="docs"><div class="toc"><a name="toc"><h3>namespaces</h3></a><ul><li><a href="#locale.middleware.translate">locale.middleware.translate</a></li><li><a href="#locale.middleware.locale">locale.middleware.locale</a></li><li><a href="#locale.core">locale.core</a></li><li><a href="#locale.handler.redirect">locale.handler.redirect</a></li><li><a href="#track.usage">track.usage</a></li><li><a href="#app.config.core">app.config.core</a></li><li><a href="#app.config">app.config</a></li><li><a href="#app.run-level">app.run-level</a></li><li><a href="#www.url">www.url</a></li><li><a href="#www.middleware.spy">www.middleware.spy</a></li><li><a href="#www.middleware.request-id">www.middleware.request-id</a></li><li><a href="#www.id">www.id</a></li><li><a href="#paypal.express-checkout">paypal.express-checkout</a></li><li><a href="#paypal.nvp">paypal.nvp</a></li><li><a href="#paypal.jobs">paypal.jobs</a></li><li><a href="#"></a></li><li><a href="#sistemi.site.modern-shelving-html">sistemi.site.modern-shelving-html</a></li><li><a href="#sistemi.site.profile.locale">sistemi.site.profile.locale</a></li><li><a href="#sistemi.site.profile.select-language-html">sistemi.site.profile.select-language-html</a></li><li><a href="#sistemi.site">sistemi.site</a></li><li><a href="#sistemi.middleware">sistemi.middleware</a></li><li><a href="#sistemi.handlers">sistemi.handlers</a></li><li><a href="#sistemi.routes">sistemi.routes</a></li><li><a href="#log.readably">log.readably</a></li><li><a href="#util.reflection">util.reflection</a></li><li><a href="#util.core">util.core</a></li><li><a href="#util.example">util.example</a></li><li><a href="#util.environment">util.environment</a></li><li><a href="#util.except">util.except</a></li><li><a href="#util.fs">util.fs</a></li><li><a href="#util.string">util.string</a></li><li><a href="#util.base62">util.base62</a></li></ul></div></td><td class="codes">&nbsp;</td></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#locale.middleware.translate" name="locale.middleware.translate"><h1 class="project-name">locale.middleware.translate</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns locale.middleware.translate
  (:require [clojure.java.io :as io]
            [clj-yaml.core :as yaml]
            [clojure.tools.logging :as log]
            [clojure.set :as set]
            [clojure.string :as str]
            [clojure.contrib.string :as strc]
            [clojure.contrib.str-utils2 :as stru])
  (:use [locale.core :only (locales default-locale)]
        [util (except :only (check))
              fs
              (core :only (contains-in?))]
        [www.url :only (url)]
        [sistemi.handlers :only (make-404)])
  (:import java.io.File))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- load-yaml-safely
  &quot;Loads a map from a yaml file and returns it.  The top level keys are coerced to strings.  If the
   file can't be loaded, logs an error and returns nil.&quot;
  [file]
  (try (let [m (-&gt; (yaml/parse-string (slurp file))
                   (check map?))]
         ;; Convert top level keywords to strings.
         (reduce (fn [m [k v]]
                   (-&gt; (dissoc m k)
                       (assoc (name k) v)))
                 m m))
       (catch Exception x 
         (log/error (str &quot;Failed to load file '&quot; file &quot;' (&quot; x &quot;).&quot;)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- default-translation-map
  &quot;Returns a default translation map where each non default locale is mapped to the canonical name.&quot;
  [cname]
  (dissoc
   (apply hash-map (mapcat #(list %1 cname) locales))
   default-locale))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- check-canonical
  &quot;Makes sure the default-locale uses the canonical name.&quot;
  [m cname file]
  (when (contains? m default-locale)
    (log/warn (str &quot;Ignoring extraneous entry for default locale '&quot;
                   default-locale &quot;' in file '&quot; file &quot;'.&quot;)))
  (assoc m default-locale cname))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- check-extensions
  &quot;Updates a path translation map to add file extensions if ommitted.&quot;
  [m]
  (if-let [ext (re-find #&quot;\.[^.]+$&quot; (m default-locale))]
    (reduce (fn [m [locale name]]
              (if (re-find (re-pattern (str ext &quot;$&quot;)) name)
                m
                (assoc m locale (str name ext))))
            m
            m)
    m))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- check-locales
  &quot;Adds path entries for missing locales and removes unknown locale entries.&quot;
  [m file]
  (let [cname (m default-locale)]
    (reduce
     (fn [m locale]
       (cond
        (and (contains? m locale) (locales locale)) m
        (locales locale) (do (log/error (str &quot;No entry for locale '&quot; locale &quot;' in file '&quot; file &quot;'.&quot;))
                             (assoc m locale cname))
        :default (do (log/error (str &quot;Ignoring entry for uknown locale '&quot; locale &quot;' in file '&quot; file &quot;'.&quot;))
                     (dissoc m locale))))
     m
     (set/union locales (keys m)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- check-names
  &quot;Checks that all name values are strings and encodes any unsafe characters.&quot;
  [m file]
  (let [cname (m default-locale)]
    (reduce
     (fn [m [locale lname]]
       (let [is-string (string? lname)]
         (or is-string (log/error (str &quot;Invalid entry '&quot; lname &quot;' for locale '&quot; locale &quot;' in file '&quot; file &quot;'.&quot;)))
         (assoc m locale (str (url (if is-string lname cname))))))
     m m)))
#_(load-name-translations &quot;src/sistemi/site&quot;)
(defn load-name-translations
  &quot;Loads all path name translation files under a directory root and returns an array of two maps.
   The first map maps canonical URI paths to localized ones and the second map vice versa.&quot;
  [root]
  (reduce
   (fn [[localized canonical] dir]
     (let [cname (.getName ^File dir)
           cpath (stru/drop (.getPath ^File dir) (count root))
           file (io/file dir &quot;name.yml&quot;)
           name-map (-&gt; (or (and (empty? cpath) (default-translation-map cname))
                            (load-yaml-safely file)
                            (default-translation-map cname))
                        (check-canonical cname file)
                        (check-locales file)
                        (check-names file)
                        (check-extensions))]
       (reduce
        (fn [[lm cm] [locale lname]]
          (let [lpath (let [ppath (parent cpath)]
                        (if (nil? ppath)
                          (ffs locale)
                          (fs (lm (ffs locale ppath)) lname)))
                lm (assoc lm (ffs locale cpath) lpath)
                cm (assoc cm (ffs lpath) (if (empty? cpath) &quot;/&quot; cpath))]
            [lm cm]))
        [localized canonical] name-map)))
   [{} {}] (dir-seq-bf root)))</pre></tr><tr><td class="docs"><p>(load-name-translations "src/sistemi/site")</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>TODO: Move these notes somewhere.
- Keep the canonical path uri safe (i.e., no special chars that need encoding).
- Encode the path translations as they are read from name.yml.</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn load-string-translations
  &quot;Loads all string translations files under a root directory and returns a
   map of canonical URI path to a submap of string translations.&quot;
  [root]
  (reduce
   (fn [m dir]
     (let [cname (.getName ^File dir)
           cpath (stru/drop (.getPath ^File dir) (inc (count root))) ; TODO: unqualify; load strings for root path
           file (io/file dir &quot;strings.yml&quot;)
           name-map (when (.exists file)
                      (-&gt; (load-yaml-safely file)
                          (check-locales file)))]
       (reduce
        (fn [m [locale string-map]]
          (assoc m (ffs locale cpath) string-map))
        m name-map)))
   {} (dir-seq-bf root)))
#_(load-string-translations &quot;src/sistemi/site&quot;)
;; TODO: Add checks and balances.
;; - List which pages/templates are never used (request log analysis).
;; - List which translations are never used ().
;; TODO: List strings which are missing a translation (when page string translations are loaded).
(defn wrap-translate-uri
  &quot;Request wrapper that:
   - Translates :uri from a localized to a canonical version.
   - Adds a function :luri to translate canonical uris to localized versions.&quot;
  [app localized canonical]
  (fn [req]
    (let [locale (req :locale)
          luri (req :uri)
          fluri (ffs locale luri)]
      (if-let [curi (canonical fluri)]
        (app (assoc req
               ;; canonical URI
               :uri curi
               ;; fn to localize urls
               :luri (fn this
                       ([curi] (this locale curi))
                       ([locale curi]
                          (or (localized (ffs locale curi))
                              (log/warn (str &quot;No translation for uri &quot; curi &quot;.&quot;)))))
               ;; map to canonicalize uri
               ;; TODO: This is *only* used when changing locales. Can/should it can be passed another way?
               :curi canonical))
        ;; Return a 404 if no path can be found.
        (make-404 req)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-translate-strings
  &quot;Request wrapper that adds a function :strings to lookup string translations for the page.&quot;
  [app page-strings canonical]
  (fn [req]
    (let [locale (req :locale)
          uri (req :uri)]
      (app (assoc req
             :strings (let [strings (page-strings (ffs locale uri) {})]
                        (fn [&amp; keys]
                          (let [val (get-in strings keys)
                                ;; Map values have their string value stored under the key :_.
                                val (if (map? val) (val :_) val)
                                ;; Strings in the default locale use their key as the value by default.
                                val (or val (and (= locale default-locale)
                                                 (contains-in? strings keys)
                                                 (name (last keys))))]
                            (or val
                                (do
                                  (log/warn (str &quot;No translation for key &quot; keys &quot; (locale=&quot; locale &quot;, page=&quot; uri &quot;).&quot;))
                                  (str &quot;(&quot; (str/join &quot;-&quot; (map name keys)) &quot;)&quot;)))))))))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#locale.middleware.locale" name="locale.middleware.locale"><h1 class="project-name">locale.middleware.locale</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns locale.middleware.locale
  (:require [clojure.string :as str])
  (:use locale.core))</pre></tr><tr><td class="docs"><p>Saves the locale in the request map.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-locale
  [app locale]
  (fn [req]
    (app (assoc req :locale locale))))</pre></tr><tr><td class="docs"><p>Parses the Accept-language header.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- parse-accept-language
  [req]
  (if-let [al (get (:headers req) &quot;accept-language&quot;)]
    (sort-by
     second
     #(compare %2 %1) ; note: use compare w/ swapped args since reverse breaks sort stability
     (map (fn [part]
            (let [[l q] (str/split part #&quot;;&quot;)]
              [(str/split l #&quot;-&quot;)
               (if q
                 ;; parse the quality
                 (Double/parseDouble (second (re-matches #&quot;q=(.+)&quot; q)))
                 ;; quality defaults to 1
                 1)]))
          (str/split al #&quot;,&quot;)))))</pre></tr><tr><td class="docs"><p>Makes a best guess at which locale should be used.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- detect-locale
  [req]
  (or
   ;; Check if we support a language in their accept-language header.
   (some (fn [[[lang]]]
           (if-let [locale (locales lang)] locale))
         (parse-accept-language req))
   ;; Else use the default locale.
   default-locale))</pre></tr><tr><td class="docs"><p>Detects the user's locale and adds it to the request. The locale is determined from the locale
   cookie if present and from the client's Accept-Language header otherwise.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-detect-locale
  [app]
  (fn [req]
    (let [locale (or (locales (get-in req [:cookies &quot;locale&quot; :value]))
                     (detect-locale req))]
      (app (assoc req :locale locale)))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#locale.core" name="locale.core"><h1 class="project-name">locale.core</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Core definitions for the locale library.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns locale.core
  (:use [clojure.contrib.def :only (defvar)]
        [util.except :only (check)]))</pre></tr><tr><td class="docs"><p>The set of all supported locales.</p>

<p>===== VARS =====</p>
</td><td class="codes" /><pre class="brush: clojure">(defvar locales #{})</pre></tr><tr><td class="docs"><p>The default locale.</p>
</td><td class="codes" /><pre class="brush: clojure">(defvar default-locale nil)</pre></tr><tr><td class="docs"><p>Sets the root binding for locales.</p>

<p>===== FUNCTIONS =====</p>
</td><td class="codes" /><pre class="brush: clojure">(defn set-locales!
  [locales_]
  (alter-var-root #'locales
                  (constantly (set locales_))))</pre></tr><tr><td class="docs"><p>Sets the root binding for default-locale.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn set-default-locale!
  [key]
  (alter-var-root
   #'default-locale
   (constantly (check (locales key) &quot;Invalid locale '~A'.&quot;))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#locale.handler.redirect" name="locale.handler.redirect"><h1 class="project-name">locale.handler.redirect</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns locale.handler.redirect
  (:require [www.url :as url])
  (:use [util.fs :only (ffs)]
        [ring.util.response :only [redirect]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn locale-redirect
  &quot;Redirect a request to the root of the localized site.&quot;
  [req]
  (redirect (url/canonicalize req (ffs (req :locale)))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#track.usage" name="track.usage"><h1 class="project-name">track.usage</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Usage tracking</p>
</td><td class="codes" /><pre class="brush: clojure">(ns track.usage)</pre></tr><tr><td class="docs"><p>In memory map stored in an atom that gets updated by an agent.
A scheduled job to sync the atom state to the database periodically.</p>
</td><td class="codes" /><pre class="brush: clojure">(def usage-map (atom {}))</pre></tr><tr><td class="docs"><p>Track the time an item was last used.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn last-used
  [type key]
  (let [keys [type key]
        t (System/currentTimeMillis)]
    (swap! usage-map #(if (&gt; t (get-in %1 keys 0))
                        (assoc-in %1 [type key] t)
                        %1))))</pre></tr><tr><td class="docs"><p>What is the cost of:
- batching updates in one thread, then deeply merging.
- just doing a hash put
- just doing a NOOP swap</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Performance improvements:
- use the time the request came in
- use the nearest second
- store the time value in a global and re-get every second...
- use System.nanoTime
- use a resolution of 1 second in time passed to last-used?
- use 1 map per type to limit STM retries?
- batch updates? update stats once per thread?
- e.g., update counters in a thread local then commit at end of request</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>performance is 4.5 sec/million on my netbook
5.5 sec/million w/ unconditional set
(time (doseq [x (range 1000000)]
(last-used :string :title)))</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>50% of time is in getting the time.
possibly just use the time the request came in (request :time)
(time (doseq [x (range 1000000)]
(System/currentTimeMillis)))</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Not worth using an agent
This should be a near instantaneous operation.
What are the costs of using an agent?
- STM to send and receive messages
- Additional thread context switching</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>How does it get updated in the agent.</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>? how does it get dumped to the database?
http://groups.google.com/group/clojure/browse_thread/thread/6e8a8dd14f184969</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Time Event Last Happened
Last Occurrence
Last Usage
:type :translation-key (:page-render, :snippet-render)
:event :used
:time xyz</p>
</td><td class="codes" /></tr><tr><td class="docs"><ul>
<li>List which translations are never used ().</li>
<li>stats agent?</li>
<li>dump usage message to an event queue</li>
<li>operations are idempotent and order independent</li>
<li>udpate last event time (:type string :key [/en/profile/select-language.html :foo :bar] :time time)</li>
<li>each event should have a unique key</li>
<li>periodically flush to db (set if newer ...)</li>
<li>might need to store created-on date to not garbage collect new entries... (or just a manual touch)
(last-used type key time)
{:type string {key time}}
db: id type key created last_used (pk is (type,key))
uses: handler, page, snippet, translation</li>
</ul>
</td><td class="codes" /></tr><tr><td class="docs"><p>counter?
- does a counter reset over some time window?
- e.g., total for: day month year lifetime
- rolling counter?
- not as useful for querying as just storing all data</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>simple value
last used at
counter
moving average: http://en.wikipedia.org/wiki/Moving<em>average#Exponential</em>moving_average
exponential smoothing: http://en.wikipedia.org/wiki/Exponential_smoothing</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>last usage - garbage collection
counter - ...
- or other value e.g., mean time between usage etc.
all usage - frequency, distribution
activity - user tracking
- on site
- external
- inbound
- outbound
A/B testing</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#app.config.core" name="app.config.core"><h1 class="project-name">app.config.core</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Global configuration map and related helper functions.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns app.config.core
  (:require [clj-yaml.core :as yaml]
            [clojure.string :as str])
  (:use [clojure.contrib.def :only (defvar)]
        [clojure.contrib.map-utils :only (deep-merge-with)]
        app.config.core
        (util environment except)))</pre></tr><tr><td class="docs"><p>===== VARS =====</p>
</td><td class="codes" /><pre class="brush: clojure">(defvar config {}
  &quot;Global configuration map. Initialized to the environment.&quot;)</pre></tr><tr><td class="docs"><p>===== PRIVATE FUNCTIONS =====</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- read-yaml-safely
  &quot;Coerces a yaml string to a clojure data structure. If the coercion fails, the unmodified string
  is returned.&quot;
  [s]
  (safely (yaml/parse-string s) s))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- normalize-key
  &quot;Normalizes a key by replacing underscore to dash and converting to lowercase.&quot;
  [k]
  (-&gt; k (str/replace &quot;_&quot; &quot;-&quot;) str/lower-case keyword))</pre></tr><tr><td class="docs"><p>===== PUBLIC FUNCTIONS =====</p>
</td><td class="codes" /><pre class="brush: clojure">(defn environment-map
  &quot;Returns the environment as a map. Keys are normalized by converting underscore to dash,
   lowercasing, and kewyordizing.  YAML parseable values are coerced from yaml to clojure.  A list
   of keys can be supplied to select the desired map entries.&quot;
  [&amp; keys]
  (reduce (fn [m kv]
            (let [[k v] kv]
              (assoc m (normalize-key k) (read-yaml-safely v))))
          {}
          (if (empty? keys)
            environment
            (select-keys environment keys))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn file-map
  &quot;Returns a configuration file as a map.&quot;
  [path]
  (yaml/parse-string (slurp path)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn merge-configs
  &quot;Deeply merges the list of configuration maps. Values from rightmost maps take precedence.&quot;
  [&amp; maps]
  (apply deep-merge-with (fn [a b] b) maps))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn set-config!
  &quot;Applies function merge-configs to the list of configuration maps and sets the result in config.&quot;
  [&amp; maps]
  (alter-var-root #'config (constantly (apply merge-configs maps))))</pre></tr><tr><td class="docs"><p>Intialize the configuration to the environment.</p>
</td><td class="codes" /><pre class="brush: clojure">(set-config! (environment-map))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#app.config" name="app.config"><h1 class="project-name">app.config</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Queries the global configuration.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns app.config
  (:use [app.config.core]))</pre></tr><tr><td class="docs"><p>Configuration maps are expected to be in yaml format.</p>

<p>Requirements of configuration format.
- can represent nested data structures
- human readable
- can add comments (json doesn't support comments)
- safe (clj is not safe)</p>

<p>Possible Features:
- caching and reloading (see fnmap)
- log overidden and merged settings
- report query statistics to find unused settings (see fnmap)
- advanced queries regex, xpath
- support more formats: json, xml, properties</p>

<p>USAGE:
;; To initialize.
(use 'app.config.core)</p>

<p>(environment-map)
(environment-map "USERNAME" "HOME")
(file-map "etc/development.yaml")</p>

<p>(set-config!
(file-map "etc/default.yaml")
(file-map  (str "etc/" (name (get-run-level)) ".yaml"))
(environment-map "DATABASE_URL" "paypal"))</p>

<p>(merge-configs
(file-map "etc/default.yaml")
(file-map  (str "etc/" (name (get-run-level)) ".yaml"))
(environment-map "DATABASE_URL" "paypal"))</p>

<p>To read config values.
(use 'app.config)
(conf :foo)                 ; return a top level value
(conf :foo :bar :baz)       ; return a nested value</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn conf
  &quot;Gets an entry from the global configuration using the specified keys.&quot;
  [&amp; keys]
  (get-in config keys))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#app.run-level" name="app.run-level"><h1 class="project-name">app.run-level</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns app.run-level
  (:use [clojure.contrib.def :only (defvar)]
        (util environment except)))</pre></tr><tr><td class="docs"><p>===== VARS =====</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defvar run-levels
  &quot;Set of valid run levels.&quot;
  nil)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defvar run-level
  &quot;Runtime level of the process.&quot;  
  nil)</pre></tr><tr><td class="docs"><p>===== FUNCTIONS =====</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Generates predicate functions for testing the run-level.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- make-predicates
  []
  (doseq [level run-levels]
    (let [fn-sym (symbol (str (name level) &quot;?&quot;))
          fn-var (intern 'app.run-level fn-sym (fn [] (= run-level level)))]
      (alter-meta! fn-var assoc :doc (str &quot;Returns true if the run level is &quot; level &quot;.&quot;)))))</pre></tr><tr><td class="docs"><p>Initializes the current run level and the allowed set of run levels.</p>

<p>   Set of Run Levels
   The set of allowed run levels can be passed in a vector of keywords.
   If not specified, it defaults to #{:development :staging :production}.</p>

<p>   Run Level
   The active run level can be passed as a keyword. If not passed,
   it is set from the environment variable RUN_LEVEL or to :development if
   RUN_LEVEL is not defined.</p>

<p>   Predicate Functions
   For each run level, a predicate function is generated which returns
   true if that run level is the current one. E.g., the predicate
   development? will be generated from the run level :development.</p>

<p>   EXAMPLES
   ;; SIMPLE
   ;; Initialize run-levels to #{:development :staging :production} and
   ;; run-level to the value of the RUN_LEVEL environment variable.
   (init-run-level!)</p>

<p>   ;; SET RUN LEVEL
   ;; Initialize run-level to :production and run-levels to #{:development :staging :production}.
   (init-run-level! :production)</p>

<p>   ;; SET CUSTOM RUN LEVELS
   ;; Initialize run-levels to #{:tinkering :sales-demo :testing :production} and
   ;; run-level to the value of the RUN_LEVEL environment variable.
   (init-run-level! #{:tinkering :sales-demo :testing :production})</p>

<p>   ;; Set CUSTOM RUN LEVELS
   ;; Initialize run-levels to #{:tinkering :sales-demo :testing :production} and
   ;; run-level to :sales-demo.
   (init-run-level! :sales-demo #{:tinkering :sales-demo :testing :production})</p>
</td><td class="codes" /><pre class="brush: clojure">(defn init-run-level!
  ([] (init-run-level! nil))
  ([arg] (if (keyword? arg)
           (init-run-level! arg nil)
           (init-run-level! nil arg)))
  ([level levels]
     (let [levels (or levels #{:development :staging :production})
           level (or level (keyword (environment &quot;RUN_LEVEL&quot;)) :development)]
       (alter-var-root #'run-levels (constantly (set (check levels set?))))
       (alter-var-root #'run-level (constantly (check level levels))))
     (make-predicates)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#www.url" name="www.url"><h1 class="project-name">www.url</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>URL related functions.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns www.url
  (:require ring.middleware.params)
  (:require [clojure.string :as str])
  (:use [util.fs :only (fs fs-seq qualify absolute?)])
  (:import (clojure.lang Keyword IPersistentMap)
           (java.net URLDecoder URLEncoder URI)
           (com.google.gdata.util.common.base CharEscapers PercentEscaper)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- parse-params
  [s]
  (reduce (fn [m [key val]] (assoc m (keyword key) val))
          {}
          (#'ring.middleware.params/parse-params s &quot;UTF-8&quot;)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn decode
  &quot;Returns the UTF-8 URL decoded version of the given string.&quot;
  [s]
  (URLDecoder/decode s &quot;UTF-8&quot;))</pre></tr><tr><td class="docs"><p>encode-data? encode-url
Use this for POSTS
rename escape-post?</p>
</td><td class="codes" /><pre class="brush: clojure">#_(defn encode
  &quot;Returns the UTF-8 URL decoded version of the given string.&quot;
  [s]
  (URLEncoder/encode s &quot;UTF-8&quot;))
(def ^PercentEscaper path-escaper
  (CharEscapers/uriPathEscaper))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn encode-path-segment
  [^String s]
  (.escape path-escaper s))
#_(encode-path-segment &quot;estantera&quot;)
(def ^PercentEscaper query-escaper
  (CharEscapers/uriQueryStringEscaper))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn encode-query-segment
  [^String s]
  (.escape query-escaper s))
#_(encode-query-segment &quot;estantera&quot;)
(defn encode-path
  [path]
  (when path
    (let [s (apply fs (map encode-path-segment (fs-seq path)))]
      (if (absolute? path)
        (qualify s)
        s))))
#_(encode-path &quot;estantera&quot;)
(defn encode-query
  [m]
  (str/join
   &quot;&amp;&quot;
   (map (fn [entry] (str/join &quot;=&quot; (map #(-&gt; %1 name encode-query-segment) entry)))
           m)))
#_(encode-query {:a23 &quot;b&quot;})
(defrecord URL [#^Keyword scheme #^String host #^Integer port #^String path #^IPersistentMap query]
  Object
  (toString [this]
    (let [a (when scheme
              [(name scheme) &quot;:&quot; &quot;//&quot; host
               (cond (= :http scheme) (if-not (= (or port 80) 80) [&quot;:&quot; port])
                     (= :https scheme) (if-not (= (or port 443) 443) [&quot;:&quot; port])
                     :default [&quot;:&quot; port])
               ])
          a (flatten (filter identity a))
          ;; Encode the path.
          a (if path
              (concat a (let [s (encode-path path)]
                          (if (empty? a) s (qualify s))))
              a)
          ;; Encode the query string
          a (if query
              (concat a [&quot;?&quot; (encode-query query)])
              a)
          ]
      (apply str a))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">#_(str (url &quot;http://fubar.com&quot;))
#_(str (url &quot;http://fubar.com/a/b/estantera?lang=en&amp;target=/estantera-moderna.htm&quot;))
#_(str (url &quot;foo&quot;))
#_(str (url &quot;/foo&quot;))
#_(:query (url &quot;http://fubar.com/a/b/estantera?lang=en&amp;target=/estanter%C3%ADa-moderna.htm&quot;))
#_(str (url &quot;/a/b/estantera&quot;))
#_ (url &quot;a&quot;)
#_ (:scheme (url &quot;a&quot;))
#_ ((url &quot;a&quot;) :path)
(defmulti url
  &quot;Coerce argument to a URL instance.&quot;
  class)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defmethod url String
  [s]
  (let [uri    (URI. s)
        scheme (.getScheme uri)
        host   (.getHost uri)
        port   (if (not= (.getPort uri) -1) (.getPort uri))
        path   (let [s (.getRawPath uri)] (if (str/blank? s) &quot;/&quot; (decode s)))
        query  (if-let [qs (.getQuery uri)] (parse-params qs))]
    (URL. (keyword scheme) host port path query)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn canonicalize
  &quot;Makes a canonical URL by combining the scheme, server, and port from a request map with the
   desired URI.&quot;
  [req uri]
  (let [{server :server-name port :server-port} req]
    (case (:scheme req)
      :http (str &quot;http://&quot; server (case (int port) 80  (str &quot;:&quot; port)) uri)
      :https (str &quot;https://&quot; server (case (int port) 443  (str &quot;:&quot; port)) uri))))</pre></tr><tr><td class="docs"><p>Note: stolen from ring-mock...</p>
</td><td class="codes" /><pre class="brush: clojure">(defn parse
  &quot;Parses a URL into a minimal ring request map.&quot;
  [uri]
  (let [uri    (URI. uri)
        host   (.getHost uri)
        port   (if (not= (.getPort uri) -1) (.getPort uri))
        scheme (.getScheme uri)
        path   (.getRawPath uri)]
    {:server-port    (or port 80)
     :server-name    host
     :uri            (if (str/blank? path) &quot;/&quot; path)
     :scheme         (keyword scheme)
     }))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn self-referred?
  &quot;Returns true if the request and it's referer header reference the same server.&quot;
  [req]
  (apply = (map #(select-keys %1 [:scheme :server-name :server-port])
                [req
                 (parse (get-in req [:headers &quot;referer&quot;]))])))</pre></tr><tr><td class="docs"><p>TODO: Add this as a test.
(self-referred?
{:scheme :http :server-name "localhost" :server-port 5000
:headers {"referer" "http://localhost:5000/foo"}})</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#www.middleware.spy" name="www.middleware.spy"><h1 class="project-name">www.middleware.spy</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns www.middleware.spy
  (:use [clojure.tools.logging :only (info)]
        [clojure.contrib.def :only (defnk)]
        [clojure.string :only (join upper-case)]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defnk spy
  &quot;Spies on a request logging it.&quot;
  [app :prefix &quot;spy&quot; :req-keys [] :resp-keys nil]
  (fn [req]
    (if req-keys
      (info (str prefix &quot;.request: &quot; (if (empty? req-keys) req (select-keys req req-keys)))))
    (let [response (app req)]
      (if resp-keys
        (info (str prefix &quot;.response: &quot; (if (empty? resp-keys) response (select-keys response resp-keys)))))
      response)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-request-log
  &quot;Logs a short one line summary of info for each request.&quot;
  [app]
  (fn [req]
    (let [started (System/currentTimeMillis)
          response (app req)
          elapsed (- (System/currentTimeMillis) started)]
      (info (join &quot; &quot;
                  [(upper-case (name (req :request-method)))
                   (str (req :uri)
                        (if-let [qs (req :query-string)]
                          (str &quot;?&quot; qs)))
                   (response :status)
                   (str &quot;(&quot; elapsed &quot;)&quot;)]))
      response)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#www.middleware.request-id" name="www.middleware.request-id"><h1 class="project-name">www.middleware.request-id</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Generates a unique request id.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns www.middleware.request-id
  (:use ring.middleware.file
        [clojure.tools.logging :only (debug)]
        [clj-logging-config.log4j :only (with-logging-context)])
  (:require [www.id :as id]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-request-id
  &quot;Generates a unique request id and saves it in the logging context.&quot;
  [app]
  (fn [req]
    (with-logging-context {:id (id/next!)}
      (debug &quot;Created new request id.&quot;)
      (app req))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#www.id" name="www.id"><h1 class="project-name">www.id</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns www.id
  (:require [clojure.tools.logging :as log]
            [util.base62 :as b62]))</pre></tr><tr><td class="docs"><p>Generate a human readable reasonable unique request identifer for use in log messages.</p>

<p>REQUIREMENTS
- identifies a web request all requests and jvm instances within the last 30 days
- identifies the jvm instance where the request arrived
- human readable
- short
- collisions can happen but should be rare
- manage collisions by checking:
a) the timestamp on the log message
b) the foreman id (e.g., web(1))</p>

<p>IMPLEMENTATION
- Generate a boot identifier (4 chars base62 random string) at jvm startup to identify the jvm
instance.
- Increment a per jvm request counter to identify each request within a jvm instance.
- Generate a request id of the form bbbb.rrr where bbbb is the boot
identifier and rrr is the request sequence in base62.</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Generate a unique boot identifier when jvm starts.</p>
</td><td class="codes" /><pre class="brush: clojure">(def boot-id (b62/rand 4))</pre></tr><tr><td class="docs"><p>Count requests from zero.</p>
</td><td class="codes" /><pre class="brush: clojure">(def request-count (atom 0))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn next!
  &quot;Generates and returns a semi-unique request id.&quot;
  []
  (str boot-id &quot;.&quot; (b62/encode (swap! request-count inc))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#paypal.express-checkout" name="paypal.express-checkout"><h1 class="project-name">paypal.express-checkout</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Functions for working with Paypal Express Checkout.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns paypal.express-checkout
  (:require [clojure.tools.logging :as log]
            [paypal.nvp :as nvp]))</pre></tr><tr><td class="docs"><p>TODO: Why isn't PAYMENTREQUEST<em>0</em>PAYMENTACTION required?
TODO: Add unit tests.</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>? Where can the latest version number be found?
- https://www.x.com/people/PP<em>MTS</em>Chad/blog/2010/06/22/checking-for-the-most-recent-version
- https://www.x.com/thread/36729
- the live and test sites may be on different versions
- view the source and search for "web version:" on:
- https://www.paypal.com          live
- https://www.sandbox.paypal.com  test
? Where are the release notes?
https://www.x.com/community/ppx/release_notes/blog</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn set-express-checkout
  [params]
  (nvp/client &quot;SetExpressCheckout&quot; params))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def sale-data {:PAYMENTREQUEST_0_AMT &quot;19.95&quot;
                :RETURNURL &quot;https://www.sistemimoderni.com/en/confirm.htm&quot;
                :CANCELURL &quot;https://www.sistemimoderni.com/en/cancel.htm&quot;})</pre></tr><tr><td class="docs"><form method=post action=https://api-3t.sandbox.paypal.com/nvp>
<input type=hidden name=USER value=API_username>
<input type=hidden name=PWD value=API_password>
<input type=hidden name=SIGNATURE value=API_signature>
<input type=hidden name=VERSION value=XX.0>
<input type=hidden name=PAYMENTREQUEST_0_PAYMENTACTION
value=Sale>
<input name=PAYMENTREQUEST_0_AMT value=19.95>
<input type=hidden name=RETURNURL
value=https://www.YourReturnURL.com>
<input type=hidden name=CANCELURL
value=https://www.YourCancelURL.com>
<input type=submit name=METHOD value=SetExpressCheckout>
</form>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#paypal.nvp" name="paypal.nvp"><h1 class="project-name">paypal.nvp</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Functions for working with the Paypal NVP API.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns paypal.nvp
  (:require [clj-http.client :as client]
            [clojure.string :as str]
            [clojure.tools.logging :as log]
            [log.readably :as logr]
            [www.url :as url]))</pre></tr><tr><td class="docs"><p>TODO: Write a cron job to check the test and web versions and alert if we are outdated.
live web version: 84.0-2276209
test web version: 84.0-2276209</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>TODO: See if the circuit breaker pattern is useful: http://blog.higher-order.net/2010/05/05/circuitbreaker-clojure-1-2/
TODO: ?Is the http.agent-api is more appropriate (http://richhickey.github.com/clojure-contrib/http.agent-api.html)?
- limit concurrency to paypal
- allow request to return immediately to client (or after a timeout)
TODO: add tests
TODO: provide and endpoint for client to poll for status
TODO: Factor out the configurable items.</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn call
  &quot;Calls a paypal NVP (name-value-pair) method and returns the result.&quot;
  [method params]
  (let [fparams (merge params {:USER &quot;seller_1301328605_biz_api1.sistemimoderni.com&quot;
                               :PWD &quot;1301328617&quot;
                               :SIGNATURE &quot;A67JHhtiGB0VpBJwFhFIoh1sRh1jAcab39wpr0cwYobasj4xRoJtiV.S&quot;
                               :VERSION &quot;78.0&quot;
                               :METHOD method})
        rparams (hash-map :form-params fparams)]
    (logr/info &quot;request&quot; (if (contains? fparams :PWD) (assoc fparams :PWD &quot;-redacted-&quot;) fparams))
    (let [resp (client/post &quot;https://api-3t.sandbox.paypal.com/nvp&quot; rparams)]
      (logr/info &quot;response&quot; resp)
      resp)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn parse
  &quot;Parses a paypal NVP response and returns the result as a map.&quot;
  [resp]
  (let [v (str/split (:body resp) #&quot;&amp;&quot;)
        v1 (map (fn [kvpair] (str/split kvpair #&quot;=&quot;)) v)
        v2 (apply hash-map (map url/decode (flatten v1)))
        ]
    v2))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn check
  &quot;Checks an NVP response map for errors. If an error is found, logs the error and throws an exception.&quot;
  [nvp]
  (when (not (= &quot;Success&quot; (get nvp &quot;ACK&quot;)))
    (let [message (str/join &quot;|&quot; (map (fn [e] (get nvp (str &quot;L_&quot; (name e) &quot;0&quot;))) [:SEVERITYCODE :ERRORCODE :SHORTMESSAGE :LONGMESSAGE]))]
      (prn message)                     ; TODO: disable printing
      (log/error message)
;      (throw (RuntimeException. message)) ; TODO: enable exceptions)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn client
  [method params]
  (-&gt; (call method params)
      parse
      check))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#paypal.jobs" name="paypal.jobs"><h1 class="project-name">paypal.jobs</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Paypal related cron jobs.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns paypal.jobs
  (:require [clj-http.client :as client]
            [clojure.string :as str]
            [clojure.tools.logging :as log]
            [log.readably :as logr]
            [www.url :as url]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn scrape-version
  &quot;Scrapes the paypal api version from a url.
References:
- https://www.x.com/people/PP_MTS_Chad/blog/2010/06/22/checking-for-the-most-recent-version
- https://www.x.com/thread/36729
&quot;
  [url]
  (let [resp (client/get url)]
    (last (re-find #&quot;web version: (\S+)&quot; (:body resp)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn check-versions
  &quot;Checks which paypal api versions are live.&quot;
  (scrape-version &quot;https://www.sandbox.paypal.com&quot;)
  (scrape-version &quot;https://www.paypal.com&quot;))</pre></tr><tr><td class="docs"><p>TODO: Get autodoc working.
TODO: Add tests for this.</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#" name=""><h1 class="project-name"></h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Enable reflection warnings.
TODO: Consider disabling this for production.</p>
</td><td class="codes" /><pre class="brush: clojure">(clojure.core/require 'util.reflection)
(util.reflection/warn-on-reflection
  &quot;clojure.contrib&quot; &quot;slingshot&quot; &quot;ring&quot; &quot;clj-logging-config&quot; &quot;clj-yaml&quot; &quot;clj-stacktrace&quot;)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.core
  (:require [clojure.tools.logging :as log])
  (:use [ring.adapter.jetty :only (run-jetty)]
        clj-logging-config.log4j
        clojure.java.browse
        clojure.contrib.strint
        (app config run-level)
        app.config.core
        locale.core
        sistemi.routes))</pre></tr><tr><td class="docs"><p>===== LOGGING =====
See: https://github.com/malcolmsparks/clj-logging-config
%p   priority
%X   MDC
%c   logger name (class)
%m   message
%t   thread</p>
</td><td class="codes" /><pre class="brush: clojure">(set-loggers!
 :root     {:level :info :pattern &quot;%p|%X{id}|%c|%m%n&quot;}
 &quot;sistemi&quot; {:level :debug}
;; &quot;www&quot; {:level :debug}
 )</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(require 'www.middleware.request-id)
(log/info (&lt;&lt; &quot;Generated boot-id '~{www.id/boot-id}'.&quot;))</pre></tr><tr><td class="docs"><p>===== RUN LEVEL =====</p>
</td><td class="codes" /><pre class="brush: clojure">(init-run-level!)
(log/info (&lt;&lt; &quot;Entering run level '~{run-level}'.&quot;))
(log/info (&lt;&lt; &quot;Clojure version: '~(clojure-version)'&quot;))</pre></tr><tr><td class="docs"><p>(log/info (str "Classpath: " (seq (.getURLs (java.lang.ClassLoader/getSystemClassLoader)))))
java.version
user.dir
java.vm.version
java.vm.name
java.runtime.version
java.vendor</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>===== CONFIGURATION =====</p>
</td><td class="codes" /><pre class="brush: clojure">(set-config!
   (file-map &quot;etc/default.yaml&quot;)
   (file-map  (str &quot;etc/&quot; (name run-level) &quot;.yaml&quot;))
   (environment-map &quot;PORT&quot; &quot;DATABASE_URL&quot; &quot;PAYPAL&quot;))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(log/info (&lt;&lt; &quot;Using configuration ~{config}.&quot;))</pre></tr><tr><td class="docs"><p>===== LOCALIZATION =====</p>
</td><td class="codes" /><pre class="brush: clojure">(let [m (conf :internationalization)]
  (set-locales! (m :locales))
  (set-default-locale! (m :default-locale)))</pre></tr><tr><td class="docs"><p>===== ROUTES =====
Build routes after localization settigns are initialized.</p>
</td><td class="codes" /><pre class="brush: clojure">(def routes (build-routes))</pre></tr><tr><td class="docs"><p>===== SWANK =====
Starts a swank server. Useful when running locally from foreman.
Note: Uses eval since swank-clojure may not be available in production (e.g., heroku).</p>
</td><td class="codes" /><pre class="brush: clojure">(defn start-swank []
  (log/info &quot;Starting swank.&quot;)
  (eval '(do (require 'swank.swank)
             (swank.swank/start-server :host &quot;localhost&quot; :port 4005)))
  ;; Inject doc and javadocc into clojure core so they are there for the repl.
  ;; ? Why does this only work inside an require eval?
  ;;   ? Do symbols get evaluated at macro expansion time?
  ;; When compiling, the namespace is set by the ns in the file.
  ;; Later, it is set to &quot;user&quot;.
  ;; See Gilardi Scenario: http://technomancy.us/143
  #_ (require 'clojure.java.javadoc) ; unable to resolve symbol ort. WTF?
  #_ (eval (intern 'clojure.core 'javadoc clojure.java.javadoc/javadoc))  ; fails
  #_(eval '(do
           #_(require 'clojure.repl)
           #_(let [orig-ns *ns*]
             (in-ns 'clojure.core)
             (def #^{:macro true} doc #'clojure.repl/doc)
             (in-ns orig-ns))
           ;; Note: This works, but only injects it into namespaces started after this...
           ;; Note: Why is the eval needed?
           (require 'clojure.java.javadoc)
           (intern 'clojure.core 'javadoc clojure.java.javadoc/javadoc))))</pre></tr><tr><td class="docs"><p>===== MAIN =====</p>
</td><td class="codes" /><pre class="brush: clojure">(defn -main
  &quot;Starts jetty.
   Also launches swank and a browser if configured.&quot;
  []
  (if (conf :swank)
    (start-swank))
  (let [port (conf :port)]
    (when (conf :launch-browser)
      (browse-url  (&lt;&lt; &quot;file://~(System/getProperty \&quot;user.dir\&quot;)/autodoc/index.html&quot;))
      (browse-url  (&lt;&lt; &quot;http://localhost:~{port}&quot;)))
    (run-jetty #'routes {:port port})))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.site.modern-shelving-html" name="sistemi.site.modern-shelving-html"><h1 class="project-name">sistemi.site.modern-shelving-html</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.site.modern-shelving-html
  (:require [clojure.tools.logging :as log])
  (:use net.cgrand.enlive-html
        [ring.util.response :only (response content-type)]
        [clojure.string :only (lower-case)]
        locale.core)
  (:import java.io.File))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftemplate html
  (File. &quot;www/raw/modern-shelving.htm&quot;)
  [req strings]
  ;; Set the lang attribute for the document.
  [:html] (set-attr :lang (req :locale))
  ;; Set the page title.
  [:title] (content (strings :title))
  ;; Set the Content-Type to utf-8
  [:head (attr= :http-equiv &quot;Content-Type&quot;)] (set-attr :content &quot;text/html; charset=utf-8&quot;)
  ;; Configure the language selection menu.
  [:div#lang :a] (fn [node]
                   (let [lang (-&gt; node :content first lower-case)
                         enabled (locales lang)]
                     (if enabled
                       ((set-attr :href (str ((req :luri) &quot;/profile/locale&quot;) &quot;?lang=&quot; lang)) node)
                       node)))
  ;; TOP CENTER
  ;; version
  [:div#wrapper :div.col2b] (content (strings :version))
  ;; cart area
  [:div#cart :&gt; (nth-child 1)] (content (strings :my-account))
  [:div#cart :&gt; (nth-child 3)] (content (strings :cart))
  [:div#wrapper :div.col2 :ul] #(at %
                                    [(nth-child 1) :a] (content (strings :sales))
                                    [(nth-child 2) :a] (content (strings :signup))
                                    [(nth-child 3) :a] (content (strings :contact)))
  ;; MENU
  ;; TODO: Skip translation transformations for the default locale.
  ;; TODO: ? Use the content to lookup the translation?
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 1) :a] (content (strings :menu :home-page))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 2) :a] (content (strings :menu :vision))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 3) :&gt; :a] (content (strings :menu :boutique))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 3) :ul (nth-child 1) :a] (content (strings :menu :boutique :shelving))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 3) :ul (nth-child 2) :a] (content (strings :menu :boutique :tables))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 3) :ul (nth-child 3) :a] (content (strings :menu :boutique :lamps))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 3) :ul (nth-child 4) :a] (content (strings :menu :boutique :chairs))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 3) :ul (nth-child 5) :a] (content (strings :menu :boutique :paint))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 4) :&gt; :a] (content (strings :menu :service))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 5) :&gt; :a] (content (strings :menu :system))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 6) :&gt; :a] (content (strings :menu :gallery))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 7) :&gt; :a] (content (strings :menu :blog))
  [:div#p7PMM_1 :&gt; :ul :&gt; (nth-child 8) :&gt; :a] (content (strings :menu :feedback))
   ;; &lt;div id=&quot;content&quot;&gt;&lt;div class=&quot;col1&quot; style=&quot;position: relative; z-index: 10;&quot;&gt;
   ;;   &lt;div id=&quot;p7PMM_1&quot; class=&quot;p7PMMv01&quot;&gt;
   ;;     &lt;ul class=&quot;p7PMM&quot;&gt;
   ;;       &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Home Page&lt;/a&gt;&lt;/li&gt;
   ;;       &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Our Vision&lt;/a&gt;&lt;/li&gt;
   ;;       &lt;li&gt;&lt;a href=&quot;#&quot;&gt;On-Line Boutique&lt;/a&gt;
   ;;           &lt;div&gt;
   ;;             &lt;ul&gt;
   ;;               &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Shelving&lt;/a&gt;&lt;/li&gt;
   ;;               &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Tables&lt;/a&gt;&lt;/li&gt;
   ;;               &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Lamps&lt;/a&gt;&lt;/li&gt;
   ;;               &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Chairs&lt;/a&gt;&lt;/li&gt;
   ;;               &lt;li&gt;&lt;a href=&quot;#&quot;&gt;Paint&lt;/a&gt;&lt;/li&gt;
   ;;             &lt;/ul&gt;
   ;;           &lt;/div&gt;
   ;;       &lt;/li&gt;)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn handle
  [req]
  (-&gt; (html req (req :strings))
      (response)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.site.profile.locale" name="sistemi.site.profile.locale"><h1 class="project-name">sistemi.site.profile.locale</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.site.profile.locale
  (:require [www.url :as url]
            [clj-time.core :as time])
  (:use ring.util.response
        ring.persistent-cookies
        [sistemi.handlers :only (throw-403)]
        [locale.core :only (locales)]
        [util.except :only (safely)]
        [util.fs :only (ffs fs-seq)]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn handle
  &quot;Handles a request to change the user's locale. The new locale setting is persisted in a cookie
   and the user is redirected to the selected locale's version of the referring page.&quot;
  [req]
  (let [lang (get-in req [:params :lang])
        locale (locales lang)
        target (get-in req [:params :target])
        referer (get-in req [:headers &quot;referer&quot;])]
    ;; Validate form parameters.
    (when-not locale (throw-403 req (str &quot;Invalid parameter lang=&quot; lang &quot;.&quot;)))
    ;; Validate client supplied inputs and compute the redirect target.
    (let [uri (cond
               ;; TODO: Block if the target is from a different website?
               ;; TODO: Encode target. (url/url target)
               target (if-let [url (safely (url/url target) nil)]
                        (if (some #(get url %) [:scheme :host :port])
                          (throw-403 req (str &quot;Invalid parameter target=&quot; target &quot; (not a locale url).&quot;))
                          (str url))
                        (throw-403 req (str &quot;Invalid parameter target=&quot; target &quot;.&quot;)))
               referer (if (not (url/self-referred? req)) ; Only allow requests from the same server.
                         (throw-403 req (str &quot;Third party referals not supported (referer=&quot; referer &quot;).&quot;))
                         ((req :luri) locale ((req :curi) (:uri (url/parse referer)))))
               :default (ffs locale))
          response (redirect (url/canonicalize req uri))
          ]
      (-&gt; response
          (assoc :cookies [(persistent-cookie :locale locale (time/date-time 2020 01 01) {:path &quot;/&quot;})])
          (content-type &quot;text/html; charset=utf-8&quot;)))))</pre></tr><tr><td class="docs"><p>TODO: (time/in 10 :years)
TODO: function to set a cookie for 1 month, quarter, year, decade out
TODO: add tests</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.site.profile.select-language-html" name="sistemi.site.profile.select-language-html"><h1 class="project-name">sistemi.site.profile.select-language-html</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.site.profile.select-language-html
  (:use net.cgrand.enlive-html
        [ring.util.response :only (response)])
  (:import java.io.File))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftemplate html
  (File. &quot;www/raw/profile/select-language.html&quot;)
  [req strings]
  [:title] (content (strings :title))
  [:span#prompt] (content (strings :prompt)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn handle
  [req]
  (-&gt; (html req (req :strings))
      (response)))</pre></tr><tr><td class="docs"><p>(prn "file" <em>file</em>)
TRY TO GET TO THIS
(my-deftemplate
[:title] (content (strings :title))
[:span#prompt] (content (strings :prompt)))</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.site" name="sistemi.site"><h1 class="project-name">sistemi.site</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.site
  (:use net.cgrand.enlive-html
        [ring.util.response :only (response content-type)]
        locale.core)
  (:import java.io.File))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def language-names
  {&quot;en&quot; &quot;english&quot;
   &quot;fr&quot; &quot;franaise&quot;
   &quot;de&quot; &quot;deutsch&quot;
   &quot;it&quot; &quot;italiano&quot;
   &quot;es&quot; &quot;espaol&quot;
   })</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(deftemplate html
  (File. &quot;www/raw/index.htm&quot;)
  [req strings]
  ;; Set the lang attribute for the document.
  [:html] (set-attr :lang (req :locale))
  ;; Set the page title.
  [:title] (content (strings :title))
  ;; Set the refresh target.
  [:head (attr= :http-equiv &quot;refresh&quot;)] (set-attr :content (str &quot;160;URL=&quot; ((req :luri) &quot;/modern-shelving.htm&quot;)))
  ;; Set the Content-Type to utf-8
  [:head (attr= :http-equiv &quot;Content-Type&quot;)] (set-attr :content &quot;text/html; charset=utf-8&quot;)
  ;; Translate image slideshow links.
  [:div#slider :a] (set-attr :href ((req :luri) &quot;/modern-shelving.htm&quot;))
  ;; Configure the language selection menu.
  [:ul#nav1 :&gt; :li :&gt; :a] (content (strings :select-a-language))
  [:ul#nav1 :li :ul ] (content (map (fn [lang]
                                      (let [enabled (locales lang)
                                            li {:tag :li :attrs {:lang lang}}
                                            li (if enabled li (assoc-in li [:attrs :class] &quot;notyet&quot;))
                                            href (if enabled
                                                   (str ((req :luri) &quot;/profile/locale&quot;)
                                                        &quot;?lang=&quot; lang
                                                        &quot;&amp;target=&quot; ((req :luri) lang &quot;/modern-shelving.htm&quot;))
                                                   &quot;#&quot;)
                                            a {:tag :a :attrs {:href href} :content (language-names lang)}]
                                        (assoc li :content [a])))
                                [&quot;en&quot; &quot;fr&quot; &quot;de&quot; &quot;it&quot; &quot;es&quot;])))</pre></tr><tr><td class="docs"><p>TODO: Run transformations in lockstep where possible.
TODO: Review the whole document for other possible translations.
TODO: Translate the alt text.
TODO: Make a macro to remove the boilerplate.
TODO: Translate meta keywords and meta description.
TODO: Write some tests.
TODO: /images/loading.gif doesn't exist
TODO: Add content-length header.</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn handle
  [req]
  (-&gt; (html req (req :strings))
      (response)
      ;; Set the content type explicitly since this is served from / and has no .htm extension.
      (content-type &quot;text/html; charset=utf-8&quot;)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.middleware" name="sistemi.middleware"><h1 class="project-name">sistemi.middleware</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.middleware
  (:require [clojure.java.io :as io]
            [clojure.contrib.str-utils2 :as stru]
            [clojure.tools.logging :as log])
  (:use [slingshot.core :only [try+]]
        [util fs])
  (:import java.io.File))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-exception-response
  &quot;Ring wrapper that catches response maps thrown as exceptions from further down the handler stack.&quot;
  [app]
  (fn [req]
    (try+
      (app req)
      (catch map? m m))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-doall
  &quot;Ring wrapper that calls doall on the response content. This forces enlive templates to be
   rendered so that exceptions can be handled in a user friendly manner.&quot;
  [app]
  (fn [req]
    (let [response (app req)
          body (:body response)]
      (if (seq? body)
        (assoc response :body (doall body))
        response))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- load-handlers
  &quot;Loads all page handlers under a directory and returns a
   map of handler functions keyed by canonical uri.&quot;
  [root]
  (reduce
   (fn [m dir]
     (let [cname (.getName ^File dir)
           cpath (stru/drop (.getPath ^File dir) (inc (count root))) ; unqualify
           file (io/file dir &quot;code.clj&quot;)]
       (if (.exists file)
         ;; Note: The handler def should be the last sexp in the file.
         (try
           (assoc m (ffs cpath) (load-file (.getPath file)))
           (catch Exception x
             (log/error x (str &quot;Exception loading file &quot; file))
             m))
         m)))
   {} (dir-seq-bf root)))</pre></tr><tr><td class="docs"><p>(load-handlers "src/sistemi/site")</p>
</td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn wrap-handler
  &quot;Calls a handler if one is defined for the current URI. Otherwise passes the request to the next
   middleware.&quot;
  [app root &amp; opts]
  (let [handler-map (load-handlers root)]
    (fn [req]
      (if-let [handler (handler-map (req :uri))]
        (handler req)
        (app req)))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.handlers" name="sistemi.handlers"><h1 class="project-name">sistemi.handlers</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.handlers
  (:require [clojure.string :as str])
  (:use ring.util.response
        [slingshot.core :only [throw+]]))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn make-403
  &quot;Returns a custom 403 (forbidden) response.&quot;
  [req message]
  (-&gt;
   (response (if (= :head (:request-method req))
               nil
               (str &quot;Sorry, the request was refused for the following reason: &quot; message)))
   (status 403)))</pre></tr><tr><td class="docs"><p>TODO: Make this a template.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn make-404
  &quot;Returns a custom 404 (not found) response.&quot;
  [req]
  (-&gt;
   (response (str &quot;Sorry, the page \ (:uri req &quot;??&quot;) &quot;\&quot; could not be found.&quot;))
   (status 404)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn make-405
  &quot;Returns a custom 405 (method not allowed) response.&quot;
  [req method]
  (-&gt; (response (str &quot;Sorry, the request method \ (name (:request-method req)) &quot;\&quot; is not allowed for resource \
                     (:uri req &quot;??&quot;) &quot;\&quot;.&quot;))
      (status 405)
      (header &quot;Allow&quot; (str/upper-case (name method)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn throw-403
  &quot;Throws a 403 response.&quot;
  [req message]
  (throw+ (make-403 req message)))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn assert-method
  &quot;Asserts that the request uses the given method. Otherwise, throws a 405 response.&quot;
  [req method]
  (when (not= (:request-method req) method)
    (throw+ (make-405 req method))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#sistemi.routes" name="sistemi.routes"><h1 class="project-name">sistemi.routes</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns sistemi.routes
  (:use net.cgrand.moustache
        (ring.middleware file file-info params keyword-params content-type)
        (ring.middleware stacktrace lint cookies) ; dev items
        (www.middleware request-id spy)
        [locale.core :only (default-locale locales)]
        (locale.middleware locale translate)
        locale.handler.redirect
        (sistemi [handlers :only (make-404)]
                 [middleware :only (wrap-exception-response wrap-handler wrap-doall)])))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn build-routes
  []
  (let [code-root &quot;src/sistemi/site&quot;
        [localized-paths canonical-paths] (load-name-translations code-root)
        strings (load-string-translations code-root)]
    (app
     ;; TODO: Add a 500 wrapper (like wrap-stacktrace bug logs)
     ;; TODO: Log POST params?
     ;; TODO: Log request maps for easy replay?
     wrap-lint
     wrap-request-id          ; add a unique request id for logging
     wrap-request-log
     wrap-stacktrace
     wrap-exception-response  ; handle responses thrown as exceptions (e.g., 4xx errors)
     ;; (wrap-reload '[adder.middleware adder.core])
     ;; TODO: gzip
     ;; TODO: cache control (http://groups.google.com/group/ring-clojure/browse_thread/thread/cc8f72a15ae7fbc3)
     wrap-doall               ; force realization of body seq
     wrap-params              ; parse form and query string params
     wrap-keyword-params      ; keywordize the params map
     wrap-cookies             ; convert cookies to/from a map
     wrap-file-info
     ;; TODO: make an easier way to set the charset
     ;; TODO: The options should be coerced to a hash automatically.
     ;; TODO: Do this in the handler? e.g., /for root documents?
     (wrap-content-type {:mime-types {&quot;html&quot; &quot;text/html; charset=utf-8&quot;
                                      &quot;htm&quot; &quot;text/html; charset=utf-8&quot;}})
     ;; Handle localized URLs.
     ;; Locale is the first path segment.
     [[locale locales] &amp;]
     (app
      (wrap-locale locale)
      (wrap-file (str &quot;www/&quot; locale))                       ; Serve locale specific files first.
      (wrap-file (str &quot;www/&quot; default-locale))               ; Fallback to the default locale.
      (wrap-file &quot;www&quot;)                                     ; Fallback to the web root.
      (wrap-translate-uri localized-paths canonical-paths)  ; Translate the uri.
      (wrap-translate-strings strings canonical-paths)      ; Add the string translation map.
      (wrap-handler code-root :template-root &quot;www/raw&quot;)     ; Call a handler if one is defined for the uri.
      [&amp;] make-404)
     ;; Handle requests for viewing raw templates.
     [&quot;raw&quot; &amp;] (app
                (wrap-file &quot;www/raw&quot;)
                (wrap-file &quot;www&quot;)
                [&amp;] pass)
     ;; Handle naked URIs.
     [&amp;] (app ; Use a nested app to add middleware.
          (wrap-file &quot;www&quot;)  ; Serve files out of the web root.
          [] (app wrap-detect-locale
                    [&amp;] locale-redirect)
          [&amp;] make-404))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#log.readably" name="log.readably"><h1 class="project-name">log.readably</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Log functions that print arguments in a readable format.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns log.readably
  (:require [clojure.tools.logging :as log]))</pre></tr><tr><td class="docs"><p>TODO: make into a macro
TODO: make a macro logr for it to call
TODO: make a patch for tools.logging?</p>
</td><td class="codes" /><pre class="brush: clojure">(defn info
  [&amp; args]
  (log/info (pr-str args)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.reflection" name="util.reflection"><h1 class="project-name">util.reflection</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Filters out reflection warning messages from specified namespaces.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns util.reflection
  (:require [clojure.string :as str])
  (:import (java.io ByteArrayOutputStream PrintStream PrintWriter)))</pre></tr><tr><td class="docs"><p>See: http://blogs.oracle.com/nickstephen/entry/java<em>redirecting</em>system<em>out</em>and
TODO: Write tests.
TODO: Log reflection warnings as real warnings.
MAYBE: Make into a macro
MAYBE: Take a list form for siblings in a nested namespace</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Filters standard error by passing all records to filter-fn. Output is dropped if filter-fn returns nil.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- filter-err
  [filter-fn]
  (let [err (System/err) #_original-standard-error
        separator (System/getProperty &quot;line.separator&quot;)
        baos (proxy [ByteArrayOutputStream] []
               (flush []
                 (locking this
                   (proxy-super flush)
                   (let [record (.toString this)]
                     (proxy-super reset)
                     (if-let [record (cond
                                      (empty? record) record
                                      (= separator record) record
                                      :default (filter-fn record))]
                       (.print err record)
                       (.flush err))))))]
    #_(System/setErr (PrintStream. baos true))
    (alter-var-root (var *err*) (constantly (PrintWriter. (PrintStream. baos true) true)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn- path-to-ns
  [path]
  (str/escape path {\/ \. \_ \-}))</pre></tr><tr><td class="docs"><p>Sets <em>warn-on-reflection</em> to true and replaces System.err with a PrintStream that
   filters reflection warnings for the specified namesapces.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn warn-on-reflection
  [&amp; namespaces]
  (.println System/err (str &quot;Filtering *err* to suppress reflection warnings for: &quot; namespaces &quot;.&quot;))
  (set! *warn-on-reflection* true)
  (filter-err
   (fn [record]
     (if-let [match (re-find #&quot;^Reflection warning, (.+)\.clj:&quot; record)]
       (let [ns-name (path-to-ns (match 1))]
         (cond
          (contains? namespaces ns-name) nil
          (some #(.startsWith ns-name %1) namespaces) nil
          ;; Log a warning. Prefix a string to prevent capture in recursion.  Will this deadlock?
          ;;:default (log/warn (str &quot;** &quot; record))
          :default record))
       record))))</pre></tr><tr><td class="docs"><p>How to pass log messages through without double processing them?
- send to logger using an agent to avoid deadlock?
- append a magic string to avoid double processing? YUCK
Options:
- subclass stderr,stdout before logging frameworks are initialized (done)
- Then <em>later</em> call logging functions?
- 
interaction w/ log capture?
post process output with another script?</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.core" name="util.core"><h1 class="project-name">util.core</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns util.core)</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn contains-in?
  [coll ks]
  (if (empty? ks) (throw (IllegalArgumentException. &quot;Empty key seq not allowed.&quot;)))
  (loop [coll coll
         ks ks]
    (let [k (first ks)
          ks (rest ks)]
      (if (contains? coll k)
        (if (empty? ks)
          true
          (recur (get coll k) ks))
        false))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.example" name="util.example"><h1 class="project-name">util.example</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Run code examples as unit tests and auto update docstrings.</p>

<p>   GOALS
   Allow example code to be both documentation and a test.
   Automatically update function documentation to include examples.
   Documentation should be seen by autodoc.
   Automatically define tests based on the examples.
   The test namespace should be allowed to be anything.
   Allow multiple examples per function.
   Allow examples to be attached to functions, macros, and namespaces.</p>

<p>   ISSUES
   Line level debugging doesn't work.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns util.example
  (:use clojure.test
        clojure.pprint))</pre></tr><tr><td class="docs"><p>TODO: Can example document itself?</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Appends a string to the documentation for item</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- append-doc
  [f s]
  (alter-meta! (resolve f) (fn [md] (assoc md :doc (str (:doc md) s)))))</pre></tr><tr><td class="docs"><p>Associates a code example with a namespace's :examples metadata key.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn- assoc-example
  [ns target item]
  (alter-meta!
   ns
   (fn [md]
     (assoc md :examples (assoc (or (:examples md) {}) target item)))))</pre></tr><tr><td class="docs"><p>Define example code associated with a function.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro defexample
  ([name target result example] `(defexample ~name &quot;Example:&quot; ~result ~example))
  ([name target heading result example]
     ;; TODO: Verify that target is a function, macro, or namespace.
     ;; Append the example to the target's documentation.
     (append-doc
      target
      (with-out-str
        (println)
        (println heading)
        (with-pprint-dispatch code-dispatch (pprint example))
        (println &quot;=&gt;&quot; result)))
     ;; Append the example code to the namespace's metadata.
     (when *load-tests*
       (assoc-example *ns* name [heading result example]))
     nil))</pre></tr><tr><td class="docs"><p>Create tests from examples in the given namespace.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro import-examples
  [ns]
  ;; TODO: Verify that the namespace exists.
  ;; TODO: Verify that examples exist.
  ;;(prn (meta (find-ns ns)))
  (let [examples (:examples (meta (find-ns ns)))]
    `(do ~@(for [[name [heading result example]] examples]
             `(testing ~heading
                (deftest ~name
                  (is (= ~result ~example))))))))</pre></tr><tr><td class="docs"><p>(append-example (find-ns 'util.foo))
(meta (find-ns 'util.foo))</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>clear meta
(alter-meta! (find-ns 'util.foo) (fn [md] {}))</p>
</td><td class="codes" /></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.environment" name="util.environment"><h1 class="project-name">util.environment</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Utilities for working with environment variables.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns util.environment
  (:use [clojure.contrib.def :only (defvar)]))</pre></tr><tr><td class="docs"><p>Coerce the environment map into a clojure map for easier use and to
   support rebinding in unit tests.</p>
</td><td class="codes" /><pre class="brush: clojure">(defvar environment
  (into {} (System/getenv)))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.except" name="util.except"><h1 class="project-name">util.except</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Macros for handling and throwing exceptions.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns util.except
  (:use [clojure.pprint :only (cl-format)]))</pre></tr><tr><td class="docs"><p>Evaluates an expression safely by catching any exceptions thrown.
   If an exception is thrown, the fallback value is returned.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro safely
  [expr fallback]
  `(try ~expr (catch Exception x# ~fallback)))</pre></tr><tr><td class="docs"><p>Evaluates an expression swallowing any exceptions. Returns the result of evaluating expr or the
   exception if one occurred.</p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro swallow
  [expr]
  `(try ~expr (catch Exception x# x#)))</pre></tr><tr><td class="docs"><p>Throws a RuntimeException with the given message. When multiple arguments are passed, cl-format
  is used to build the message string.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn die
  ([message]
     (throw (RuntimeException. ^String message)))
  ([format-string &amp; format-args]
     (die (apply cl-format nil format-string format-args))))</pre></tr><tr><td class="docs"><p>Evaluates expr and validates the result. The result is returned if validation succeeds. Otherwise, an
   exception is thrown.</p>

<p>   A custom validator function can be passed. If not passed, the function identity will be used to
   test for logical truth of the result.</p>

<p>   A custom error message format and optional format arguments may be passed. The error message is
   constructed using the cl-format function with the supplied format and args. During formatting,
   the offending result value will be inserted as the first format arg.</p>

<p>   EXAMPLES</p>

<p>   ;; Simple message.
   (swallow (check :zz #{:en :es :de :fr} "I don't know that language."))
   => #&lt;RuntimeException java.lang.RuntimeException: I don't know that language.></p>

<p>   ;; Format string that includes the offending value.
   (swallow (check :zz #{:en :es :de :fr} "I don't speak '~A'. Are you asleep?"))
   => #&lt;RuntimeException java.lang.RuntimeException: I don't speak ':zz'. Are you asleep?></p>

<p>   ;; Format string with additional arguments. Note that the offending value is inserted as the
   ;; first format argument.
   (let [langs #{:en :es :de :fr}]
     (swallow (check :zz langs "I don't speak '~A'. I do speak ~{~a~^, ~}." langs)))
   => #&lt;RuntimeException java.lang.RuntimeException: I don't speak ':zz'. I do speak :en, :es, :de, :fr.></p>

<p>   ;; If the validator function is omitted, logical truth will be tested.
   (swallow (check nil "Am I the eggman."))
   => #&lt;RuntimeException java.lang.RuntimeException: Am I the eggman.></p>

<p>   (swallow (check false "Am I the eggman? ~A."))
   => #&lt;RuntimeException java.lang.RuntimeException: Am I the eggman? false.></p>

<p>   (swallow (check false "Am I the eggman? ~A (~A)." "goo goo g'joob"))
   => #&lt;RuntimeException java.lang.RuntimeException: Am I the eggman? false (goo goo g'joob).></p>
</td><td class="codes" /><pre class="brush: clojure">(defmacro check
  ([expr]
     `(check ~expr identity))
  ([expr arg]
     (if (string? arg)
       `(check ~expr identity ~arg)
       `(check ~expr ~arg &quot;Check failed: invalid value '~A' for validator '~A'.&quot; '~arg)))
  ([expr validate-fn format-string &amp; format-args]
     (if (string? validate-fn)
       `(check ~expr identity ~validate-fn ~format-string ~@format-args)
       `(let [result# ~expr]
          (if (~validate-fn result#)
            result#
            (die ~format-string result# ~@format-args))))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.fs" name="util.fs"><h1 class="project-name">util.fs</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Utilities for manipulating / separated paths.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns util.fs
  (:require [clojure.java.io :as io])
  (:use [clojure.string :only (split)]
        [clojure.contrib.string :only (replace-re)])
  (:import java.io.File))</pre></tr><tr><td class="docs"><p>GOALS
- easy manipulations of paths
- don't use java.io.File since it is superflous
- clojurization
- use sequences
- use predicates
- follow idioms
- use / as path separator
- coerce internally where necessary for platform operations
- encapsulate java interop
- batteres included
- typical shell operations
- review clojure/java/ruby/python/shell for others
- handle both file and url paths
FUNCTIONS
- is fs (file segment/file system) the right name? (file?)
- child?         ; true if a is child of p
- empty?         ; true if dir has no children or file size is zero
- exists?        ; true if path exists?
- root?          ; true if path is "/"
- symlink?       ; true if path is a symlink
- readlink       ; true if path is a 
- dir?           ; true if path is a directory
- file?          ; true if path is a file
- children       ; seq of children; breadth-first; default depth is 1 (children "/foo" 1)
- dirs           ; seq of child directories
- files          ; seq of child files
- parents        ; seq of parents
- breadth-first/ ; macro that sets a binding to make tree seq order breadth first (breadth-first children "/tmp")
order                                                                           (order :breadth-fist expr)
- as-unix        ; coerce from dos to unix format
- as-dos         ; coerce from unix to dos format
- as-local       ; coerce to format of local platform
- parent         ; parent path
- name           ; file or dir name
- extension      ; file extension
- parts          ; seq of path segements
- canonicalize   ; returns the canonical path
- absolute?      ; true if path is absolute
- relative?      ; true if path is relative
- qualify        ; makes path absolute if not already (using ~ or supplied or current dir)
- unqualify      ; makes path relative by removing the supplied prefix (or number of parts)
- expand/glob/find    ; returns seq of matching shell expansions (including **/..)
MISC
- move, copy, delete, touch, temp-file, delete, chmod, chown, extended attributes, get and set times</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>namespace -> fs, file (file/shell)
fs -> file, join
fs-seq -> parts, split</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Joins path segments. Condenses consecutive slashes into a single slash.
   Removes trailing slashes for strings of length > 1.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn fs
  ([] nil)
  ([&amp; args]
     (let [args (filter identity args)]
       (if (empty? args)
         nil
         (let [s (apply str (interpose &quot;/&quot; args))
               s (replace-re #&quot;/{2,}&quot; &quot;/&quot; s) ; replace repeated slashes with a single slash
               s (replace-re #&quot;(?&lt;!\A)/$&quot; &quot;&quot; s)] ; remove a trailing slash
           s)))))</pre></tr><tr><td class="docs"><p>Makes the path absolute if not already.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn qualify
  ([path] (qualify path &quot;/&quot;))
  ([path dir]
     (cond
      (nil? path) nil
      (= \/ (first path)) path
      :default (str dir path))))</pre></tr><tr><td class="docs"><p>Calls fs on the arguments and makes the result fully qualified by prepending a leading / if necessary.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn ffs
  [&amp; args]
  (qualify (apply fs args)))</pre></tr><tr><td class="docs"><p>Returns true if the path is a relative path.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn relative?
  [path]
  (cond
   (nil? path) (throw (NullPointerException.))
   (empty? path) true
   :default (not= \/ (first path))))</pre></tr><tr><td class="docs"><p>Returns true if the path is an absolute path.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn absolute?
  [path]
  (not (relative? path)))</pre></tr><tr><td class="docs"><p>Takes a list of paths splits them into segments and returns the flattened seq.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn fs-seq
 ([] nil)
 ([&amp; args]
    (let [args (filter #(not (empty? %1)) args)]
      (seq (filter #(not (empty? %1))
                   (flatten
                    (map #(split %1 #&quot;/&quot;) args)))))))</pre></tr><tr><td class="docs"><p>Removes the first path segment.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn fs-rest
  [path]
  (if (nil? path)
      nil
      (apply (if (relative? path) fs ffs) (rest (fs-seq path)))))</pre></tr><tr><td class="docs"><p>TODO: Remove 0 arity unless needed (e.g., for apply).
TODO: See if type hints are necessary.</p>
</td><td class="codes" /></tr><tr><td class="docs"><p>Returns the parent path of a path or nil if there is no parent.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn parent
  ([] nil)
  ([path]
     (let [seq (butlast (fs-seq path))] 
          (if (and (empty? seq) (&gt; (count path) 1) (= \/ (nth path 0)) )
            &quot;/&quot;
            (apply fs (butlast (fs-seq path)))))))</pre></tr><tr><td class="docs"><p>Returns true if the path is the root path i.e., "/".</p>
</td><td class="codes" /><pre class="brush: clojure">(defn root?
  ([] nil)
  ([path]
  (= &quot;/&quot; path)))</pre></tr><tr><td class="docs"><p>Returns the canonical form of a path.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn canonical
  [path]
  (.getPath (.getCanonicalFile (File. ^String path))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn file-seq-bf [dir]
  &quot;Returns a seq of all files and subdirectories of a directory in breadth first order.&quot;
  (let [dir (io/file dir)
        children (.listFiles dir)
        subdirs (filter #(.isDirectory ^File %) children)
        files (filter #(.isFile ^File %) children)]
    (concat [dir] files (mapcat file-seq-bf subdirs))))</pre></tr><tr><td class="docs"><p>Returns a seq of all subdirectories of a directory in breadth first order.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn dir-seq-bf
  [dir]
  (let [dir (io/file dir)
        children (.listFiles dir)
        subdirs (filter #(.isDirectory ^File %) children)]
    (concat [dir] (mapcat dir-seq-bf subdirs))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.string" name="util.string"><h1 class="project-name">util.string</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(ns util.string)</pre></tr><tr><td class="docs"><p>Returns true if string starts with substring.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn starts-with?
  [string substring]
  (.startsWith string substring))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr><tr><td class="docs"><div class="docs-header"><a class="anchor" href="#util.base62" name="util.base62"><h1 class="project-name">util.base62</h1><a class="toc-link" href="#toc">toc</a></a></div></td><td class="codes" /></tr><tr><td class="docs"><p>Functions for working with base62 strings.</p>
</td><td class="codes" /><pre class="brush: clojure">(ns util.base62
  (:refer-clojure :exclude [rand])
  (:import java.security.SecureRandom))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(def digits &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;)</pre></tr><tr><td class="docs"><p>Returns the base62 encoded form of the given integer.</p>
</td><td class="codes" /><pre class="brush: clojure">(defn encode
  ([n] (encode n (if (= n 0) &quot;0&quot; &quot;&quot;)))
  ([n s]
     (if (= n 0)
       s
       (recur (int (/ n 62))
              (str (get digits (mod n 62)) s)))))</pre></tr><tr><td class="docs">
</td><td class="codes" /><pre class="brush: clojure">(defn rand [length]
  &quot;Returns a cryptographically secure base62 string of the given length.&quot;
  (apply str (repeatedly length #(char (nth digits (.nextInt (SecureRandom/getInstance &quot;SHA1PRNG&quot;) 62))))))</pre></tr><tr><td class="spacer docs">&nbsp;</td><td class="codes" /></tr></table><div class="footer">Generated by <a href="https://github.com/fogus/marginalia">Marginalia</a>.&nbsp;&nbsp;Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a><div id="floating-toc"><ul><li class="floating-toc-li" id="floating-toc_locale.middleware.translate">locale.middleware.translate</li><li class="floating-toc-li" id="floating-toc_locale.middleware.locale">locale.middleware.locale</li><li class="floating-toc-li" id="floating-toc_locale.core">locale.core</li><li class="floating-toc-li" id="floating-toc_locale.handler.redirect">locale.handler.redirect</li><li class="floating-toc-li" id="floating-toc_track.usage">track.usage</li><li class="floating-toc-li" id="floating-toc_app.config.core">app.config.core</li><li class="floating-toc-li" id="floating-toc_app.config">app.config</li><li class="floating-toc-li" id="floating-toc_app.run-level">app.run-level</li><li class="floating-toc-li" id="floating-toc_www.url">www.url</li><li class="floating-toc-li" id="floating-toc_www.middleware.spy">www.middleware.spy</li><li class="floating-toc-li" id="floating-toc_www.middleware.request-id">www.middleware.request-id</li><li class="floating-toc-li" id="floating-toc_www.id">www.id</li><li class="floating-toc-li" id="floating-toc_paypal.express-checkout">paypal.express-checkout</li><li class="floating-toc-li" id="floating-toc_paypal.nvp">paypal.nvp</li><li class="floating-toc-li" id="floating-toc_paypal.jobs">paypal.jobs</li><li class="floating-toc-li" id="floating-toc_"></li><li class="floating-toc-li" id="floating-toc_sistemi.site.modern-shelving-html">sistemi.site.modern-shelving-html</li><li class="floating-toc-li" id="floating-toc_sistemi.site.profile.locale">sistemi.site.profile.locale</li><li class="floating-toc-li" id="floating-toc_sistemi.site.profile.select-language-html">sistemi.site.profile.select-language-html</li><li class="floating-toc-li" id="floating-toc_sistemi.site">sistemi.site</li><li class="floating-toc-li" id="floating-toc_sistemi.middleware">sistemi.middleware</li><li class="floating-toc-li" id="floating-toc_sistemi.handlers">sistemi.handlers</li><li class="floating-toc-li" id="floating-toc_sistemi.routes">sistemi.routes</li><li class="floating-toc-li" id="floating-toc_log.readably">log.readably</li><li class="floating-toc-li" id="floating-toc_util.reflection">util.reflection</li><li class="floating-toc-li" id="floating-toc_util.core">util.core</li><li class="floating-toc-li" id="floating-toc_util.example">util.example</li><li class="floating-toc-li" id="floating-toc_util.environment">util.environment</li><li class="floating-toc-li" id="floating-toc_util.except">util.except</li><li class="floating-toc-li" id="floating-toc_util.fs">util.fs</li><li class="floating-toc-li" id="floating-toc_util.string">util.string</li><li class="floating-toc-li" id="floating-toc_util.base62">util.base62</li></ul></div></div><script type="text/javascript">SyntaxHighlighter.defaults['gutter'] = false;
       SyntaxHighlighter.all()</script></body></html>